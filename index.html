<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Supershop Bisagno S.R.L. - Articoli Regalo, Giocattoli, Casalinghi Genova</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Supershop Bisagno S.R.L. - Articoli regalo, giocattoli, cartoleria, casalinghi, ferramenta a Genova. Dal 2019 il vostro punto di riferimento.">
<meta name="keywords" content="supershop bisagno, genova, articoli regalo, giocattoli, casalinghi, ferramenta, natale">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõçÔ∏è</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Ê†∑Âºè‰ª£Á†Å‰øùÊåÅ‰∏çÂèò */
:root{
    --primary-color:#004080;
    --secondary-color:#ff6b00;
    --light-color:#f9f9f9;
    --dark-color:#333;
    --shadow:0 4px 6px rgba(0,0,0,0.1);
    --transition:all 0.3s ease
}
*{
    margin:0;
    padding:0;
    box-sizing:border-box
}
body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    line-height:1.6;
    background-color:var(--light-color);
    color:var(--dark-color);
    scroll-behavior:smooth
}
header{
    background:linear-gradient(135deg,var(--primary-color),#00264d);
    color:white;
    padding:1rem 0;
    box-shadow:var(--shadow);
    position:sticky;
    top:0;
    z-index:100
}
.header-container{
    max-width:1200px;
    margin:0 auto;
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:0 1rem
}
.logo{
    display:flex;
    align-items:center;
    gap:0.5rem
}
.logo-img{
    height:60px;
    width:auto
}
.logo h1{
    font-size:1.8rem
}
nav ul{
    display:flex;
    list-style:none;
    gap:1.5rem
}
nav a{
    color:white;
    text-decoration:none;
    font-weight:500;
    transition:var(--transition);
    padding:0.5rem 0;
    position:relative
}
nav a::after{
    content:'';
    position:absolute;
    bottom:0;
    left:0;
    width:0;
    height:2px;
    background-color:var(--secondary-color);
    transition:var(--transition)
}
nav a:hover::after{
    width:100%
}
.mobile-menu-btn{
    display:none;
    background:none;
    border:none;
    color:white;
    font-size:1.5rem;
    cursor:pointer
}
#adminBtn{
    display:none;
    background:var(--secondary-color);
    border:none;
    color:white;
    padding:0.5rem 0.8rem;
    border-radius:4px;
    cursor:pointer;
    opacity:0.7;
    transition:var(--transition)
}
#adminBtn:hover{
    opacity:1
}
.hero{
    background:linear-gradient(rgba(0,64,128,0.8),rgba(0,38,77,0.9));
    background-size:cover;
    background-position:center;
    color:white;
    text-align:center;
    padding:5rem 1rem
}
.hero-content{
    max-width:800px;
    margin:0 auto
}
.hero h2{
    font-size:2.5rem;
    margin-bottom:1rem;
    color:white
}
.hero p{
    font-size:1.2rem;
    margin-bottom:2rem
}
.btn{
    display:inline-block;
    background-color:var(--secondary-color);
    color:white;
    padding:0.8rem 1.5rem;
    border-radius:4px;
    text-decoration:none;
    font-weight:bold;
    transition:var(--transition);
    border:none;
    cursor:pointer
}
.btn:hover{
    background-color:#e55a00;
    transform:translateY(-3px);
    box-shadow:0 6px 12px rgba(0,0,0,0.15)
}
main{
    max-width:1200px;
    margin:2rem auto;
    padding:0 1rem
}
section{
    background:white;
    border-radius:8px;
    padding:2rem;
    margin-bottom:2rem;
    box-shadow:var(--shadow);
    transition:var(--transition)
}
section:hover{
    transform:translateY(-5px)
}
h2{
    color:var(--primary-color);
    margin-bottom:1.5rem;
    padding-bottom:0.5rem;
    border-bottom:2px solid var(--secondary-color);
    display:inline-block
}
.info-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
    gap:2rem;
    margin-top:2rem
}
.info-card{
    background:#f0f7ff;
    padding:1.5rem;
    border-radius:8px;
    border-left:4px solid var(--primary-color);
    transition:var(--transition)
}
.info-card:hover{
    transform:translateY(-5px);
    box-shadow:var(--shadow)
}
.info-card h3{
    color:var(--primary-color);
    margin-bottom:1rem;
    display:flex;
    align-items:center;
    gap:0.5rem
}
.info-card h3 i{
    color:var(--secondary-color)
}
.categories-grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:1.5rem;
    margin-top:1.5rem
}
.category-card{
    background:#f8f9fa;
    border-radius:8px;
    padding:1.5rem;
    text-align:center;
    transition:var(--transition);
    border:1px solid #e9ecef
}
.category-card:hover{
    transform:translateY(-5px);
    box-shadow:var(--shadow);
    border-color:var(--primary-color)
}
.category-icon{
    font-size:2.5rem;
    color:var(--primary-color);
    margin-bottom:1rem
}
.category-card h3{
    color:var(--primary-color);
    margin-bottom:0.5rem
}
.hours-list{
    list-style:none
}
.hours-list li{
    padding:0.5rem 0;
    border-bottom:1px dashed #ddd;
    display:flex;
    justify-content:space-between
}
.hours-list li:last-child{
    border-bottom:none
}
.contact-info{
    display:flex;
    flex-wrap:wrap;
    gap:2rem;
    margin-top:1.5rem
}
.contact-details{
    flex:1;
    min-width:300px
}
.contact-details p{
    margin-bottom:1rem;
    display:flex;
    align-items:center;
    gap:0.5rem
}
.contact-details a{
    color:var(--primary-color);
    text-decoration:none;
    transition:var(--transition)
}
.contact-details a:hover{
    color:var(--secondary-color)
}
.map-container{
    flex:1;
    min-width:300px;
    height:300px;
    border-radius:8px;
    overflow:hidden;
    box-shadow:var(--shadow)
}
.map-container iframe{
    width:100%;
    height:100%;
    border:none
}
footer{
    background:linear-gradient(135deg,var(--primary-color),#00264d);
    color:white;
    text-align:center;
    padding:2rem 0;
    margin-top:3rem
}
.footer-content{
    max-width:1200px;
    margin:0 auto;
    padding:0 1rem
}
.back-to-top{
    position:fixed;
    bottom:20px;
    right:20px;
    background:var(--secondary-color);
    color:white;
    width:50px;
    height:50px;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    text-decoration:none;
    box-shadow:var(--shadow);
    transition:var(--transition);
    opacity:0;
    visibility:hidden;
    z-index:99
}
.back-to-top.visible{
    opacity:1;
    visibility:visible
}
.back-to-top:hover{
    background:#e55a00;
    transform:translateY(-3px)
}
.monthly-offer{
    background:#f0f7ff;
    border-left:4px solid var(--primary-color);
    padding:1.5rem;
    margin:2rem 0;
    border-radius:8px;
    transition:all 0.3s ease
}
.monthly-offer:hover{
    transform:translateY(-5px);
    box-shadow:var(--shadow)
}
.monthly-offer.hidden{
    display:none
}
.offer-highlight{
    background:linear-gradient(135deg,var(--secondary-color),#ff8c00);
    color:white;
    padding:1rem;
    border-radius:8px;
    text-align:center;
    font-size:1.3rem;
    font-weight:bold;
    margin:1.5rem 0;
    box-shadow:0 4px 8px rgba(0,0,0,0.1)
}
.offer-details{
    background:white;
    padding:1.5rem;
    border-radius:8px;
    margin:1.5rem 0;
    border:1px solid #e0e0e0
}
.offer-validity{
    background:#fff8e1;
    padding:1rem;
    border-radius:8px;
    text-align:center;
    border:1px dashed var(--secondary-color);
    margin-top:1.5rem
}
.products-section{
    margin-top:2rem
}
.search-filter-container{
    display:flex;
    flex-wrap:wrap;
    gap:1rem;
    margin-bottom:2rem;
    align-items:center
}
.search-box{
    flex:1;
    min-width:300px;
    position:relative
}
.search-box input{
    width:100%;
    padding:0.8rem 1rem 0.8rem 2.5rem;
    border:1px solid #ddd;
    border-radius:4px;
    font-size:1rem
}
.search-box i{
    position:absolute;
    left:0.8rem;
    top:50%;
    transform:translateY(-50%);
    color:#777
}
.search-hint{
    font-size:0.8rem;
    color:#666;
    margin-top:0.3rem;
    margin-left:0.5rem
}
.filter-select{
    padding:0.8rem 1rem;
    border:1px solid #ddd;
    border-radius:4px;
    font-size:1rem;
    background:white;
    cursor:pointer
}
.products-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
    gap:1.5rem;
    margin-bottom:2rem
}
.product-card{
    background:white;
    border-radius:8px;
    overflow:hidden;
    box-shadow:var(--shadow);
    cursor:pointer;
    position:relative
}
.product-card:hover{
    transform:translateY(-5px);
    box-shadow:0 10px 20px rgba(0,0,0,0.15)
}
.product-image{
    width:100%;
    height:200px;
    object-fit:cover;
    background-color:#f5f5f5
}
.product-info{
    padding:1rem
}
.product-name{
    font-weight:600;
    margin-bottom:0.5rem;
    color:var(--dark-color)
}
.product-price-container{
    margin-bottom:0.5rem
}
.original-price{
    color:#999;
    text-decoration:line-through;
    font-size:0.9rem;
    margin-right:0.5rem
}
.discount-price{
    color:var(--secondary-color);
    font-weight:bold;
    font-size:1.1rem
}
.discount-badge{
    position:absolute;
    top:10px;
    right:10px;
    background:#e74c3c;
    color:white;
    padding:0.3rem 0.6rem;
    border-radius:4px;
    font-size:0.8rem;
    font-weight:bold;
    z-index:2
}
.product-category{
    display:inline-block;
    background:#f0f7ff;
    color:var(--primary-color);
    padding:0.2rem 0.5rem;
    border-radius:4px;
    font-size:0.8rem;
    margin-top:0.5rem
}
.product-barcode-small{
    font-size:0.7rem;
    color:#888;
    font-family:monospace;
    margin-top:0.3rem
}
.load-more-container{
    text-align:center;
    margin-top:2rem
}
.load-more-btn{
    background:var(--primary-color);
    color:white;
    border:none;
    padding:0.8rem 1.5rem;
    border-radius:4px;
    cursor:pointer;
    transition:var(--transition);
    font-size:1rem
}
.load-more-btn:hover{
    background:#003366
}
.sync-status{
    position:fixed;
    top:10px;
    right:10px;
    background:#28a745;
    color:white;
    padding:0.5rem 1rem;
    border-radius:20px;
    font-size:0.8rem;
    z-index:1000;
    display:flex;
    align-items:center;
    gap:0.5rem;
    box-shadow:var(--shadow)
}
.sync-status.syncing{
    background:#ffc107;
    color:#000
}
.sync-status.error{
    background:#dc3545
}
#privacy-modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:10000;
    justify-content:center;
    align-items:center
}
#privacy-modal>div{
    background:white;
    padding:2rem;
    border-radius:10px;
    max-width:600px;
    max-height:80vh;
    overflow-y:auto;
    margin:2rem;
    position:relative
}
.admin-btn{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:0.5rem;
    padding:0.8rem 1rem;
    border:none;
    border-radius:6px;
    color:white;
    font-weight:600;
    cursor:pointer;
    transition:all 0.3s ease
}
.admin-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 12px rgba(0,0,0,0.2)
}
.admin-btn:active{
    transform:translateY(0)
}
.admin-panel{
    display:none;
    position:fixed;
    top:0;
    right:-400px;
    width:400px;
    height:100vh;
    background:white;
    box-shadow:-5px 0 15px rgba(0,0,0,0.1);
    z-index:1000;
    transition:right 0.3s ease;
    overflow-y:auto
}
.admin-panel.active{
    display:block;
    right:0
}
.admin-header{
    background:var(--primary-color);
    color:white;
    padding:1.5rem;
    display:flex;
    justify-content:space-between;
    align-items:center
}
.admin-content{
    padding:1.5rem
}
.admin-section{
    margin-bottom:2rem;
    padding-bottom:1.5rem;
    border-bottom:1px solid #eee
}
.admin-section h3{
    color:var(--primary-color);
    margin-bottom:1rem;
    display:flex;
    align-items:center;
    gap:0.5rem
}
.admin-stats{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:1rem;
    margin-bottom:1.5rem
}
.stat-card{
    background:#f8f9fa;
    padding:1rem;
    border-radius:8px;
    text-align:center;
    border-left:4px solid var(--primary-color)
}
.stat-number{
    font-size:1.5rem;
    font-weight:bold;
    color:var(--primary-color);
    display:block
}
.stat-label{
    font-size:0.8rem;
    color:#666
}
.admin-form-group{
    margin-bottom:1rem
}
.admin-form-group label{
    display:block;
    margin-bottom:0.5rem;
    font-weight:500;
    color:var(--dark-color)
}
.admin-form-control{
    width:100%;
    padding:0.8rem;
    border:1px solid #ddd;
    border-radius:4px;
    font-size:1rem;
    font-family:inherit
}
.admin-form-control:focus{
    border-color:var(--primary-color);
    outline:none;
    box-shadow:0 0 0 2px rgba(0,64,128,0.1)
}
.admin-form-group textarea{
    height:100px;
    resize:vertical
}
.admin-actions{
    display:flex;
    gap:0.5rem;
    flex-wrap:wrap
}
.admin-action-btn{
    flex:1;
    min-width:120px;
    padding:0.8rem;
    border:none;
    border-radius:4px;
    cursor:pointer;
    font-weight:500;
    transition:var(--transition);
    display:flex;
    align-items:center;
    justify-content:center;
    gap:0.5rem
}
.admin-action-btn.primary{
    background:var(--primary-color);
    color:white
}
.admin-action-btn.secondary{
    background:#6c757d;
    color:white
}
.admin-action-btn.success{
    background:#28a745;
    color:white
}
.admin-action-btn.warning{
    background:#ffc107;
    color:#000
}
.admin-action-btn.danger{
    background:#dc3545;
    color:white
}
.admin-action-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 4px 8px rgba(0,0,0,0.2)
}
.password-hint{
    background:#fff3cd;
    border:1px solid #ffeaa7;
    border-radius:4px;
    padding:1rem;
    margin:1rem 0;
    font-size:0.9rem
}
.admin-overlay{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.5);
    z-index:999
}
.admin-overlay.active{
    display:block
}
.hidden-admin-btn{
    position:fixed;
    top:10px;
    right:60px;
    width:30px;
    height:30px;
    background:transparent;
    border:none;
    cursor:pointer;
    z-index:101;
    opacity:0.3;
    transition:opacity 0.3s ease
}
.hidden-admin-btn:hover{
    opacity:0.7
}

/* Animazione etichetta sconto */
@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.8; }
  100% { transform: scale(1); opacity: 1; }
}
.discount-tag {
  color: white;
  padding: 2px 5px;
  border-radius: 3px;
  font-size: 0.8rem;
  margin-left: 5px;
  display: inline-block;
  animation: pulse 1.5s infinite;
}

/* ÂÆûÊó∂‰∫ßÂìÅÁÆ°ÁêÜÊ†∑Âºè */
.realtime-admin-section {
  margin-top: 1rem;
  padding: 1rem;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: #f8f9fa;
}
.realtime-admin-section h4 {
  color: var(--primary-color);
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #ddd;
}
.realtime-form-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 1rem;
}
.realtime-form-group {
  display: flex;
  flex-direction: column;
}
.realtime-form-group label {
  font-weight: 500;
  margin-bottom: 0.3rem;
  font-size: 0.9rem;
  color: var(--dark-color);
}
.realtime-form-group input, .realtime-form-group select {
  padding: 0.7rem;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 0.9rem;
  width: 100%;
}
.realtime-product {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 1rem;
  margin-bottom: 0.8rem;
  padding: 0.8rem;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  background: white;
}
.realtime-product-info {
  flex: 1;
}
.realtime-product-info strong {
  color: var(--primary-color);
  display: block;
  margin-bottom: 0.2rem;
}
.realtime-product-info small {
  color: #666;
  font-size: 0.8rem;
}
.realtime-product-price {
  font-weight: bold;
  color: var(--secondary-color);
}
.realtime-product-actions {
  display: flex;
  gap: 0.5rem;
}
.sync-indicator {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  margin-right: 0.5rem;
}
.sync-indicator.online {
  background: #28a745;
  animation: pulse 2s infinite;
}
.sync-indicator.offline {
  background: #dc3545;
}

/* ‰ºòÊÉ†È¢ÑËßàÊ®°ÊÄÅÊ°Ü */
.offer-preview-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 10000;
  display: none;
  justify-content: center;
  align-items: center;
  padding: 2rem;
}
.offer-preview-content {
  background: white;
  border-radius: 10px;
  max-width: 800px;
  width: 100%;
  max-height: 90vh;
  overflow: auto;
  position: relative;
}

/* Êñ∞Â¢ûÁöÑ‰ºòÂåñÊ†∑Âºè */
.qr-code-section {
  transition: transform 0.3s ease;
  text-align: center;
  margin: 2rem 0;
  padding: 1.5rem;
  background: linear-gradient(135deg, #f0f7ff, #e6f3ff);
  border-radius: 10px;
  border-left: 4px solid var(--primary-color);
}

.qr-code-section:hover {
  transform: translateY(-5px);
}

.contact-highlight a:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(255, 107, 0, 0.3);
}

.store-guide {
  background: #e8f5e8;
  padding: 1rem;
  border-radius: 8px;
  margin: 1rem 0;
  text-align: center;
}

/* Cookie Banner Styles */
.cookie-banner {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(135deg, #004080, #00264d);
  color: white;
  padding: 20px;
  z-index: 10000;
  box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.cookie-settings-modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 10001;
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.cookie-settings-content {
  background: white;
  border-radius: 12px;
  max-width: 600px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
}

/* Privacy Policy Styles */
.privacy-policy-section {
  background: #f8f9fa;
  padding: 2rem;
  margin-top: 2rem;
  border-radius: 8px;
  border-left: 4px solid #004080;
}

.privacy-section-block {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  margin-bottom: 1.5rem;
}

/* ==================== ‰øÆÂ§çÁöÑ‰∫ßÂìÅÊ®°ÊÄÅÊ°ÜÊ†∑Âºè ==================== */
#productModal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  z-index: 10000;
  padding: 1rem;
  overflow-y: auto;
}

#productModal > div {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  min-height: 100%;
  padding: 2rem 0;
}

#productModal > div > div {
  background: white;
  border-radius: 12px;
  max-width: 600px;
  width: 100%;
  position: relative;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  margin: auto;
}

#productModal button {
  position: absolute;
  top: 15px;
  right: 15px;
  border: none;
  background: #ff4444;
  color: white;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  font-size: 1.5rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10001;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}

#productModal button:hover {
  background: #ff0000;
  transform: scale(1.1);
}

#productModal img {
  width: 100%;
  max-height: 400px;
  object-fit: contain;
  border-radius: 8px;
  margin-bottom: 1.5rem;
  background: #f8f9fa;
  padding: 1rem;
}

/* ÂìçÂ∫îÂºè‰∫ßÂìÅÊ®°ÊÄÅÊ°Ü */
@media (max-width: 768px) {
  #productModal {
    padding: 0.5rem;
  }
  
  #productModal > div {
    padding: 0.5rem 0;
    align-items: flex-start;
  }
  
  #productModal > div > div {
    margin: 0.5rem;
    border-radius: 8px;
  }
  
  #productModal button {
    width: 40px;
    height: 40px;
    top: 10px;
    right: 10px;
  }
}

@media (max-width: 480px) {
  #productModal {
    padding: 0.25rem;
  }
  
  #productModal > div > div {
    margin: 0.25rem;
  }
}

/* Á°Æ‰øùÊâÄÊúâÊµèËßàÂô®ÁöÑ‰∏ÄËá¥ÊÄß */
#productModal * {
  box-sizing: border-box;
}

#productModal img {
  max-width: 100%;
  height: auto;
}

@media(max-width:768px){
    .header-container{
        flex-direction:column;
        gap:1rem
    }
    nav ul{
        display:none;
        flex-direction:column;
        text-align:center;
        gap:1rem
    }
    nav ul.active{
        display:flex
    }
    .mobile-menu-btn{
        display:block
    }
    #adminBtn{
        display:none !important
    }
    .hidden-admin-btn{
        top:15px;
        right:50px;
        width:25px;
        height:25px
    }
    .admin-panel{
        width:100%;
        right:-100%
    }
    .products-grid{
        grid-template-columns:repeat(auto-fill,minmax(200px,1fr))
    }
    .realtime-product {
        flex-direction: column;
        align-items: flex-start;
    }
    .realtime-product-actions {
        width: 100%;
        justify-content: flex-end;
    }
    .realtime-form-grid {
        grid-template-columns: 1fr;
    }
    .cookie-banner {
        padding: 15px;
    }
}
@media(max-width:480px){
    .products-grid{
        grid-template-columns:1fr
    }
    .hidden-admin-btn{
        top:10px;
        right:45px;
        width:20px;
        height:20px
    }
    .admin-stats {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>

<!-- sync status -->
<div id="sync-status" class="sync-status" style="display:none">
  <i class="fas fa-cloud"></i> 
  <span id="sync-text">Sincronizzato</span>
</div>

<!-- ÈöêËóèÁöÑÁÆ°ÁêÜÂëòÊåâÈíÆ -->
<button class="hidden-admin-btn" id="hiddenAdminBtn" title="Pannello Admin" style="display:none">
    <i class="fas fa-user-shield" style="color:white;font-size:1.2rem"></i>
</button>

<!-- ==================== COOKIE BANNER - GDPR COMPLIANT ==================== -->
<div id="cookie-banner" class="cookie-banner">
  <div style="max-width:1200px; margin:0 auto; display:flex; flex-wrap:wrap; gap:15px; align-items:center; justify-content:space-between;">
    <div style="flex:1; min-width:300px;">
      <h4 style="margin:0 0 8px 0; color:white; display:flex; align-items:center; gap:8px;">
        <i class="fas fa-cookie-bite"></i> Cookie e Privacy
      </h4>
      <p style="margin:0; font-size:0.9rem; opacity:0.9; line-height:1.4;">
        Utilizziamo cookie tecnici e di terze parti per migliorare la tua esperienza e per analisi del traffico. 
        Puoi gestire le tue preferenze qui sotto. 
        <a href="#privacy-policy" onclick="scrollToPrivacyPolicy()" style="color:#ff6b00; text-decoration:underline;">Leggi la Privacy Policy</a>
      </p>
    </div>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <button onclick="acceptAllCookies()" style="background:#ff6b00; color:white; border:none; padding:12px 20px; border-radius:6px; cursor:pointer; font-weight:bold; transition:all 0.3s; display:flex; align-items:center; gap:8px;">
        <i class="fas fa-check"></i> Accetta Tutto
      </button>
      <button onclick="acceptNecessaryCookies()" style="background:transparent; color:white; border:2px solid white; padding:12px 20px; border-radius:6px; cursor:pointer; font-weight:bold; transition:all 0.3s;">
        Solo Necessari
      </button>
      <button onclick="openCookieSettings()" style="background:transparent; color:white; border:2px solid white; padding:12px 20px; border-radius:6px; cursor:pointer; font-weight:bold; transition:all 0.3s; display:flex; align-items:center; gap:8px;">
        <i class="fas fa-cog"></i> Personalizza
      </button>
    </div>
  </div>
</div>

<!-- Cookie Settings Modal -->
<div id="cookie-settings" class="cookie-settings-modal">
  <div class="cookie-settings-content">
    <div style="padding:25px; border-bottom:1px solid #eee;">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 style="margin:0; color:#004080;"><i class="fas fa-sliders-h"></i> Gestione Cookie</h3>
        <button onclick="closeCookieSettings()" style="background:none; border:none; font-size:1.5rem; cursor:pointer; color:#666;">‚úñ</button>
      </div>
    </div>
    
    <div style="padding:25px;">
      <div style="margin-bottom:25px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <label style="font-weight:bold; color:#004080; cursor:pointer;">
            <i class="fas fa-lock"></i> Cookie Necessari
          </label>
          <input type="checkbox" id="necessary-cookies" checked disabled style="width:20px; height:20px;">
        </div>
        <p style="margin:0; color:#666; font-size:0.9rem;">
          Cookie essenziali per il funzionamento del sito. Non possono essere disattivati.
        </p>
      </div>

      <div style="margin-bottom:25px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <label style="font-weight:bold; color:#004080; cursor:pointer;">
            <i class="fas fa-map-marked-alt"></i> Google Maps
          </label>
          <input type="checkbox" id="maps-cookies" style="width:20px; height:20px;">
        </div>
        <p style="margin:0; color:#666; font-size:0.9rem;">
          Cookie per la visualizzazione della mappa e localizzazione del negozio.
        </p>
      </div>

      <div style="margin-bottom:25px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <label style="font-weight:bold; color:#004080; cursor:pointer;">
            <i class="fas fa-database"></i> Firebase (Prodotti)
          </label>
          <input type="checkbox" id="firebase-cookies" style="width:20px; height:20px;">
        </div>
        <p style="margin:0; color:#666; font-size:0.9rem;">
          Cookie per la sincronizzazione in tempo reale dei prodotti e prezzi.
        </p>
      </div>

      <div style="margin-bottom:25px;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
          <label style="font-weight:bold; color:#004080; cursor:pointer;">
            <i class="fas fa-chart-bar"></i> Cookie Analitici
          </label>
          <input type="checkbox" id="analytics-cookies" style="width:20px; height:20px;">
        </div>
        <p style="margin:0; color:#666; font-size:0.9rem;">
          Cookie per analisi del traffico e miglioramento del sito.
        </p>
      </div>
    </div>

    <div style="padding:20px 25px; background:#f8f9fa; border-top:1px solid #eee; display:flex; gap:10px; justify-content:flex-end;">
      <button onclick="closeCookieSettings()" style="background:#666; color:white; border:none; padding:12px 20px; border-radius:6px; cursor:pointer; font-weight:bold;">
        Annulla
      </button>
      <button onclick="saveCookiePreferences()" style="background:#004080; color:white; border:none; padding:12px 25px; border-radius:6px; cursor:pointer; font-weight:bold;">
        Salva Preferenze
      </button>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-overlay" id="adminOverlay"></div>
<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <h3><i class="fas fa-cogs"></i> Pannello di Amministrazione</h3>
    <button onclick="closeAdminPanel()" style="background:none;border:none;color:white;font-size:1.2rem;cursor:pointer">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="admin-content">
    <div class="admin-section">
      <h3><i class="fas fa-chart-bar"></i> Statistiche</h3>
      <div class="admin-stats">
        <div class="stat-card">
          <span class="stat-number" id="totalProducts">0</span>
          <span class="stat-label">Prodotti Totali</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="totalCategories">0</span>
          <span class="stat-label">Categorie</span>
        </div>
        <div class="stat-card">
          <span class="stat-number" id="realtimeProducts">0</span>
          <span class="stat-label">Prodotti Real-time</span>
        </div>
        <div class="stat-card">
          <span class="stat-number">
            <span class="sync-indicator offline" id="firebaseIndicator"></span>
            <span id="firebaseStatusText">Offline</span>
          </span>
          <span class="stat-label">Stato Firebase</span>
        </div>
      </div>
    </div>
    
    <!-- Firebase‰ºòÊÉ†ÂÜÖÂÆπÁÆ°ÁêÜÈÉ®ÂàÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-fire"></i> Gestione Contenuti Promozionali (Firebase)</h3>
      <div class="password-hint">
        <strong>Modifica i contenuti delle offerte - Sincronizzazione in tempo reale</strong><br>
        <small>Le modifiche si sincronizzano immediatamente su tutti i dispositivi</small>
      </div>
      
      <button id="offerAdminLoginBtn" class="admin-action-btn primary" onclick="enableOfferAdmin()">
        <i class="fas fa-edit"></i> Gestione Contenuti Promozionali
      </button>
      
      <div id="offerAdminSection" class="realtime-admin-section" style="display:none;">
        <h4>Modifica Contenuti Promozionali</h4>
        
        <div class="admin-form-group">
          <label>Titolo Offerta *</label>
          <input type="text" id="offerTitle" placeholder="es: üéÑ Speciale Natale" class="admin-form-control">
        </div>
        
        <div class="admin-form-group">
          <label>Testo Evidenziato *</label>
          <textarea id="offerHighlight" placeholder="Testo in evidenza..." rows="3" class="admin-form-control">SCONTI INCREDIBILI FINO AL 70% SU ALCUNI ARTICOLI NATALIZI!</textarea>
        </div>
        
        <div class="admin-form-group">
          <label>Dettagli Offerta (HTML)</label>
          <textarea id="offerDetails" placeholder="Dettagli dell'offerta in HTML..." rows="5" class="admin-form-control"></textarea>
          <small style="color:#666;">Puoi usare HTML per formattazione avanzata</small>
        </div>
        
        <div class="admin-form-group">
          <label>Testo Motivazionale (HTML)</label>
          <textarea id="offerMotivation" placeholder="Testo motivazionale in HTML..." rows="3" class="admin-form-control"></textarea>
        </div>
        
        <div class="admin-form-group">
          <label>Data di Scadenza *</label>
          <input type="text" id="offerExpiry" placeholder="es: 31 Dicembre 2025" class="admin-form-control" value="31 Dicembre 2025">
        </div>
        
        <div class="admin-form-group">
          <label>Stato Offerta</label>
          <select id="offerStatus" class="admin-form-control">
            <option value="active">Attiva</option>
            <option value="hidden">Nascosta</option>
          </select>
        </div>
        
        <div class="admin-actions">
          <button class="admin-action-btn success" onclick="saveOfferContent()">
            <i class="fas fa-save"></i> Salva e Sincronizza
          </button>
          <button class="admin-action-btn secondary" onclick="resetOfferContent()">
            <i class="fas fa-redo"></i> Ripristina Default
          </button>
          <button class="admin-action-btn primary" onclick="previewOffer()">
            <i class="fas fa-eye"></i> Anteprima Live
          </button>
        </div>
        
        <div id="offerLastUpdate" style="margin-top: 1rem; font-size: 0.9rem; color: #555; text-align: center;"></div>
      </div>
    </div>
    
    <!-- ÂÆûÊó∂‰∫ßÂìÅÁÆ°ÁêÜÈÉ®ÂàÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-sync-alt"></i> Gestione Prodotti in Tempo Reale</h3>
      <div class="password-hint">
        <strong>Gestione prodotti Firebase</strong><br>
        <small>I prodotti real-time hanno priorit√† e si sincronizzano automaticamente</small>
      </div>
      <button id="realtimeAdminLoginBtn" class="admin-action-btn primary" onclick="enableRealtimeAdmin()">
        <i class="fas fa-database"></i> Gestione Prodotti Real-time
      </button>
      <div id="realtimeAdminSection" class="realtime-admin-section" style="display:none;">
        <h4>Gestione Prodotto Real-time</h4>
        <div class="realtime-form-grid">
          <div class="realtime-form-group">
            <label for="newProductBarcode">Codice a barre *</label>
            <input type="text" id="newProductBarcode" placeholder="8021785862708" maxlength="13">
          </div>
          <div class="realtime-form-group">
            <label for="newProductName">Nome prodotto *</label>
            <input type="text" id="newProductName" placeholder="Nome del prodotto">
          </div>
          <div class="realtime-form-group">
            <label for="newProductCategory">Categoria</label>
            <select id="newProductCategory">
              <option value="regalo">Articoli Regalo</option>
              <option value="giocattoli">Giocattoli</option>
              <option value="cartoleria">Cartoleria</option>
              <option value="casalinghi">Casalinghi</option>
              <option value="ferramenta">Ferramenta</option>
              <option value="animali">Articoli per animali</option>
              <option value="illuminazione">Illuminazione</option>
              <option value="mobili">Mobili</option>
              <option value="natale">Articoli Natalizi</option>
            </select>
          </div>
          <div class="realtime-form-group">
            <label for="newProductPrice">Prezzo (‚Ç¨) *</label>
            <input type="number" id="newProductPrice" placeholder="10.00" step="0.01" min="0">
          </div>
        </div>
        
        <div class="realtime-form-grid">
          <div class="realtime-form-group">
            <label for="newProductImage">URL Immagine</label>
            <input type="text" id="newProductImage" placeholder="https://...">
          </div>
          <div class="realtime-form-group">
            <label for="newProductDescription">Descrizione</label>
            <input type="text" id="newProductDescription" placeholder="Descrizione prodotto">
          </div>
        </div>
        
        <div style="background: #fff3cd; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
          <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
            <input type="checkbox" id="newProductDiscount" onchange="toggleDiscountFields()">
            <strong>Attiva sconto per questo prodotto</strong>
          </label>
        </div>
        
        <div id="discountFields" style="display: none;">
          <div class="realtime-form-grid">
            <div class="realtime-form-group">
              <label for="newDiscountPrice">Prezzo scontato (‚Ç¨) *</label>
              <input type="number" id="newDiscountPrice" placeholder="7.50" step="0.01" min="0">
            </div>
            <div class="realtime-form-group">
              <label for="newDiscountTagText">Testo etichetta sconto</label>
              <input type="text" id="newDiscountTagText" placeholder="Offerta!" value="Offerta!">
            </div>
            <div class="realtime-form-group">
              <label for="newDiscountTagColor">Colore etichetta</label>
              <input type="color" id="newDiscountTagColor" value="#ff0000">
            </div>
          </div>
        </div>
        
        <div class="admin-actions" style="margin-top: 1.5rem;">
          <button id="addOrUpdateBtn" class="admin-action-btn success" onclick="addOrUpdateProduct()">
            <i class="fas fa-plus"></i> Aggiungi Prodotto
          </button>
          <button class="admin-action-btn secondary" onclick="resetRealtimeForm()">
            <i class="fas fa-redo"></i> Reset
          </button>
        </div>
        
        <div style="margin-top: 2rem;">
          <h4>Prodotti Real-time Attivi</h4>
          <div id="realtimeProductsContainer"></div>
        </div>
        <div id="lastUpdate" style="margin-top: 1rem; font-size: 0.9rem; color: #555; text-align: center;"></div>
      </div>
    </div>
    
    <!-- QR Code ‰ΩøÁî®ÊèêÁ§∫ÈÉ®ÂàÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-qrcode"></i> QR Code Utilizzo</h3>
      <div style="background: #e8f5e8; padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
        <p style="margin: 0 0 0.5rem 0;"><strong>Utilizzo del QR Code in negozio:</strong></p>
        <ul style="margin: 0; padding-left: 1.2rem; font-size: 0.9rem;">
          <li>Stampa il QR code per esporlo in negozio</li>
          <li>Posizionalo vicino alla cassa e nelle aree prodotti</li>
          <li>I clienti possono scansionare per vedere il catalogo completo</li>
          <li>I prezzi si aggiornano automaticamente via Firebase</li>
        </ul>
      </div>
    </div>
    
    <!-- Êµ∑Êä•ÁîüÊàêÂô®ÈÉ®ÂàÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-print"></i> Generatore Poster Promozionale</h3>
      <div style="background:#f5f5f5; padding:1rem; border-radius:6px; margin-bottom:1rem; border-left:4px solid #000;">
        <p style="margin:0 0 0.5rem 0; font-weight:bold;"><i class="fas fa-desktop"></i> Interfaccia ottimizzata per computer</p>
        <p style="margin:0; font-size:0.9rem;">Anteprima in tempo reale e stampa A4 professionale</p>
      </div>
      <button class="admin-action-btn" style="background:#333; color:white;" onclick="openPosterGenerator()">
        <i class="fas fa-palette"></i> Crea Poster Promozionale
      </button>
    </div>
    
    <!-- ÂÖ∂‰ΩôÁÆ°ÁêÜÂëòÈÉ®ÂàÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-key"></i> Gestione Password</h3>
      <div class="password-hint">
        <strong>Accesso riservato al personale autorizzato</strong><br>
        <small>Contatta l'amministratore per le credenziali</small>
      </div>
    </div>
    
    <!-- ÂéüÊúâÊú¨Âú∞‰∫ßÂìÅÁÆ°ÁêÜÈÉ®ÂàÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-plus-circle"></i> Aggiungi Prodotto Locale</h3>
      <div class="admin-form-group">
        <label>Nome Prodotto</label>
        <input type="text" id="adminProductName" placeholder="Inserisci nome prodotto">
      </div>
      <div class="admin-form-group">
        <label>Codice a Barre</label>
        <input type="text" id="adminProductBarcode" placeholder="Inserisci codice a barre 13 cifre">
      </div>
      <div class="admin-form-group">
        <label>Categoria</label>
        <select id="adminProductCategory">
          <option value="regalo">Articoli Regalo</option>
          <option value="giocattoli">Giocattoli</option>
          <option value="cartoleria">Cartoleria</option>
          <option value="casalinghi">Casalinghi</option>
          <option value="ferramenta">Ferramenta</option>
          <option value="animali">Articoli per animali</option>
          <option value="illuminazione">Illuminazione</option>
          <option value="mobili">Mobili</option>
          <option value="natale">Articoli Natalizi</option>
          </select>
      </div>
      <div class="admin-form-group">
        <label>Prezzo Originale (‚Ç¨)</label>
        <input type="text" id="adminOriginalPrice" placeholder="es: 10,00">
      </div>
      <div class="admin-form-group">
        <label>Prezzo Scontato (‚Ç¨)</label>
        <input type="text" id="adminDiscountPrice" placeholder="es: 7,50">
      </div>
      <div class="admin-form-group">
        <label>URL Immagine</label>
        <input type="text" id="adminProductImage" placeholder="Inserisci link immagine">
      </div>
      <div class="admin-form-group">
        <label>Descrizione</label>
        <textarea id="adminProductDescription" placeholder="Inserisci descrizione prodotto"></textarea>
      </div>
      <div class="admin-actions">
        <button class="admin-action-btn success" onclick="addProduct()">
          <i class="fas fa-plus"></i> Aggiungi Prodotto Locale
        </button>
      </div>
    </div>
    
    <!-- Êï∞ÊçÆÁÆ°ÁêÜÈÉ®ÂàÜ - ÂåÖÂê´ÊâπÈáèÂØºÂÖ•ÂíåÂà†Èô§ÂäüËÉΩ -->
    <div class="admin-section">
      <h3><i class="fas fa-file-export"></i> Gestione Dati e Import/Export</h3>
      
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="exportProducts()">
          <i class="fas fa-download"></i> Esporta CSV
        </button>
        <button class="admin-action-btn secondary" onclick="importProducts()">
          <i class="fas fa-upload"></i> Importa CSV
        </button>
        <!-- Êñ∞Â¢ûFirebase‰∏ä‰º†ÊåâÈíÆ -->
        <button class="admin-action-btn success" onclick="uploadToFirebase()">
          <i class="fas fa-cloud-upload-alt"></i> Carica su Firebase
        </button>
        <button class="admin-action-btn warning" onclick="syncWithFirebase()">
          <i class="fas fa-sync-alt"></i> Sincronizza con Firebase
        </button>
      </div>
      
      <!-- È´òÁ∫ßFirebaseÁÆ°ÁêÜ -->
      <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #eee;">
        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">
          <i class="fas fa-database"></i> Gestione Avanzata Firebase
        </h4>
        
        <div class="admin-actions">
          <button class="admin-action-btn primary" onclick="uploadToFirebase()">
            <i class="fas fa-cloud-upload-alt"></i> Carica Tutto su Firebase
          </button>
          <button class="admin-action-btn success" onclick="syncWithFirebase()">
            <i class="fas fa-sync-alt"></i> Sincronizza Intelligente
          </button>
          <button class="admin-action-btn warning" onclick="compareLocalFirebase()">
            <i class="fas fa-code-compare"></i> Confronta Dati
          </button>
          <button class="admin-action-btn danger" onclick="clearFirebaseProducts()">
            <i class="fas fa-trash"></i> Svuota Firebase
          </button>
        </div>
      </div>
      
      <!-- Êñ∞Â¢ûÊâπÈáèÁÆ°ÁêÜÂäüËÉΩ -->
      <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #eee;">
        <h4 style="color: var(--primary-color); margin-bottom: 1rem;">
          <i class="fas fa-trash-alt"></i> Gestione Bulk Prodotti
        </h4>
        
        <div class="admin-actions">
          <button class="admin-action-btn warning" onclick="selectiveBatchDelete()" 
                  title="Elimina prodotti per categoria, nome o codice">
            <i class="fas fa-search-minus"></i> Elimina Selettiva
          </button>
          <button class="admin-action-btn danger" onclick="deleteByCategory()"
                  title="Elimina tutti i prodotti di una categoria">
            <i class="fas fa-layer-group"></i> Elimina per Categoria
          </button>
          <button class="admin-action-btn danger" onclick="batchDeleteProducts()"
                  title="Elimina TUTTI i prodotti (attenzione!)">
            <i class="fas fa-broom"></i> Elimina Tutto
          </button>
        </div>
        
        <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin-top: 1rem; border-left: 4px solid #ffc107;">
          <p style="margin: 0; font-size: 0.9rem; color: #856404;">
            <i class="fas fa-exclamation-triangle"></i> <strong>Attenzione:</strong> 
            L'eliminazione di prodotti non pu√≤ essere annullata. I prodotti real-time di Firebase verranno eliminati solo se si hanno i permessi.
          </p>
        </div>
      </div>
    </div>
    
    <div class="admin-section">
      <h3><i class="fas fa-sync"></i> Sincronizzazione</h3>
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="syncAllProducts()">
          <i class="fas fa-sync-alt"></i> Sincronizza con Firebase
        </button>
        <button class="admin-action-btn warning" onclick="migrateToFirebase()">
          <i class="fas fa-cloud-upload-alt"></i> Migra a Firebase
        </button>
      </div>
    </div>
  </div>
</div>

<!-- È°µÈù¢ÂÖ∂‰ΩôÈÉ®ÂàÜ‰øùÊåÅ‰∏çÂèò -->
<header>
  <div class="header-container">
    <div class="logo">
      <img src="1000011845.png" alt="SuperShop Logo" class="logo-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzAwNDA4MCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UzwvdGV4dD48L3N2Zz4='">
      <h1>Supershop</h1>
    </div>
    <div style="display:flex;align-items:center;gap:1rem">
      <nav>
        <ul id="navMenu">
          <li><a href="#home">Home</a></li>
          <li><a href="#about">Chi Siamo</a></li>
          <li><a href="#products">Prodotti</a></li>
          <li><a href="#monthly-offer">Offerte</a></li>
          <li><a href="#hours">Orari</a></li>
          <li><a href="#products-showcase">Catalogo</a></li>
          <li><a href="#contact">Contatti</a></li>
        </ul>
      </nav>
      <button id="adminBtn" title="Pannello Admin"><i class="fas fa-user-shield"></i></button>
      <button class="mobile-menu-btn" aria-label="Menu"><i class="fas fa-bars"></i></button>
    </div>
  </div>
</header>

<section class="hero" id="home">
  <div class="hero-content">
    <h2>Supershop Bisagno S.R.L.</h2>
    <p>ARTICOLI REGALO - GIOCATOLI - CARTOLERIA - CASALINGHI - FERRAMENTA</p>
    <a href="#products-showcase" class="btn">Scopri i nostri prodotti</a>
  </div>
</section>

<main>
  <!-- È°µÈù¢ÂÜÖÂÆπ‰øùÊåÅ‰∏çÂèò -->
  <section id="about">
    <h2>Benvenuti</h2>
    <p>Benvenuti nel sito ufficiale di Supershop Bisagno S.R.L., il vostro punto di riferimento a Genova dal 2019. Offriamo un'ampia selezione di articoli per la casa, articoli per l'igiene personale, prodotti per la pulizia della casa, giocattoli per bambini e articoli per animali domestici,ecc.</p>
    <div class="info-grid">
      <div class="info-card">
        <h3><i class="fas fa-store"></i> Il nostro negozio</h3>
        <p>Un ambiente moderno e accogliente dove trovare tutto ci√≤ che ti serve per la casa e la famiglia con la massima convenienza e qualit√†.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-users"></i> La nostra filosofia</h3>
        <p>Crediamo nel servicio al cliente eccellente e nella qualit√† dei productos. La soddisfazione dei nostri clienti √® la nostra priorit√†.</p>
      </div>
    </div>
  </section>

  <section id="products">
    <h2>I nostri prodotti</h2>
    <p>Scopri la nostra vasta gamma di prodotti per tutte le esigenze domestiche:</p>
    <div class="categories-grid">
      <div class="category-card"><div class="category-icon"><i class="fas fa-gift"></i></div><h3>Articoli Regalo</h3><p>Idee regalo per ogni occasione e per tutte le et√†</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-gamepad"></i></div><h3>Giocattoli</h3><p>Giocattoli educativi e di intrattenimento per bambini</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-pencil-alt"></i></div><h3>Cartoleria</h3><p>Materiale scolastico e per ufficio di alta qualit√†</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-home"></i></div><h3>Casalinghi</h3><p>Accessori e complementi d'arredo per la casa</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-tools"></i></div><h3>Ferramenta</h3><p>Utensili e materiali per piccoli lavori domesticos</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-paw"></i></div><h3>Articoli per animali</h3><p>Prodotti per la cura e il benessere dei tuoi amici a quattro zampe</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-lightbulb"></i></div><h3>Illuminazione</h3><p>Lampadari, lampade da terra, lampade da tavolo e illuminazione per internos</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-couch"></i></div><h3>Mobili</h3><p>Mobili per la casa, sedie, tavoli e complementi d'arredo</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-tree"></i></div><h3>Articoli Natalizi</h3><p>Decorazioni, addobbi e regali per il periodo natalizio</p></div>
    </div>
  </section>

  <!-- Âä®ÊÄÅ‰ºòÊÉ†ÂÜÖÂÆπÈÉ®ÂàÜ -->
  <section id="monthly-offer" class="monthly-offer">
    <!-- ÂÜÖÂÆπÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
  </section>

  <section id="hours">
    <h2>Orari di apertura</h2>
    <ul class="hours-list">
      <li><span>Luned√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Marted√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Mercoled√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Gioved√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Venerd√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Sabato</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Domenica</span><span>08:45 ‚Äî 19:45</span></li>
    </ul>
    <p style="margin-top:1rem;font-style:italic">Siamo aperti anche nei giorni festivi, salvo comunicazioni diverse.</p>
  </section>

  <section id="products-showcase" class="products-section">
    <h2>Catalogo Prodotti</h2>
    <p>Scopri tutti i nostri prodotti con prezzi e dettagli:</p>
    <div class="search-filter-container">
      <div class="search-box"><i class="fas fa-search"></i><input type="text" id="product-search" placeholder="Cerca per nome prodotto o codice a barre..."><div class="search-hint">Cerca per nome prodotto o codice a barre (es: 8005123456789)</div></div>
      <select class="filter-select" id="category-filter"><option value="all">Tutte le categorie</option><option value="regalo">Articoli Regalo</option><option value="giocattoli">Giocattoli</option><option value="cartoleria">Cartoleria</option><option value="casalinghi">Casalinghi</option><option value="ferramenta">Ferramenta</option><option value="animali">Articoli per animali</option><option value="illuminazione">Illuminazione</option><option value="mobili">Mobili</option><option value="natale">üéÑ Articoli Natalizi</option></select>
    </div>
    <div class="products-grid" id="products-container"></div>
    <div class="load-more-container"><button class="load-more-btn" id="load-more">Carica pi√π prodotti</button></div>
  </section>

  <!-- ‰ºòÂåñÁöÑËÅîÁ≥ª‰ø°ÊÅØÈÉ®ÂàÜ -->
  <section id="contact">
    <h2>Contatti</h2>
    <div class="contact-info">
      <div class="contact-details">
        <p><i class="fas fa-map-marker-alt"></i> <strong>Indirizzo:</strong> Lungobisagno Istria, 29F, 16139 Genova GE</p>
        <p><i class="fas fa-envelope"></i> <strong>Email:</strong> <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a></p>
        <p><i class="fas fa-info-circle"></i> Per informazioni commerciali o partnership, contattaci via email.</p>
        
        <!-- ‰ºòÂåñÁöÑ‰∫åÁª¥Á†ÅÂ±ïÁ§∫ -->
        <div class="qr-code-section">
          <h4 style="color: var(--primary-color); margin-bottom: 1rem;">
            <i class="fas fa-mobile-alt"></i> Salva il nostro sito sul tuo telefono
          </h4>
          <img src="1000011850.png" alt="QR Code Supershop Bisagno" 
               style="width: 160px; height: 160px; border: 3px solid var(--primary-color); padding: 12px; background: white; border-radius: 8px;">
          <div style="margin-top: 1rem;">
            <p style="font-weight: 600; margin-bottom: 0.5rem;">Scansiona con la fotocamera</p>
            <p style="font-size: 0.8rem; color: #666; margin: 0;">
              Per prodotti, prezzi e offerte sempre aggiornati
            </p>
          </div>
        </div>

        <!-- ‰ºòÂåñÁöÑÈÇÆÁÆ±ËÅîÁ≥ªÈÉ®ÂàÜ -->
        <div class="contact-highlight" style="background: #fff8e1; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; border-left: 4px solid var(--secondary-color);">
          <h4 style="color: var(--secondary-color); margin-bottom: 1rem;"><i class="fas fa-envelope"></i> Contattaci</h4>
          <p style="margin-bottom: 1rem;">Per informazioni, prezzi o disponibilit√†:</p>
          <a href="mailto:supershopbisagnosrl@gmail.com" 
             style="display: inline-block; background: var(--secondary-color); color: white; padding: 0.8rem 1.5rem; border-radius: 6px; text-decoration: none; font-weight: bold; transition: all 0.3s ease;">
            <i class="fas fa-paper-plane"></i> Invia Email
          </a>
          <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
            Rispondiamo entro 24 ore
          </p>
        </div>

        <!-- Âà∞Â∫óÂºïÂØº -->
        <div class="store-guide">
          <p style="margin: 0; color: #2d5a2d;">
            <i class="fas fa-store"></i> <strong>Visita il nostro negozio</strong> per consulenza personalizzata
          </p>
          <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">
            I nostri esperti ti aiuteranno a trovare il prodotto perfetto
          </p>
        </div>
      </div>
      
      <div class="map-container">
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2817.256958424239!2d8.946223315544193!3d44.40722497909945!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12d3433c3b06d6a5%3A0x5b0e46e9e5a5a5a5!2sLungobisagno%20Istria%2C%2029F%2C%2016139%20Genova%20GE!5e0!3m2!1sit!2sit!4v1620000000000!5m2!1sit!2sit" allowfullscreen="" loading="lazy"></iframe>
      </div>
    </div>
  </section>

  <!-- ==================== COMPLIANCE DISCLAIMER ==================== -->
  <section id="compliance" style="background:#f8f9fa;border-left:4px solid #004080;padding:1.5rem;margin-top:2rem;border-radius:8px;">
    <h2>Informazioni Legali e Conformit√†</h2>
    <p>Supershop Bisagno S.R.L. dichiara che tutte le informazioni sui prodotti, immagini e prezzi presenti sul sito sono fornite a scopo informativo. Nonostante l'accuratezza dei dati, potrebbero verificarsi variazioni senza preavviso o piccoli errori involontari.</p>
    <p>I prezzi validi sono esclusivamente quelli esposti in negozio al momento dell'acquisto.</p>
    <p>Questo sito rispetta il <strong>Regolamento (UE) 2016/679 (GDPR)</strong> e la normativa italiana sulla privacy. 
       Per informazioni dettagliate sul trattamento dei dati personali, consulta la nostra 
       <a href="#privacy-policy" onclick="scrollToPrivacyPolicy()" style="color:#004080; font-weight:bold;">Privacy Policy completa</a>.</p>
    <p>Utilizziamo cookie tecnici e di terze parti per migliorare la tua esperienza. 
       <a href="javascript:void(0)" onclick="openCookieSettings()" style="color:#004080; font-weight:bold;">Gestisci le tue preferenze cookie</a>.</p>
  </section>

 <!-- ==================== ÂÆåÊï¥ÁöÑGDPRÈöêÁßÅÊîøÁ≠ñÈÉ®ÂàÜ ==================== -->
<section id="privacy-policy" class="privacy-policy-section" style="background: #f8f9fa; padding: 2rem; margin-top: 2rem; border-radius: 8px; border-left: 4px solid #004080;">
  <h2 style="color: #004080; margin-bottom: 1.5rem; border-bottom: 2px solid #ff6b00; padding-bottom: 0.5rem;">Informativa sulla Privacy - GDPR Compliant</h2>
  
  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-user-tie"></i> Titolare del Trattamento dei Dati</h3>
    <p><strong>Supershop Bisagno S.R.L.</strong><br>
    Lungobisagno Istria, 29F, 16139 Genova GE<br>
    P.IVA: 02596100996 | REA: GE - 497926<br>
    Email: <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a></p>
    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">In qualit√† di Titolare del Trattamento, La informiamo che i suoi dati personali saranno trattati nel rispetto della normativa vigente, in particolare del Regolamento UE 2016/679 (GDPR).</p>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-database"></i> Tipi di Dati Raccolti</h3>
    <p>Il sito raccoglie i seguenti dati personali[citation:1][citation:3]:</p>
    <ul style="margin-left: 1.5rem;">
      <li><strong>Dati di navigazione</strong>: indirizzo IP, tipo di browser, dispositivo utilizzato, orario di accesso, pagine visitate[citation:5][citation:8]</li>
      <li><strong>Dati di utilizzo</strong>: pagine visitate, tempo di permanenza, percorsi di navigazione[citation:3]</li>
      <li><strong>Dati di contatto</strong>: quando ci contatti via email o tramite moduli di contatto[citation:1]</li>
      <li><strong>Dati tecnici</strong>: cookie e tecnologie simili[citation:1][citation:7]</li>
      <li><strong>Dati di localizzazione</strong>: informazioni generali sulla posizione derivate dall'IP[citation:4]</li>
    </ul>
    <p style="margin-top: 1rem; font-size: 0.9rem; color: #666;"><i class="fas fa-info-circle"></i> <strong>Nota:</strong> Non raccogliamo dati sensibili (come informazioni sanitarie, religiosi, etc.) attraverso questo sito[citation:1].</p>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-bullseye"></i> Finalit√† e Base Giuridica del Trattamento</h3>
    <p>I suoi dati vengono trattati per le seguenti finalit√†[citation:1][citation:5]:</p>
    
    <div style="background: #f0f7ff; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
      <h4 style="color: #004080; margin-bottom: 0.5rem;">Base Giuridica: Esecuzione del Contratto (Art. 6.1.b GDPR)</h4>
      <ul style="margin-left: 1.5rem;">
        <li>Fornire i servizi richiesti attraverso il sito web</li>
        <li>Gestire le richieste di informazioni sui prodotti</li>
        <li>Comunicare variazioni dei servizi[citation:4]</li>
      </ul>
    </div>

    <div style="background: #f0f7ff; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
      <h4 style="color: #004080; margin-bottom: 0.5rem;">Base Giuridica: Legittimo Interesse (Art. 6.1.f GDPR)</h4>
      <ul style="margin-left: 1.5rem;">
        <li>Migliorare la qualit√† del sito e l'esperienza utente</li>
        <li>Prevenire frodi e garantire la sicurezza del sito[citation:4]</li>
        <li>Analisi statistiche anonime dell'utilizzo del sito[citation:8]</li>
      </ul>
    </div>

    <div style="background: #f0f7ff; padding: 1rem; border-radius: 6px; margin: 1rem 0;">
      <h4 style="color: #004080; margin-bottom: 0.5rem;">Base Giuridica: Consenso (Art. 6.1.a GDPR)</h4>
      <ul style="margin-left: 1.5rem;">
        <li>Cookie di marketing e profilazione (solo con consenso esplicito)</li>
        <li>Comunicazioni di marketing diretto[citation:1]</li>
      </ul>
    </div>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-share-alt"></i> Condivisione dei Dati con Terze Parti</h3>
    <p>I suoi dati potrebbero essere condivisi con[citation:1][citation:4]:</p>
    
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
      <thead>
        <tr style="background: #004080; color: white;">
          <th style="padding: 0.8rem; text-align: left;">Categoria</th>
          <th style="padding: 0.8rem; text-align: left;">Finalit√†</th>
          <th style="padding: 0.8rem; text-align: left;">Base Giuridica</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Fornitori di servizi IT</td>
          <td style="padding: 0.8rem;">Hosting, manutenzione, supporto tecnico</td>
          <td style="padding: 0.8rem;">Legittimo interesse</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Google Analytics</td>
          <td style="padding: 0.8rem;">Analisi statistiche del traffico</td>
          <td style="padding: 0.8rem;">Consenso</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Autorit√† competenti</td>
          <td style="padding: 0.8rem;">Adempimenti legali</td>
          <td style="padding: 0.8rem;">Obbligo legale</td>
        </tr>
      </tbody>
    </table>

    <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin-top: 1rem; border-left: 4px solid #ffc107;">
      <p style="margin: 0; color: #856404;"><i class="fas fa-exclamation-triangle"></i> <strong>Trasferimenti internazionali:</strong> Alcuni servizi potrebbero comportare il trasferimento di dati al di fuori dello Spazio Economico Europeo. In tali casi, adotteremo le garanzie contrattuali appropriate[citation:4].</p>
    </div>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-shield-alt"></i> Misure di Sicurezza</h3>
    <p>Adottiamo misure tecniche e organizzative adeguate per proteggere i suoi dati personali[citation:1][citation:7]:</p>
    <ul style="margin-left: 1.5rem;">
      <li><strong>Crittografia</strong> dei dati in transito (HTTPS/TLS)</li>
      <li><strong>Accesso limitato</strong> solo al personale autorizzato</li>
      <li><strong>Backup regolari</strong> e sistemi di recovery</li>
      <li><strong>Monitoraggio continuo</strong> per prevenire accessi non autorizzati</li>
      <li><strong>Procedure di notifica</strong> in caso di violazione dei dati[citation:4]</li>
    </ul>
    
    <div style="background: #e8f5e8; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
      <p style="margin: 0; color: #2d5a2d;"><i class="fas fa-check-circle"></i> <strong>Conformit√† certificata:</strong> I nostri fornitori cloud adottano standard di sicurezza riconosciuti a livello internazionale (ISO 27001, SOC 2)[citation:7].</p>
    </div>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-clock"></i> Conservazione dei Dati</h3>
    <p>Conserviamo i suoi dati personali solo per il tempo necessario al raggiungimento delle finalit√† per cui sono stati raccolti[citation:1][citation:5]:</p>
    
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
      <thead>
        <tr style="background: #004080; color: white;">
          <th style="padding: 0.8rem; text-align: left;">Tipologia Dati</th>
          <th style="padding: 0.8rem; text-align: left;">Periodo di Conservazione</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Dati di navigazione (log)</td>
          <td style="padding: 0.8rem;">14 giorni[citation:8]</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Dati di contatto per richieste</td>
          <td style="padding: 0.8rem;">24 mesi dall'ultimo contatto</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Cookie tecnici</td>
          <td style="padding: 0.8rem;">Durata della sessione o come specificato</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;">Dati per adempimenti legali</td>
          <td style="padding: 0.8rem;">Come richiesto dalla legge (es. 10 anni per documenti fiscali)</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-user-cog"></i> I Suoi Diritti GDPR</h3>
    <p>In conformit√† con il GDPR, Lei ha i seguenti diritti[citation:1][citation:4]:</p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin: 1.5rem 0;">
      <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2196f3;">
        <h4 style="color: #004080; margin-bottom: 0.5rem;">Diritto di Accesso (Art. 15)</h4>
        <p style="margin: 0; font-size: 0.9rem;">Ottenere la conferma che i suoi dati siano trattati e accedere agli stessi.</p>
      </div>
      <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2196f3;">
        <h4 style="color: #004080; margin-bottom: 0.5rem;">Diritto di Rettifica (Art. 16)</h4>
        <p style="margin: 0; font-size: 0.9rem;">Correggere dati inesatti o completare quelli incompleti.</p>
      </div>
      <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2196f3;">
        <h4 style="color: #004080; margin-bottom: 0.5rem;">Diritto alla Cancellazione (Art. 17)</h4>
        <p style="margin: 0; font-size: 0.9rem;">Cancellare i suoi dati ("diritto all'oblio").</p>
      </div>
      <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2196f3;">
        <h4 style="color: #004080; margin-bottom: 0.5rem;">Diritto di Limitazione (Art. 18)</h4>
        <p style="margin: 0; font-size: 0.9rem;">Limitare il trattamento in specifiche circostanze.</p>
      </div>
      <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2196f3;">
        <h4 style="color: #004080; margin-bottom: 0.5rem;">Diritto alla Portabilit√† (Art. 20)</h4>
        <p style="margin: 0; font-size: 0.9rem;">Ricevere i dati in formato strutturato e trasferirli.</p>
      </div>
      <div style="background: #e3f2fd; padding: 1rem; border-radius: 6px; border-left: 4px solid #2196f3;">
        <h4 style="color: #004080; margin-bottom: 0.5rem;">Diritto di Opposizione (Art. 21)</h4>
        <p style="margin: 0; font-size: 0.9rem;">Opporsi al trattamento per motivi legittimi.</p>
      </div>
    </div>

    <div style="background: #e8f5e8; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
      <p style="margin: 0; color: #2d5a2d;"><i class="fas fa-info-circle"></i> <strong>Come esercitare i diritti:</strong> Pu√≤ esercitare i suoi diritti inviando una richiesta a <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a>. Risponderemo entro 30 giorni.</p>
    </div>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-cookie-bite"></i> Cookie Policy Dettagliata</h3>
    <p>Utilizziamo diverse categorie di cookie[citation:1][citation:5]:</p>
    
    <table style="width: 100%; border-collapse: collapse; margin: 1rem 0;">
      <thead>
        <tr style="background: #004080; color: white;">
          <th style="padding: 0.8rem; text-align: left;">Categoria</th>
          <th style="padding: 0.8rem; text-align: left;">Finalit√†</th>
          <th style="padding: 0.8rem; text-align: left;">Base Giuridica</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;"><strong>Cookie Tecnici</strong></td>
          <td style="padding: 0.8rem;">Funzionamento base del sito, sicurezza</td>
          <td style="padding: 0.8rem;">Legittimo interesse</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;"><strong>Cookie Analitici</strong></td>
          <td style="padding: 0.8rem;">Analisi statistiche anonime (Google Analytics)</td>
          <td style="padding: 0.8rem;">Consenso</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;"><strong>Cookie di Profilazione</strong></td>
          <td style="padding: 0.8rem;">Pubblicit√† personalizzata, targeting</td>
          <td style="padding: 0.8rem;">Consenso esplicito</td>
        </tr>
        <tr style="border-bottom: 1px solid #ddd;">
          <td style="padding: 0.8rem;"><strong>Cookie Social Media</strong></td>
          <td style="padding: 0.8rem;">Condivisione contenuti, interazione social</td>
          <td style="padding: 0.8rem;">Consenso</td>
        </tr>
      </tbody>
    </table>

    <div style="background: #fff3cd; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
      <p style="margin: 0; color: #856404;"><i class="fas fa-cog"></i> <strong>Gestione dei Cookie:</strong> Pu√≤ gestire le sue preferenze cookie in qualsiasi momento cliccando sul link "Gestisci Cookie" nel footer del sito o tramite le impostazioni del browser.</p>
    </div>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-child"></i> Protezione dei Minori</h3>
    <p>Il nostro sito non √® destinato a minori di 16 anni. Non raccogliamo consapevolmente dati personali di minori di 16 anni senza il consenso verificabile dei genitori[citation:4].</p>
    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">Se scoprissimo di aver raccolto dati personali di un minore senza il necessario consenso parentale, prenderemo immediatamente provvedimenti per eliminare tali dati.</p>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-exclamation-triangle"></i> Reclami all'Autorit√† Garante</h3>
    <p>Ha il diritto di proporre reclamo all'Autorit√† di controllo competente (Garante per la Protezione dei Dati Personali) se ritiene che il trattamento dei suoi dati personali violi il GDPR[citation:1].</p>
    <p style="margin-top: 0.5rem;"><strong>Autorit√† Garante per la Protezione dei Dati Personali</strong><br>
    Piazza di Monte Citorio, 121<br>
    00186 Roma<br>
    Email: <a href="mailto:protocollo@gpdp.it">protocollo@gpdp.it</a><br>
    PEC: <a href="mailto:protocollo@pec.gpdp.it">protocollo@pec.gpdp.it</a></p>
  </div>

  <div class="privacy-section-block" style="background: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h3 style="color: #004080; margin-bottom: 1rem;"><i class="fas fa-sync-alt"></i> Aggiornamenti alla Privacy Policy</h3>
    <p>Questa privacy policy potrebbe essere aggiornata periodicamente per riflettere cambiamenti nelle nostre pratiche di trattamento dati o per adempiere a nuovi obblighi legali.</p>
    <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">La data dell'ultimo aggiornamento √® indicata in fondo alla pagina. Le modifiche significative saranno comunicate attraverso avvisi prominenti sul nostro sito.</p>
  </div>

  <div class="privacy-section-block" style="background: #004080; color: white; padding: 1.5rem; border-radius: 8px; text-align: center;">
    <h3 style="margin-bottom: 1rem;"><i class="fas fa-question-circle"></i> Domande o Esercizio dei Diritti?</h3>
    <p style="margin-bottom: 1rem;">Per qualsiasi domanda su questa privacy policy o per esercitare i suoi diritti GDPR, non esiti a contattarci:</p>
    <div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;">
      <a href="mailto:supershopbisagnosrl@gmail.com" style="background: #ff6b00; color: white; padding: 0.8rem 1.5rem; border-radius: 6px; text-decoration: none; font-weight: bold; transition: all 0.3s ease;">
        <i class="fas fa-envelope"></i> Invia Email
      </a>
      <button onclick="openCookieSettings()" style="background: transparent; color: white; border: 2px solid white; padding: 0.8rem 1.5rem; border-radius: 6px; cursor: pointer; font-weight: bold; transition: all 0.3s ease;">
        <i class="fas fa-cog"></i> Gestisci Cookie
      </button>
    </div>
  </div>

  <div style="text-align: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #ddd;">
    <p style="color: #666; font-size: 0.9rem;"><i class="fas fa-clock"></i> <strong>Ultimo aggiornamento:</strong> 18 Novembre 2024</p>
    <p style="color: #666; font-size: 0.8rem; margin-top: 0.5rem;">Questa politica √® conforme al Regolamento UE 2016/679 (GDPR) e al D.Lgs. 196/2003 come modificato dal D.Lgs. 101/2018.</p>
  </div>
</section>
  <!-- ÂÖ∂‰ΩôHTMLÂÜÖÂÆπ‰øùÊåÅ‰∏çÂèò -->

</main>

<footer>
  <div class="footer-content">
    <p>¬© <span id="year"></span> Supershop Bisagno S.R.L. ‚Äî Tutti i diritti riservati</p>
    <p>P.IVA: 02596100996 | REA: GE - 497926</p>
    <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.1); border-radius: 6px;">
      <p style="margin: 0; font-size: 0.9rem;">
        <i class="fas fa-qrcode"></i> 
        <strong>Scansiona il QR code in negozio</strong> per scoprire tutti i prodotti e le offerte
      </p>
    </div>
  </div>
</footer>

<a href="#" class="back-to-top" id="backToTop"><i class="fas fa-arrow-up"></i></a>

<!-- ‰∫ßÂìÅÊ®°ÊÄÅÊ°Ü -->
<div id="productModal">
  <div>
    <div style="padding:2rem;">
      <button onclick="closeProductModal()">‚úñ</button>
      <img id="modalImage" src="" alt="" 
           style="width:100%;max-height:400px;object-fit:contain;border-radius:8px;margin-bottom:1.5rem;background:#f8f9fa;padding:1rem;">
      <h2 id="modalName" style="margin-bottom:1rem;color:#333;font-size:1.5rem;line-height:1.3;"></h2>
      
      <div id="modalPrice" style="margin-bottom:1rem;"></div>
      
      <div style="display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:1.5rem;padding:1rem;background:#f8f9fa;border-radius:8px;">
        <span id="modalCategory" style="color:#666;"></span>
        <span id="modalBarcode" style="font-family:monospace;color:#888;"></span>
      </div>
      
      <div style="border-top:1px solid #eee;padding-top:1.5rem;">
        <h3 style="margin-bottom:0.5rem;color:#333;">Descrizione</h3>
        <p id="modalDescription" style="line-height:1.6;color:#555;margin:0;"></p>
      </div>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  // FirebaseÈÖçÁΩÆÂíåÂàùÂßãÂåñ‰ª£Á†Å
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA-cT0zR08IFwYqoTk3dUo2uXHRw-c0rPU",
    authDomain: "supershop-bisagno.firebaseapp.com",
    databaseURL: "https://supershop-bisagno-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "supershop-bisagno",
    storageBucket: "supershop-bisagno.firebasestorage.app",
    messagingSenderId: "381483524192",
    appId: "1:381483524192:web:ac6570bbd5725719e2e305"
  };

  try {
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    console.log("‚úÖ FirebaseÂÆûÊó∂Êï∞ÊçÆÂ∫ìËøûÊé•ÊàêÂäüÔºÅ");
    
    // ËÆæÁΩÆÂÖ®Â±ÄÂèòÈáè‰ª•‰æøÂÖ∂‰ªñÂáΩÊï∞‰ΩøÁî®
    window.firebaseDatabase = database;
    window.firebaseRef = ref;
    window.firebaseSet = set;
    window.firebaseOnValue = onValue;
    window.firebaseRemove = remove;

    // Á´ãÂç≥ÊµãËØïËøûÊé•
    const testRef = ref(database, 'connection_test');
    await set(testRef, { 
      timestamp: new Date().toISOString(),
      status: 'connected_from_github_pages',
      userAgent: navigator.userAgent
    });
    
    console.log("‚úÖ FirebaseËøûÊé•ÊµãËØïÊàêÂäü");
    window.firebaseAvailable = true;
    updateFirebaseStatus(true);
    showSyncStatus('Âú®Á∫ø - FirebaseËøûÊé•Ê≠£Â∏∏', 'success');
    
    // ÂºÄÂßãÁõëÂê¨ËøûÊé•Áä∂ÊÄÅ
    monitorFirebaseConnection();
    
    // ÁõëÂê¨‰∫ßÂìÅÊï∞ÊçÆ
    listenRealtimeProducts();
    
    // ÁõëÂê¨‰ºòÊÉ†ÂÜÖÂÆπ
    initOfferContentListener();
    
  } catch (error) {
    console.error("FirebaseÂàùÂßãÂåñÂ§±Ë¥•:", error);
    window.firebaseAvailable = false;
    updateFirebaseStatus(false);
    showSyncStatus('FirebaseËøûÊé•Â§±Ë¥•: ' + error.code, 'error');
  }

  function monitorFirebaseConnection() {
    if (!window.firebaseDatabase || !window.firebaseRef || !window.firebaseOnValue) return;
    
    const connectedRef = ref(window.firebaseDatabase, '.info/connected');
    onValue(connectedRef, (snap) => {
      const connected = snap.val() === true;
      window.firebaseAvailable = connected;
      updateFirebaseStatus(connected);
      
      if (connected) {
        console.log("‚úÖ Connesso a Firebase");
        showSyncStatus('Connesso a Firebase', 'success');
      } else {
        console.log("‚ùå Disconnesso da Firebase");
        showSyncStatus('Disconnesso - Modalit√† locale', 'warning');
      }
    });
  }

  function listenRealtimeProducts() {
    if (!window.firebaseAvailable || !window.firebaseDatabase || !window.firebaseRef || !window.firebaseOnValue) return;
    
    const productsRef = ref(window.firebaseDatabase, 'products');
    onValue(productsRef, (snapshot) => {
      window.currentRealtimeProducts = snapshot.val() || {};
      renderRealtimeProducts(window.currentRealtimeProducts);
      updateAdminStats();
      renderProducts();
      
      const timestamp = new Date().toLocaleTimeString();
      const lastUpdateElement = document.getElementById('lastUpdate');
      if (lastUpdateElement) {
        lastUpdateElement.innerHTML = `<i class="fas fa-sync"></i> Ultimo aggiornamento: ${timestamp}`;
      }
    });
  }
</script>

<script>
// ==================== ÂÆåÊï¥ÂäüËÉΩJavaScript‰ª£Á†Å ====================

// ÈÖçÁΩÆÂ∏∏Èáè
const ADMIN_CONFIG = {
  ENABLED: true,
  BASE_PASSWORD: 'supershop',
  STATIC_PASSWORDS: ['Supershop@2019!', 'bisagno2025chen'],
  PASSWORD_VALIDITY_HOURS: 24
};

const DEFAULT_IMAGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SW1tYWdpbmUgbm9uIGNhcmljYXRhPC90ZXh0Pjwvc3ZnPg==';

// ÂÖ®Â±ÄÂèòÈáè
let products = [];
let adminAuthenticated = false;
let currentPage = 1;
const productsPerPage = 8;
let filteredProducts = [];

// CookieÁÆ°ÁêÜ
let cookiesAccepted = false;
let cookiePreferences = {
  necessary: true,
  maps: false,
  firebase: false,
  analytics: false
};

// ==================== ÂàùÂßãÂåñÂáΩÊï∞ ====================
function enhancedInit() {
  console.log("üöÄ Avvio inizializzazione avanzata");
  
  // ËÆæÁΩÆÂü∫Á°Ä‰ø°ÊÅØ
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('hiddenAdminBtn').style.display = 'block';
  
  // ÂàùÂßãÂåñ‰∫ßÂìÅÊï∞ÊçÆ
  const savedProducts = loadStorage('supershop_products') || [];
  if (savedProducts.length > 0) {
    products = [...savedProducts];
  }
  
  // Á´ãÂç≥ÊòæÁ§∫‰∫ßÂìÅ
  renderProducts();
  updateAdminStats();
  
  // ÂàùÂßãÂåñCookieÁ≥ªÁªü
  initCookieBanner();
  
  // Á°Æ‰øù‰ºòÊÉ†ÂÜÖÂÆπÁ´ãÂç≥ÊòæÁ§∫
  setTimeout(() => {
    ensureOfferContent();
  }, 500);
  
  // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
  setupEventListeners();
}

// ==================== FIREBASE UPLOAD FUNCTIONS ====================

/**
 * ‰∏ä‰º†ÊâÄÊúâÊú¨Âú∞‰∫ßÂìÅÂà∞Firebase
 */
async function uploadToFirebase() {
  if (!window.firebaseAvailable || !window.firebaseDatabase) {
    alert("‚ùå Firebase‰∏çÂèØÁî®ÔºÅËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåFirebaseÈÖçÁΩÆ„ÄÇ");
    return;
  }

  if (products.length === 0) {
    alert("‚ùå Ê≤°ÊúâÊú¨Âú∞‰∫ßÂìÅÂèØ‰∏ä‰º†ÔºÅ");
    return;
  }

  if (!confirm(`‚ö†Ô∏è Âç≥Â∞Ü‰∏ä‰º† ${products.length} ‰∏™‰∫ßÂìÅÂà∞FirebaseÂÆûÊó∂Êï∞ÊçÆÂ∫ì„ÄÇ\n\nÊ≠§Êìç‰ΩúÂ∞ÜË¶ÜÁõñFirebase‰∏≠ÁöÑÁé∞Êúâ‰∫ßÂìÅÊï∞ÊçÆ„ÄÇ\n\nÁ°ÆÂÆöË¶ÅÁªßÁª≠ÂêóÔºü`)) {
    return;
  }

  showSyncStatus('ÂºÄÂßã‰∏ä‰º†‰∫ßÂìÅÂà∞Firebase...', 'syncing');

  try {
    let successCount = 0;
    let errorCount = 0;
    let skippedCount = 0;

    // ÊâπÈáè‰∏ä‰º†‰∫ßÂìÅ
    for (let i = 0; i < products.length; i++) {
      const product = products[i];
      
      try {
        // Ê£ÄÊü•‰∫ßÂìÅÊï∞ÊçÆÊòØÂê¶ÂÆåÊï¥
        if (!product.id || !product.name) {
          console.warn(`Ë∑≥Ëøá‰∫ßÂìÅ ${i}: Áº∫Â∞ëIDÊàñÂêçÁß∞`, product);
          skippedCount++;
          continue;
        }

        // ÂáÜÂ§áFirebaseÊï∞ÊçÆÊ†ºÂºè
        const firebaseProduct = {
          name: product.name,
          category: product.category || 'regalo',
          price: parsePriceToNumber(product.price) || 0,
          image: product.image || DEFAULT_IMAGE,
          description: product.description || product.name,
          isDiscount: false,
          lastUpdated: new Date().toISOString(),
          createdAt: new Date().toISOString(),
          source: 'local_upload'
        };

        // Â¶ÇÊûúÊúâÊäòÊâ£‰ø°ÊÅØ
        if (product.originalPrice && product.discountPrice) {
          firebaseProduct.isDiscount = true;
          firebaseProduct.discountPrice = parsePriceToNumber(product.discountPrice);
          firebaseProduct.discountPercentage = product.discountPercentage || 
            parseFloat(((parsePriceToNumber(product.originalPrice) - parsePriceToNumber(product.discountPrice)) / 
            parsePriceToNumber(product.originalPrice) * 100).toFixed(2));
          firebaseProduct.discountTagText = product.discountTagText || 'Offerta!';
          firebaseProduct.discountTagColor = product.discountTagColor || '#ff0000';
        }

        // ‰∏ä‰º†Âà∞Firebase
        const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + product.id);
        await window.firebaseSet(productRef, firebaseProduct);
        
        successCount++;
        
        // Êõ¥Êñ∞ËøõÂ∫¶
        if (i % 10 === 0) {
          showSyncStatus(`‰∏ä‰º†‰∏≠... ${i + 1}/${products.length}`, 'syncing');
        }
        
      } catch (error) {
        console.error(`‰∏ä‰º†‰∫ßÂìÅÂ§±Ë¥• ${product.id}:`, error);
        errorCount++;
      }
    }

    // ÊòæÁ§∫ÁªìÊûú
    const message = `‚úÖ ‰∏ä‰º†ÂÆåÊàêÔºÅ\n\n‚Ä¢ ÊàêÂäü: ${successCount}\n‚Ä¢ Â§±Ë¥•: ${errorCount}\n‚Ä¢ Ë∑≥Ëøá: ${skippedCount}\n‚Ä¢ ÊÄªËÆ°: ${products.length}`;
    showSyncStatus(`‰∏ä‰º†ÂÆåÊàê: ${successCount} ÊàêÂäü`, 'success');
    alert(message);

    // ÈáçÊñ∞Âä†ËΩΩÂÆûÊó∂‰∫ßÂìÅ
    if (successCount > 0) {
      setTimeout(() => {
        if (typeof listenRealtimeProducts === 'function') {
          listenRealtimeProducts();
        }
        updateAdminStats();
      }, 1000);
    }

  } catch (error) {
    console.error('‰∏ä‰º†ËøáÁ®ãÂèëÁîüÈîôËØØ:', error);
    showSyncStatus('‰∏ä‰º†Â§±Ë¥•: ' + error.message, 'error');
    alert('‚ùå ‰∏ä‰º†Â§±Ë¥•: ' + error.message);
  }
}

/**
 * Êô∫ËÉΩÂêåÊ≠•ÔºöÂè™‰∏ä‰º†Firebase‰∏≠‰∏çÂ≠òÂú®ÁöÑ‰∫ßÂìÅ
 */
async function syncWithFirebase() {
  if (!window.firebaseAvailable || !window.firebaseDatabase) {
    alert("‚ùå Firebase‰∏çÂèØÁî®ÔºÅ");
    return;
  }

  if (products.length === 0) {
    alert("‚ùå Ê≤°ÊúâÊú¨Âú∞‰∫ßÂìÅÂèØÂêåÊ≠•ÔºÅ");
    return;
  }

  showSyncStatus('Ê≠£Âú®Ê£ÄÊü•ÂêåÊ≠•Áä∂ÊÄÅ...', 'syncing');

  try {
    // Ëé∑ÂèñÂΩìÂâçFirebase‰∫ßÂìÅ
    const currentFirebaseProducts = window.currentRealtimeProducts || {};
    
    let newProducts = [];
    let updatedProducts = [];
    let unchangedProducts = [];

    // ÂàÜÊûêÈúÄË¶ÅÂêåÊ≠•ÁöÑ‰∫ßÂìÅ
    for (const localProduct of products) {
      if (!localProduct.id || !localProduct.name) continue;

      const firebaseProduct = currentFirebaseProducts[localProduct.id];
      
      if (!firebaseProduct) {
        // Firebase‰∏≠‰∏çÂ≠òÂú®ÔºåÈúÄË¶ÅÊñ∞Â¢û
        newProducts.push(localProduct);
      } else {
        // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊõ¥Êñ∞
        if (shouldUpdateProduct(localProduct, firebaseProduct)) {
          updatedProducts.push(localProduct);
        } else {
          unchangedProducts.push(localProduct);
        }
      }
    }

    if (newProducts.length === 0 && updatedProducts.length === 0) {
      showSyncStatus('ÊâÄÊúâ‰∫ßÂìÅÂ∑≤ÂêåÊ≠•', 'success');
      alert('‚úÖ ÊâÄÊúâ‰∫ßÂìÅÂ∑≤ÊòØÊúÄÊñ∞Áä∂ÊÄÅÔºåÊó†ÈúÄÂêåÊ≠•ÔºÅ');
      return;
    }

    const confirmMessage = `ÂèëÁé∞ÈúÄË¶ÅÂêåÊ≠•ÁöÑ‰∫ßÂìÅÔºö\n\n‚Ä¢ Êñ∞‰∫ßÂìÅ: ${newProducts.length}\n‚Ä¢ ÈúÄË¶ÅÊõ¥Êñ∞: ${updatedProducts.length}\n‚Ä¢ Êú™ÂèòÂåñ: ${unchangedProducts.length}\n\nÁ°ÆÂÆöË¶ÅÂºÄÂßãÂêåÊ≠•ÂêóÔºü`;
    
    if (!confirm(confirmMessage)) {
      return;
    }

    showSyncStatus('ÂºÄÂßãÊô∫ËÉΩÂêåÊ≠•...', 'syncing');
    let successCount = 0;
    let errorCount = 0;

    // ‰∏ä‰º†Êñ∞‰∫ßÂìÅ
    for (const product of newProducts) {
      if (await uploadSingleProduct(product)) {
        successCount++;
      } else {
        errorCount++;
      }
    }

    // Êõ¥Êñ∞Áé∞Êúâ‰∫ßÂìÅ
    for (const product of updatedProducts) {
      if (await uploadSingleProduct(product)) {
        successCount++;
      } else {
        errorCount++;
      }
    }

    // ÊòæÁ§∫ÁªìÊûú
    const resultMessage = `‚úÖ ÂêåÊ≠•ÂÆåÊàêÔºÅ\n\n‚Ä¢ ÊàêÂäüÂêåÊ≠•: ${successCount}\n‚Ä¢ Â§±Ë¥•: ${errorCount}\n‚Ä¢ Êñ∞Â¢û: ${newProducts.length}\n‚Ä¢ Êõ¥Êñ∞: ${updatedProducts.length}`;
    showSyncStatus(`ÂêåÊ≠•ÂÆåÊàê: ${successCount} ‰∫ßÂìÅ`, 'success');
    alert(resultMessage);

    // Âà∑Êñ∞Êï∞ÊçÆ
    setTimeout(() => {
      if (typeof listenRealtimeProducts === 'function') {
        listenRealtimeProducts();
      }
      updateAdminStats();
      renderProducts();
    }, 1000);

  } catch (error) {
    console.error('ÂêåÊ≠•ËøáÁ®ãÂèëÁîüÈîôËØØ:', error);
    showSyncStatus('ÂêåÊ≠•Â§±Ë¥•: ' + error.message, 'error');
    alert('‚ùå ÂêåÊ≠•Â§±Ë¥•: ' + error.message);
  }
}

/**
 * ‰∏ä‰º†Âçï‰∏™‰∫ßÂìÅÂà∞Firebase
 */
async function uploadSingleProduct(localProduct) {
  try {
    const firebaseProduct = {
      name: localProduct.name,
      category: localProduct.category || 'regalo',
      price: parsePriceToNumber(localProduct.price) || 0,
      image: localProduct.image || DEFAULT_IMAGE,
      description: localProduct.description || localProduct.name,
      isDiscount: false,
      lastUpdated: new Date().toISOString(),
      createdAt: localProduct.createdAt || new Date().toISOString(),
      source: 'local_sync'
    };

    // Â§ÑÁêÜÊäòÊâ£‰ø°ÊÅØ
    if (localProduct.originalPrice && localProduct.discountPrice) {
      firebaseProduct.isDiscount = true;
      firebaseProduct.discountPrice = parsePriceToNumber(localProduct.discountPrice);
      firebaseProduct.discountPercentage = localProduct.discountPercentage || 
        parseFloat(((parsePriceToNumber(localProduct.originalPrice) - parsePriceToNumber(localProduct.discountPrice)) / 
        parsePriceToNumber(localProduct.originalPrice) * 100).toFixed(2));
      firebaseProduct.discountTagText = localProduct.discountTagText || 'Offerta!';
      firebaseProduct.discountTagColor = localProduct.discountTagColor || '#ff0000';
    }

    const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + localProduct.id);
    await window.firebaseSet(productRef, firebaseProduct);
    return true;

  } catch (error) {
    console.error(`‰∏ä‰º†‰∫ßÂìÅÂ§±Ë¥• ${localProduct.id}:`, error);
    return false;
  }
}

/**
 * Ê£ÄÊü•‰∫ßÂìÅÊòØÂê¶ÈúÄË¶ÅÊõ¥Êñ∞
 */
function shouldUpdateProduct(localProduct, firebaseProduct) {
  // Ê£ÄÊü•Âü∫Êú¨‰ø°ÊÅØÊòØÂê¶ÂèòÂåñ
  if (localProduct.name !== firebaseProduct.name) return true;
  if (localProduct.category !== firebaseProduct.category) return true;
  
  // Ê£ÄÊü•‰ª∑Ê†ºÊòØÂê¶ÂèòÂåñ
  const localPrice = parsePriceToNumber(localProduct.price);
  if (localPrice !== firebaseProduct.price) return true;
  
  // Ê£ÄÊü•ÊäòÊâ£‰ø°ÊÅØ
  const localHasDiscount = !!(localProduct.originalPrice && localProduct.discountPrice);
  if (localHasDiscount !== firebaseProduct.isDiscount) return true;
  
  if (localHasDiscount) {
    const localDiscountPrice = parsePriceToNumber(localProduct.discountPrice);
    if (localDiscountPrice !== firebaseProduct.discountPrice) return true;
  }
  
  return false;
}

/**
 * Â∞Ü‰ª∑Ê†ºÂ≠óÁ¨¶‰∏≤ËΩ¨Êç¢‰∏∫Êï∞Â≠ó
 */
function parsePriceToNumber(priceStr) {
  if (!priceStr) return 0;
  if (typeof priceStr === 'number') return priceStr;
  
  // Â§ÑÁêÜ "‚Ç¨10,00" Ê†ºÂºè
  const cleanStr = priceStr.toString()
    .replace('‚Ç¨', '')
    .replace(',', '.')
    .trim();
  
  const number = parseFloat(cleanStr);
  return isNaN(number) ? 0 : number;
}

/**
 * ÊâπÈáèÂà†Èô§Firebase‰∏≠ÁöÑ‰∫ßÂìÅ
 */
async function clearFirebaseProducts() {
  if (!window.firebaseAvailable || !window.firebaseDatabase) {
    alert("‚ùå Firebase‰∏çÂèØÁî®ÔºÅ");
    return;
  }

  if (!confirm("‚ö†Ô∏è Âç±Èô©Êìç‰ΩúÔºÅ\n\nËøôÂ∞ÜÂà†Èô§Firebase‰∏≠ÁöÑÊâÄÊúâ‰∫ßÂìÅÊï∞ÊçÆ„ÄÇ\n\nÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ\n\nÁ°ÆÂÆöË¶ÅÁªßÁª≠ÂêóÔºü")) {
    return;
  }

  if (!confirm("‚ÄºÔ∏è ÊúÄÂêé‰∏ÄÊ¨°Á°ÆËÆ§Ôºö\n\nÊÇ®Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫Firebase‰∫ßÂìÅÊï∞ÊçÆÂ∫ìÂêóÔºü")) {
    return;
  }

  try {
    showSyncStatus('Ê≠£Âú®Ê∏ÖÁ©∫Firebase‰∫ßÂìÅ...', 'syncing');
    
    const productsRef = window.firebaseRef(window.firebaseDatabase, 'products');
    await window.firebaseSet(productsRef, null);
    
    showSyncStatus('Firebase‰∫ßÂìÅÊï∞ÊçÆÂ∑≤Ê∏ÖÁ©∫', 'success');
    alert('‚úÖ Firebase‰∫ßÂìÅÊï∞ÊçÆÂ∑≤ÊàêÂäüÊ∏ÖÁ©∫ÔºÅ');
    
    // Âà∑Êñ∞Êï∞ÊçÆ
    setTimeout(() => {
      if (typeof listenRealtimeProducts === 'function') {
        listenRealtimeProducts();
      }
      updateAdminStats();
      renderProducts();
    }, 1000);
    
  } catch (error) {
    console.error('Ê∏ÖÁ©∫Firebase‰∫ßÂìÅÂ§±Ë¥•:', error);
    showSyncStatus('Ê∏ÖÁ©∫Â§±Ë¥•: ' + error.message, 'error');
    alert('‚ùå Ê∏ÖÁ©∫Â§±Ë¥•: ' + error.message);
  }
}

/**
 * ÂØπÊØîÊú¨Âú∞ÂíåFirebaseÊï∞ÊçÆ
 */
async function compareLocalFirebase() {
  if (!window.firebaseAvailable) {
    alert("‚ùå Firebase‰∏çÂèØÁî®ÔºÅ");
    return;
  }

  const localProducts = products;
  const firebaseProducts = window.currentRealtimeProducts || {};
  
  const firebaseIds = Object.keys(firebaseProducts);
  const localIds = localProducts.map(p => p.id);
  
  const onlyInLocal = localProducts.filter(p => !firebaseProducts[p.id]);
  const onlyInFirebase = firebaseIds.filter(id => !localIds.includes(id));
  const inBoth = localIds.filter(id => firebaseIds.includes(id));
  
  const comparison = {
    'Êú¨Âú∞‰∫ßÂìÅÊÄªÊï∞': localProducts.length,
    'Firebase‰∫ßÂìÅÊÄªÊï∞': firebaseIds.length,
    '‰ªÖÂ≠òÂú®‰∫éÊú¨Âú∞': onlyInLocal.length,
    '‰ªÖÂ≠òÂú®‰∫éFirebase': onlyInFirebase.length,
    '‰∏§ËÄÖÈÉΩÂ≠òÂú®': inBoth.length
  };
  
  let message = 'üìä Êï∞ÊçÆÂØπÊØîÁªìÊûú:\n\n';
  Object.entries(comparison).forEach(([key, value]) => {
    message += `‚Ä¢ ${key}: ${value}\n`;
  });
  
  if (onlyInLocal.length > 0) {
    message += `\nüìã ‰ªÖÂ≠òÂú®‰∫éÊú¨Âú∞ÁöÑ‰∫ßÂìÅ:\n`;
    onlyInLocal.slice(0, 10).forEach(p => {
      message += `  - ${p.name} (${p.id})\n`;
    });
    if (onlyInLocal.length > 10) {
      message += `  ... ËøòÊúâ ${onlyInLocal.length - 10} ‰∏™‰∫ßÂìÅ\n`;
    }
  }
  
  alert(message);
}

// ==================== ÊâπÈáèÂØºÂÖ•ÂäüËÉΩ ====================
function importProducts() {
  console.log("üöÄ Avvio importazione prodotti...");
  
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.csv,.json,.txt';
  fileInput.style.display = 'none';
  
  fileInput.onchange = function(event) {
    const file = event.target.files[0];
    if (!file) {
      console.log("‚ùå Nessun file selezionato");
      return;
    }
    
    console.log("üìÅ File selezionato:", file.name, file.size, "bytes");
    
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        console.log("üìñ Lettura file completata");
        const content = e.target.result;
        console.log("üìÑ Contenuto file:", content.substring(0, 200) + "...");
        
        let productsArray = [];
        
        if (file.name.toLowerCase().endsWith('.csv')) {
          console.log("üîß Parsing CSV...");
          productsArray = parseCSVData(content);
        } else if (file.name.toLowerCase().endsWith('.json')) {
          console.log("üîß Parsing JSON...");
          productsArray = JSON.parse(content);
        } else {
          alert('Formato file non supportato. Usa CSV o JSON.');
          return;
        }
        
        console.log("üìä Prodotti parsati:", productsArray);
        
        if (productsArray.length > 0) {
          importProductsToLocal(productsArray);
        } else {
          alert('Nessun prodotto valido trovato nel file');
          console.log("‚ùå Nessun prodotto valido trovato");
        }
      } catch (error) {
        console.error("‚ùå Errore nella lettura del file:", error);
        alert('Errore nella lettura del file: ' + error.message);
      }
    };
    
    reader.onerror = function(error) {
      console.error("‚ùå Errore lettura file:", error);
      alert('Errore nella lettura del file');
    };
    
    reader.readAsText(file);
  };
  
  document.body.appendChild(fileInput);
  fileInput.click();
  document.body.removeChild(fileInput);
  
  console.log("‚úÖ Input file creato e attivato");
}

function parseCSVData(csvText) {
  console.log("üîß Inizio parsing CSV...");
  
  const lines = csvText.split('\n').filter(line => line.trim() && !line.startsWith('//'));
  console.log("üìù Linee trovate:", lines.length);
  
  if (lines.length < 2) {
    console.log("‚ùå CSV troppo corto");
    return [];
  }
  
  const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/"/g, ''));
  console.log("üìã Headers:", headers);
  
  const products = [];
  
  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    
    console.log(`üìù Processamento linea ${i}:`, line);
    
    try {
      const values = [];
      let currentValue = '';
      let inQuotes = false;
      
      for (let char of line) {
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          values.push(currentValue.trim());
          currentValue = '';
        } else {
          currentValue += char;
        }
      }
      values.push(currentValue.trim());
      
      const cleanValues = values.map(v => v.replace(/^"(.*)"$/, '$1'));
      console.log(`üîß Valori puliti linea ${i}:`, cleanValues);
      
      const product = {};
      
      headers.forEach((header, index) => {
        if (index < cleanValues.length) {
          product[header] = cleanValues[index] || '';
        }
      });
      
      console.log(`üì¶ Prodotto grezzo linea ${i}:`, product);
      
      const id = product.codice || product.id || product.barcode || `temp_${Date.now()}_${i}`;
      const name = product.nome || product.name || product.productname || 'Prodotto senza nome';
      
      if (!id || !name) {
        console.log(`‚ö†Ô∏è Salto prodotto ${i}: ID o nome mancante`);
        continue;
      }
      
      const mappedProduct = {
        id: id,
        name: name,
        category: product.categoria || product.category || 'regalo',
        image: product.immagine || product.image || product.img || window.DEFAULT_IMAGE,
        description: product.descrizione || product.description || product.desc || name
      };
      
      const prezzo = product.prezzo || product.price;
      if (prezzo && prezzo !== '0' && prezzo !== '0,00') {
        const priceNum = parseFloat(prezzo.toString().replace(',', '.').replace('‚Ç¨', ''));
        if (!isNaN(priceNum) && priceNum > 0) {
          mappedProduct.price = formatPrice(priceNum);
        }
      }
      
      if (!mappedProduct.price) {
        mappedProduct.price = '‚Ç¨0,00';
      }
      
      console.log(`‚úÖ Prodotto mappato linea ${i}:`, mappedProduct);
      products.push(mappedProduct);
      
    } catch (error) {
      console.error(`‚ùå Errore processamento linea ${i}:`, error, line);
    }
  }
  
  console.log("üìä Prodotti finali:", products);
  return products;
}

function importProductsToLocal(productsArray) {
  console.log("üíæ Inizio importazione in localStorage...");
  console.log("üì¶ Prodotti da importare:", productsArray);
  
  let importedCount = 0;
  let updatedCount = 0;
  let errorCount = 0;
  
  productsArray.forEach((newProduct, index) => {
    try {
      console.log(`üîß Processamento prodotto ${index}:`, newProduct);
      
      if (!newProduct.id || !newProduct.name) {
        console.log(`‚ö†Ô∏è Prodotto ${index} non valido:`, newProduct);
        errorCount++;
        return;
      }
      
      const existingIndex = products.findIndex(p => p.id === newProduct.id);
      
      if (existingIndex >= 0) {
        console.log(`üîÑ Aggiornamento prodotto esistente: ${newProduct.id}`);
        products[existingIndex] = { ...products[existingIndex], ...newProduct };
        updatedCount++;
      } else {
        console.log(`‚ûï Aggiunta nuovo prodotto: ${newProduct.id}`);
        products.push(newProduct);
        importedCount++;
      }
    } catch (error) {
      console.error(`‚ùå Errore processamento prodotto ${index}:`, error);
      errorCount++;
    }
  });
  
  console.log("üíæ Salvataggio in localStorage...");
  saveStorage('supershop_products', products);
  
  console.log("üîÑ Aggiornamento interfaccia...");
  renderProducts();
  updateAdminStats();
  
  const message = `Importazione completata!\n\n‚Ä¢ Nuovi prodotti: ${importedCount}\n‚Ä¢ Prodotti aggiornati: ${updatedCount}\n‚Ä¢ Errori: ${errorCount}\n‚Ä¢ Totale prodotti: ${products.length}`;
  
  console.log("‚úÖ " + message);
  showSyncStatus(`Import: ${importedCount} nuovi, ${updatedCount} aggiornati`, 'success');
  alert(message);
}

// ==================== ÊâπÈáèÂà†Èô§ÂäüËÉΩ ====================
function batchDeleteProducts() {
  if (!confirm("‚ö†Ô∏è Sei sicuro di voler eliminare TUTTI i prodotti?\n\nQuesta operazione non pu√≤ essere annullata!")) {
    return;
  }
  
  products = [];
  saveStorage('supershop_products', products);
  renderProducts();
  updateAdminStats();
  
  showSyncStatus('Tutti i prodotti sono stati eliminati', 'success');
  alert('‚úÖ Tutti i prodotti sono stati eliminati con successo!');
}

function selectiveBatchDelete() {
  const searchTerm = prompt("Inserisci il termine di ricerca per eliminare prodotti:\n\n‚Ä¢ Lascia vuoto per vedere tutti i prodotti\n‚Ä¢ Inserisci categoria (es: natale)\n‚Ä¢ Inserisci parte del nome\n‚Ä¢ Inserisci codice a barre");
  
  if (searchTerm === null) return;
  
  const allProducts = getAllMergedProducts();
  let productsToDelete = [];
  
  if (!searchTerm) {
    productsToDelete = allProducts;
  } else {
    const searchLower = searchTerm.toLowerCase();
    productsToDelete = allProducts.filter(p => 
      p.name.toLowerCase().includes(searchLower) ||
      p.category.toLowerCase().includes(searchLower) ||
      p.id.includes(searchTerm)
    );
  }
  
  if (productsToDelete.length === 0) {
    alert("Nessun prodotto trovato con i criteri di ricerca.");
    return;
  }
  
  const productList = productsToDelete.map(p => 
    `‚Ä¢ ${p.name} (${p.id}) - ${p.category}`
  ).join('\n');
  
  if (confirm(`Trovati ${productsToDelete.length} prodotti:\n\n${productList}\n\nVuoi eliminare questi prodotti?`)) {
    deleteProductsByList(productsToDelete);
  }
}

function deleteProductsByList(productsToDelete) {
  let deletedCount = 0;
  
  productsToDelete.forEach(productToDelete => {
    const localIndex = products.findIndex(p => p.id === productToDelete.id);
    if (localIndex >= 0) {
      products.splice(localIndex, 1);
      deletedCount++;
    }
    
    if (window.firebaseAvailable && window.currentRealtimeProducts[productToDelete.id]) {
      const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + productToDelete.id);
      window.firebaseRemove(productRef)
        .then(() => console.log(`Eliminato da Firebase: ${productToDelete.id}`))
        .catch(err => console.error(`Errore eliminazione Firebase: ${err}`));
    }
  });
  
  saveStorage('supershop_products', products);
  renderProducts();
  updateAdminStats();
  
  showSyncStatus(`Eliminati ${deletedCount} prodotti`, 'success');
  alert(`‚úÖ Eliminati ${deletedCount} prodotti con successo!`);
}

function deleteByCategory() {
  const categories = {
    'regalo': 'Articoli Regalo',
    'giocattoli': 'Giocattoli', 
    'cartoleria': 'Cartoleria',
    'casalinghi': 'Casalinghi',
    'ferramenta': 'Ferramenta',
    'animali': 'Articoli per animali',
    'illuminazione': 'Illuminazione', 
    'mobili': 'Mobili',
    'natale': 'Articoli Natalizi'
  };
  
  let categoryList = "Scegli categoria da eliminare:\n\n";
  Object.entries(categories).forEach(([key, value], index) => {
    categoryList += `${index + 1}. ${value}\n`;
  });
  
  const choice = prompt(categoryList + "\nInserisci il numero della categoria:");
  if (choice === null) return;
  
  const categoryKeys = Object.keys(categories);
  const selectedKey = categoryKeys[parseInt(choice) - 1];
  
  if (!selectedKey) {
    alert("Selezione non valida!");
    return;
  }
  
  const productsInCategory = products.filter(p => p.category === selectedKey);
  
  if (productsInCategory.length === 0) {
    alert(`Nessun prodotto trovato nella categoria: ${categories[selectedKey]}`);
    return;
  }
  
  if (confirm(`Trovati ${productsInCategory.length} prodotti in ${categories[selectedKey]}.\n\nVuoi eliminare tutti questi prodotti?`)) {
    deleteProductsByList(productsInCategory);
  }
}

// ==================== ÂØºÂá∫ÂäüËÉΩ ====================
function exportProducts() {
  const allProducts = getAllMergedProducts();
  
  if (allProducts.length === 0) {
    alert("Nessun prodotto da esportare!");
    return;
  }
  
  let csvContent = "codice,nome,categoria,prezzo,immagine,descrizione,origine\n";
  
  allProducts.forEach(product => {
    const row = [
      product.id,
      `"${product.name.replace(/"/g, '""')}"`,
      product.category,
      product.price ? product.price.replace('‚Ç¨', '').replace(',', '.') : '0',
      product.image,
      `"${(product.description || '').replace(/"/g, '""')}"`,
      product.source || 'locale'
    ].join(',');
    
    csvContent += row + '\n';
  });
  
  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
  const link = document.createElement('a');
  const url = URL.createObjectURL(blob);
  
  link.setAttribute('href', url);
  link.setAttribute('download', `supershop_prodotti_${new Date().toISOString().split('T')[0]}.csv`);
  link.style.visibility = 'hidden';
  
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  
  showSyncStatus(`Esportati ${allProducts.length} prodotti`, 'success');
}

// ==================== Â∑•ÂÖ∑ÂáΩÊï∞ ====================
function formatPrice(amount) {
  if (typeof amount === 'string' && amount.includes('‚Ç¨')) {
    return amount;
  }
  const num = typeof amount === 'string' ? parseFloat(amount.replace(',', '.')) : amount;
  return `‚Ç¨${num.toFixed(2).replace('.', ',')}`;
}

const saveStorage = (key, val) => { 
  try { 
    localStorage.setItem(key, JSON.stringify(val)); 
  } catch(e) {
    console.error('Errore nel salvataggio:', e);
  } 
};

const loadStorage = key => { 
  try { 
    return JSON.parse(localStorage.getItem(key)); 
  } catch(e) { 
    console.error('Errore nel caricamento:', e);
    return null; 
  } 
};

const showSyncStatus = (msg, type = 'success') => {
  const s = document.getElementById('sync-status'); 
  const t = document.getElementById('sync-text');
  if (s && t) {
    t.textContent = msg; 
    s.className = 'sync-status ' + type; 
    s.style.display = 'flex';
    setTimeout(() => s.style.display = 'none', 3000);
  }
};

// ==================== ‰∫ã‰ª∂ÁõëÂê¨Âô®ËÆæÁΩÆ ====================
function setupEventListeners() {
  const productSearch = document.getElementById('product-search');
  const categoryFilter = document.getElementById('category-filter');
  const loadMoreBtn = document.getElementById('load-more');
  
  if (productSearch) {
    productSearch.addEventListener('input', () => {
      currentPage = 1;
      renderProducts();
    });
  }
  
  if (categoryFilter) {
    categoryFilter.addEventListener('change', () => {
      currentPage = 1;
      renderProducts();
    });
  }
  
  if (loadMoreBtn) {
    loadMoreBtn.addEventListener('click', () => {
      currentPage++;
      renderProducts();
    });
  }
  
  // ÁÆ°ÁêÜÂëòÊåâÈíÆ
  const hiddenAdminBtn = document.getElementById('hiddenAdminBtn');
  const adminBtn = document.getElementById('adminBtn');
  
  if (hiddenAdminBtn) {
    hiddenAdminBtn.addEventListener('click', enableAdminPanel);
  }
  
  if (adminBtn) {
    adminBtn.addEventListener('click', enableAdminPanel);
  }
  
  // ÁßªÂä®ËèúÂçï
  const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
  if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener('click', function() {
      const nav = document.getElementById('navMenu');
      if (nav) {
        nav.style.display = nav.style.display === 'flex' ? 'none' : 'flex';
      }
    });
  }
  
  // ËøîÂõûÈ°∂ÈÉ®
  const backToTop = document.getElementById('backToTop');
  if (backToTop) {
    window.addEventListener('scroll', () => {
      backToTop.classList.toggle('visible', window.pageYOffset > 300);
    });
    
    backToTop.addEventListener('click', (e) => {
      e.preventDefault();
      window.scrollTo({top: 0, behavior: 'smooth'});
    });
  }
}

// ==================== DOMÂä†ËΩΩÂàùÂßãÂåñ ====================
document.addEventListener('DOMContentLoaded', function() {
  console.log("üìÑ DOM caricato - Avvio inizializzazione");
  enhancedInit();
});

window.addEventListener('load', function() {
  console.log("üñºÔ∏è Pagina completamente caricata");
  setTimeout(() => {
    ensureOfferContent();
  }, 1000);
});

// ÂÖ∂‰ªñËæÖÂä©ÂáΩÊï∞...
function getAllMergedProducts() {
  const allProducts = [...products];
  
  if (window.firebaseAvailable) {
    Object.entries(window.currentRealtimeProducts).forEach(([barcode, realtimeProduct]) => {
      const convertedProduct = convertRealtimeToLocal(realtimeProduct, barcode);
      
      const existingIndex = allProducts.findIndex(p => p.id === barcode);
      if (existingIndex >= 0) {
        allProducts[existingIndex] = { ...allProducts[existingIndex], ...convertedProduct, source: 'firebase' };
      } else {
        allProducts.push(convertedProduct);
      }
    });
  }
  
  return allProducts;
}

function convertRealtimeToLocal(realtimeProduct, barcode) {
  const price = realtimeProduct.price || 0;
  const discountPrice = realtimeProduct.discountPrice;
  const isDiscount = realtimeProduct.isDiscount && discountPrice;
  
  return {
    id: barcode,
    name: realtimeProduct.name || 'Prodotto senza nome',
    category: realtimeProduct.category || 'regalo',
    image: realtimeProduct.image || DEFAULT_IMAGE,
    description: realtimeProduct.description || realtimeProduct.name || 'Descrizione non disponibile',
    originalPrice: isDiscount ? formatPrice(price) : undefined,
    discountPrice: isDiscount ? formatPrice(discountPrice) : undefined,
    price: !isDiscount ? formatPrice(price) : undefined,
    discountPercentage: isDiscount ? 
      parseFloat(((price - discountPrice) / price * 100).toFixed(2)) : 0,
    isDiscount: isDiscount,
    discountTagText: realtimeProduct.discountTagText || 'Offerta!',
    discountTagColor: realtimeProduct.discountTagColor || '#ff0000',
    lastUpdated: realtimeProduct.lastUpdated,
    createdAt: realtimeProduct.createdAt,
    source: 'firebase'
  };
}

// Ê∏≤Êüì‰∫ßÂìÅÂáΩÊï∞
function renderProducts() {
  const container = document.getElementById('products-container');
  if (!container) return;
  
  const search = document.getElementById('product-search').value.toLowerCase();
  const category = document.getElementById('category-filter').value;
  
  const allProducts = getAllMergedProducts();
  
  filteredProducts = allProducts.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(search) || p.id.includes(search);
    const matchesCategory = category === 'all' || p.category === category;
    return matchesSearch && matchesCategory;
  });
  
  const end = currentPage * productsPerPage;
  const productsToShow = filteredProducts.slice(0, end);
  
  if (productsToShow.length === 0) {
    container.innerHTML = `
      <div style="grid-column:1/-1;text-align:center;padding:3rem;color:#666;">
        <i class="fas fa-search" style="font-size:3rem;margin-bottom:1rem;"></i>
        <h3>Nessun prodotto trovato</h3>
        <p>Prova a modificare i criteri di ricerca</p>
      </div>
    `;
  } else {
    container.innerHTML = productsToShow.map(product => createProductCard(product)).join('');
  }
  
  const loadMoreBtn = document.getElementById('load-more');
  if (loadMoreBtn) {
    loadMoreBtn.style.display = end < filteredProducts.length ? 'block' : 'none';
  }
}

function createProductCard(product) {
  const hasDiscount = product.discountPrice && product.originalPrice;
  const isRealtime = product.source === 'firebase';
  
  return `
    <div class="product-card" onclick="openProductModal('${product.id}')">
      <img src="${product.image}" alt="${product.name}" class="product-image" 
           onerror="this.src='${DEFAULT_IMAGE}'">
      ${hasDiscount ? `<div class="discount-badge">-${product.discountPercentage}%</div>` : ''}
      ${isRealtime ? `<div class="discount-badge" style="background:#004080;top:40px;"><i class="fas fa-bolt"></i> Live</div>` : ''}
      <div class="product-info">
        <div class="product-name">${product.name}</div>
        <div class="product-price-container">
          ${hasDiscount ? 
            `<span class="original-price">${product.originalPrice}</span><span class="discount-price">${product.discountPrice}</span>` : 
            `<span class="discount-price">${product.price || 'Prezzo su richiesta'}</span>`
          }
        </div>
        <span class="product-category">${getCategoryName(product.category)}</span>
        <div class="product-barcode-small">Codice: ${product.id}</div>
        ${isRealtime ? `<div class="product-barcode-small" style="color:#004080;"><i class="fas fa-sync"></i> Aggiornato in tempo reale</div>` : ''}
      </div>
    </div>
  `;
}

function getCategoryName(category) {
  const categories = {
    'regalo': 'Articoli Regalo',
    'giocattoli': 'Giocattoli',
    'cartoleria': 'Cartoleria',
    'casalinghi': 'Casalinghi',
    'ferramenta': 'Ferramenta',
    'animali': 'Articoli per animali',
    'illuminazione': 'Illuminazione',
    'mobili': 'Mobili',
    'natale': 'Articoli Natalizi'
  };
  return categories[category] || category;
}

// ‰∫ßÂìÅÊ®°ÊÄÅÊ°ÜÂäüËÉΩ
function openProductModal(productId) {
  const allProducts = getAllMergedProducts();
  const p = allProducts.find(x => x.id === productId);
  
  if(!p) {
    console.error("Prodotto non trovato:", productId);
    return;
  }
  
  const modal = document.getElementById('productModal');
  if (!modal) {
    console.error("Modal non trovato nel DOM");
    return;
  }
  
  try {
    const modalImage = document.getElementById('modalImage');
    if (modalImage) {
      modalImage.src = p.image || DEFAULT_IMAGE;
      modalImage.onerror = function() {
        this.src = DEFAULT_IMAGE;
      };
    }
    
    const modalName = document.getElementById('modalName');
    if (modalName) {
      modalName.textContent = p.name || 'Prodotto senza nome';
    }
    
    const modalPrice = document.getElementById('modalPrice');
    if (modalPrice) {
      if (p.discountPrice && p.originalPrice) {
        modalPrice.innerHTML = `
          <div style="display:flex;align-items:center;flex-wrap:wrap;gap:0.5rem;">
            <span style="font-size:1.5rem;font-weight:bold;color:#e74c3c;">${p.discountPrice}</span>
            <span style="color:#999;text-decoration:line-through;">${p.originalPrice}</span>
            <span style="background:#e74c3c;color:white;padding:4px 8px;border-radius:4px;font-size:0.9rem;font-weight:bold;">
              -${p.discountPercentage}%
            </span>
          </div>
        `;
      } else {
        modalPrice.innerHTML = `
          <span style="font-size:1.5rem;font-weight:bold;color:#004080;">
            ${p.price || 'Prezzo su richiesta'}
          </span>
        `;
      }
    }
    
    const modalCategory = document.getElementById('modalCategory');
    const modalBarcode = document.getElementById('modalBarcode');
    if (modalCategory) modalCategory.textContent = 'Categoria: ' + (getCategoryName(p.category) || 'Generale');
    if (modalBarcode) modalBarcode.textContent = 'Codice: ' + p.id;
    
    const modalDescription = document.getElementById('modalDescription');
    if (modalDescription) {
      modalDescription.textContent = p.description || 'Nessuna descrizione disponibile per questo prodotto.';
    }
    
    modal.style.display = 'block';
    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';
    
  } catch (error) {
    console.error("Errore nell'apertura del modal:", error);
    alert("Si √® verificato un errore nel caricamento del prodotto");
  }
}

function closeProductModal(){
  const modal = document.getElementById('productModal');
  if (modal) {
    modal.style.display = 'none';
  }
  
  document.body.style.overflow = 'auto';
  document.documentElement.style.overflow = 'auto';
}

// Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
document.getElementById('productModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeProductModal();
  }
});

document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' || e.keyCode === 27) {
    const modal = document.getElementById('productModal');
    if (modal.style.display === 'block') {
      closeProductModal();
    }
  }
});

// ÁÆ°ÁêÜÂëòÈù¢ÊùøÂäüËÉΩ
function enableAdminPanel() {
  const pwd = prompt('üîê Accesso Amministratore\n\nInserisci la password:');
  if (validateAdminPassword(pwd)) { 
    adminAuthenticated = true; 
    openAdminPanel(); 
    showSyncStatus('Accesso amministratore autorizzato','success'); 
  } else if (pwd !== null) {
    alert('‚ùå Password non valida');
  }
}

function validateAdminPassword(inputPassword) {
  const today = new Date();
  const dynamicPassword = ADMIN_CONFIG.BASE_PASSWORD + 
         today.getDate().toString().padStart(2, '0') + 
         (today.getMonth() + 1).toString().padStart(2, '0');
  return inputPassword === dynamicPassword || 
         ADMIN_CONFIG.STATIC_PASSWORDS.includes(inputPassword);
}

function openAdminPanel() {
  document.getElementById('adminPanel').classList.add('active');
  document.getElementById('adminOverlay').classList.add('active');
  updateAdminStats();
}

function closeAdminPanel() {
  document.getElementById('adminPanel').classList.remove('active');
  document.getElementById('adminOverlay').classList.remove('active');
}

document.getElementById('adminOverlay').addEventListener('click', closeAdminPanel);

function updateAdminStats() {
  const allProducts = getAllMergedProducts();
  const totalProductsElement = document.getElementById('totalProducts');
  const totalCategoriesElement = document.getElementById('totalCategories');
  const realtimeProductsElement = document.getElementById('realtimeProducts');
  
  if (totalProductsElement) {
    totalProductsElement.textContent = allProducts.length;
  }
  
  if (totalCategoriesElement) {
    const categories = new Set(allProducts.map(p => p.category));
    totalCategoriesElement.textContent = categories.size;
  }
  
  if (realtimeProductsElement) {
    const realtimeCount = window.firebaseAvailable ? Object.keys(window.currentRealtimeProducts).length : 0;
    realtimeProductsElement.textContent = realtimeCount;
  }
}

// ÂÖ∂‰ªñÁÆ°ÁêÜÂäüËÉΩÂç†‰ΩçÁ¨¶
function addProduct() {
  alert("Funzione aggiungi prodotto locale - da implementare");
}

function backupData() {
  alert("Funzione backup dati - da implementare");
}

function clearAllData() {
  alert("Funzione cancella tutto - da implementare");
}

function syncAllProducts() {
  syncWithFirebase();
}

function migrateToFirebase() {
  uploadToFirebase();
}

// CookieÁÆ°ÁêÜÂáΩÊï∞
function initCookieBanner() {
  const savedPreferences = getCookie('cookiePreferences');
  
  if (savedPreferences) {
    cookiePreferences = JSON.parse(savedPreferences);
    cookiesAccepted = true;
    applyCookiePreferences();
  } else {
    setTimeout(() => {
      document.getElementById('cookie-banner').style.display = 'block';
    }, 1000);
  }
}

function acceptAllCookies() {
  cookiePreferences = {
    necessary: true,
    maps: true,
    firebase: true,
    analytics: true
  };
  saveCookiePreferences();
  hideCookieBanner();
}

function acceptNecessaryCookies() {
  cookiePreferences = {
    necessary: true,
    maps: false,
    firebase: false,
    analytics: false
  };
  saveCookiePreferences();
  hideCookieBanner();
}

function openCookieSettings() {
  document.getElementById('cookie-settings').style.display = 'flex';
  document.getElementById('maps-cookies').checked = cookiePreferences.maps;
  document.getElementById('firebase-cookies').checked = cookiePreferences.firebase;
  document.getElementById('analytics-cookies').checked = cookiePreferences.analytics;
}

function closeCookieSettings() {
  document.getElementById('cookie-settings').style.display = 'none';
}

function saveCookiePreferences() {
  cookiePreferences.maps = document.getElementById('maps-cookies').checked;
  cookiePreferences.firebase = document.getElementById('firebase-cookies').checked;
  cookiePreferences.analytics = document.getElementById('analytics-cookies').checked;
  
  setCookie('cookiePreferences', JSON.stringify(cookiePreferences), 365);
  cookiesAccepted = true;
  applyCookiePreferences();
  closeCookieSettings();
  hideCookieBanner();
  showCookieConfirmation();
}

function applyCookiePreferences() {
  if (cookiePreferences.maps) {
    loadGoogleMaps();
  } else {
    disableGoogleMaps();
  }
  
  if (cookiePreferences.firebase) {
    enableFirebase();
  } else {
    disableFirebase();
  }
  
  if (cookiePreferences.analytics) {
    enableAnalytics();
  } else {
    disableAnalytics();
  }
}

function hideCookieBanner() {
  document.getElementById('cookie-banner').style.display = 'none';
}

function setCookie(name, value, days) {
  const expires = new Date();
  expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
  document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/;SameSite=Lax`;
}

function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(';');
  for(let i=0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}

// Ëøô‰∫õÂáΩÊï∞ÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÈúÄÊ±ÇÂÆûÁé∞
function loadGoogleMaps() { console.log('Google Maps abilitato'); }
function disableGoogleMaps() { console.log('Google Maps disabilitato'); }
function enableFirebase() { console.log('Firebase abilitato'); }
function disableFirebase() { console.log('Firebase disabilitato'); }
function enableAnalytics() { console.log('Analytics abilitato'); }
function disableAnalytics() { console.log('Analytics disabilitato'); }

// FirebaseÁä∂ÊÄÅÊõ¥Êñ∞
function updateFirebaseStatus(connected) {
  const indicator = document.getElementById('firebaseIndicator');
  const statusText = document.getElementById('firebaseStatusText');
  
  if (indicator && statusText) {
    if (connected) {
      indicator.className = 'sync-indicator online';
      statusText.textContent = 'Online';
    } else {
      indicator.className = 'sync-indicator offline';
      statusText.textContent = 'Offline';
    }
  }
}

// ‰ºòÊÉ†ÂÜÖÂÆπÁÆ°ÁêÜ
function ensureOfferContent() {
  const offerSection = document.querySelector('#monthly-offer');
  if (!offerSection) {
    console.error("Sezione offerta non trovata");
    return;
  }
  
  const currentContent = offerSection.innerHTML.trim();
  if (!currentContent || currentContent.includes('Caricamento')) {
    loadOfferContentImmediately();
  }
}

function loadOfferContentImmediately() {
  if (window.firebaseAvailable) {
    loadOfferContentFromFirebase();
  } else {
    const savedOffer = loadStorage('supershop_offer_content');
    if (savedOffer) {
      updateOfferDisplay(savedOffer);
    } else {
      setDefaultOfferContent();
    }
  }
}

function initOfferContentListener() {
  console.log("üì° Inizializzazione listener contenuti offerta");
  loadOfferContent();
  
  if (window.firebaseAvailable && window.firebaseDatabase && window.firebaseRef && window.firebaseOnValue) {
    console.log("üî• Firebase attivo - attivazione listener real-time");
    
    try {
      const offerRef = window.firebaseRef(window.firebaseDatabase, 'website_content/offer');
      window.firebaseOnValue(offerRef, (snapshot) => {
        const offerData = snapshot.val();
        console.log("üì• Dati ricevuti da Firebase:", offerData);
        
        if (offerData) {
          saveStorage('supershop_offer_content', offerData);
          updateOfferDisplay(offerData);
          console.log("‚úÖ Contenuti promozionali aggiornati in tempo reale");
        } else {
          console.log("‚ÑπÔ∏è Nessun dato in Firebase, uso default");
          setDefaultOfferContent();
        }
      }, (error) => {
        console.error("‚ùå Errore listener Firebase:", error);
        loadLocalOfferContent();
      });
    } catch (error) {
      console.error("‚ùå Errore inizializzazione Firebase:", error);
      loadLocalOfferContent();
    }
  } else {
    console.log("üì± Firebase non disponibile, uso contenuti locali");
    loadLocalOfferContent();
  }
}

function loadLocalOfferContent() {
  const savedOffer = loadStorage('supershop_offer_content');
  if (savedOffer) {
    console.log("üìÅ Caricamento contenuti da localStorage:", savedOffer);
    updateOfferDisplay(savedOffer);
  } else {
    console.log("üìù Nessun contenuto salvato, uso default");
    setDefaultOfferContent();
  }
}

function setDefaultOfferContent() {
  const defaultOffer = {
    title: "üéÑ Speciale Natale",
    highlight: "SCONTI INCREDIBILI FINO AL 70% SU ALCUNI ARTICOLI NATALIZI!",
    details: `<h3><i class="fas fa-gift"></i> Cosa troverai in negozio:</h3>
<ul style="margin-left:1.5rem;margin-top:1rem">
  <li>Addobbi natalizi di precedenti stagioni a prezzi stracciati</li>
  <li>Decorazioni per l'albero di Natale con sconti fino al 70%</li>
  <li>Luci e illuminazione natalizia a prezzi imbattibili</li>
  <li>Idee regalo natalizie con incredibili occasioni</li>
  <li>E tanto altro... vieni a descubrirlo di persona!</li>
</ul>`,
    motivation: `<p><strong>Perch√© non elenchiamo tutti i prodotti?</strong> Perch√© le scorte sono limitate e variano ogni giorno! I migliori affari li trovi venendo direttamente in negozio.</p>
<p style="text-align:center;font-size:1.2rem;margin:1.5rem 0">üìç <strong>Vieni a caccia di occasioni!</strong><br><em>I prezzi pi√π bassi li vedi solo qui da noi</em></p>`,
    expiry: "31 Dicembre 2025",
    status: "active",
    lastUpdated: new Date().toISOString()
  };
  
  fillOfferForm(defaultOffer);
  updateOfferDisplay(defaultOffer);
}

function fillOfferForm(offerData) {
  document.getElementById('offerTitle').value = offerData.title || '';
  document.getElementById('offerHighlight').value = offerData.highlight || '';
  document.getElementById('offerDetails').value = offerData.details || '';
  document.getElementById('offerMotivation').value = offerData.motivation || '';
  document.getElementById('offerExpiry').value = offerData.expiry || '';
  document.getElementById('offerStatus').value = offerData.status || 'active';
}

function updateOfferDisplay(offerData) {
  const offerSection = document.querySelector('.monthly-offer');
  if (!offerSection) return;
  
  offerSection.innerHTML = createOfferHTML(offerData);
  
  if (offerData.status === 'hidden') {
    offerSection.classList.add('hidden');
  } else {
    offerSection.classList.remove('hidden');
  }
}

function createOfferHTML(offerData) {
  return `
    <section class="monthly-offer" style="margin: 0; transform: none;">
      <h2>${offerData.title}</h2>
      <div class="offer-highlight">${offerData.highlight}</div>
      <div class="offer-details">
        ${offerData.details}
      </div>
      ${offerData.motivation}
      <div class="offer-validity">
        <strong>Affrettati! Offerte valide fino al: 
          <span style="color:var(--secondary-color)">${offerData.expiry}</span>
        </strong><br>
        <small>o fino ad esaurimento scorte</small>
      </div>
    </section>
  `;
}

// ÂÆûÊó∂‰∫ßÂìÅÁÆ°ÁêÜÂäüËÉΩ
function enableRealtimeAdmin() {
  const pwd = prompt("Inserisci password amministratore per la gestione real-time:");
  if(pwd === null) return;
  
  if(validateAdminPassword(pwd)){
    document.getElementById('realtimeAdminSection').style.display = "block";
    document.getElementById('realtimeAdminLoginBtn').style.display = "none";
    
    if (window.firebaseAvailable) {
      showSyncStatus('Accesso real-time attivato', 'success');
    } else {
      showSyncStatus('Firebase‰∏çÂèØÁî®Ôºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè', 'warning');
      renderLocalProductsInAdmin();
    }
  } else {
    alert("Password errata!");
  }
}

function renderRealtimeProducts(products) {
  const container = document.getElementById('realtimeProductsContainer');
  if (!container) return;
  
  container.innerHTML = '';
  
  if (Object.keys(products).length === 0) {
    container.innerHTML = `
      <div style="text-align:center;padding:2rem;color:#666;">
        <i class="fas fa-inbox" style="font-size:3rem;margin-bottom:1rem;"></i>
        <p>Nessun prodotto nel database real-time</p>
      </div>
    `;
    return;
  }
  
  const sortedProducts = Object.entries(products)
    .sort((a, b) => (b[1].lastUpdated || '').localeCompare(a[1].lastUpdated || ''));
  
  sortedProducts.forEach(([barcode, p]) => {
    const productElement = createRealtimeProductElement(barcode, p);
    container.appendChild(productElement);
  });
}

function createRealtimeProductElement(barcode, product) {
  const div = document.createElement('div');
  div.className = 'realtime-product';
  
  const info = document.createElement('div');
  info.className = 'realtime-product-info';
  
  const price = product.price || 0;
  const isDiscount = product.isDiscount && product.discountPrice;
  
  let priceHTML = '';
  if (isDiscount) {
    priceHTML = `
      <span class="realtime-product-price">‚Ç¨${product.discountPrice}</span>
      <s style="color:#999;margin-left:0.5rem;">‚Ç¨${price}</s>
      <span class="discount-tag" style="background:${product.discountTagColor || '#ff0000'};margin-left:0.5rem;">
        ${product.discountTagText || 'Sconto'}
      </span>
    `;
  } else {
    priceHTML = `<span class="realtime-product-price">‚Ç¨${price}</span>`;
  }
  
  info.innerHTML = `
    <strong>${product.name}</strong>
    <small>Codice: ${barcode} | Categoria: ${getCategoryName(product.category)}</small>
    <div style="margin-top:0.3rem;">${priceHTML}</div>
  `;
  
  const actions = document.createElement('div');
  actions.className = 'realtime-product-actions';
  
  const editBtn = document.createElement('button');
  editBtn.innerHTML = '<i class="fas fa-edit"></i>';
  editBtn.className = 'admin-action-btn warning';
  editBtn.title = 'Modifica';
  editBtn.onclick = () => editProduct(barcode);
  
  const deleteBtn = document.createElement('button');
  deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
  deleteBtn.className = 'admin-action-btn danger';
  deleteBtn.title = 'Elimina';
  deleteBtn.onclick = () => deleteProduct(barcode);
  
  actions.appendChild(editBtn);
  actions.appendChild(deleteBtn);
  
  div.appendChild(info);
  div.appendChild(actions);
  
  return div;
}

function editProduct(barcode) {
  if (!window.firebaseAvailable || !window.firebaseDatabase) {
    alert("Firebase‰∏çÂèØÁî®ÔºåÊó†Ê≥ïÁºñËæëÂÆûÊó∂‰∫ßÂìÅ");
    return;
  }
  
  const p = window.currentRealtimeProducts[barcode];
  if (!p) return;
  
  document.getElementById('newProductBarcode').value = barcode;
  document.getElementById('newProductName').value = p.name || "";
  document.getElementById('newProductCategory').value = p.category || "regalo";
  document.getElementById('newProductPrice').value = p.price || "";
  document.getElementById('newProductImage').value = p.image || "";
  document.getElementById('newProductDescription').value = p.description || "";
  
  const hasDiscount = p.isDiscount && p.discountPrice;
  document.getElementById('newProductDiscount').checked = hasDiscount;
  if (hasDiscount) {
    document.getElementById('newDiscountPrice').value = p.discountPrice;
    document.getElementById('newDiscountTagText').value = p.discountTagText || "Offerta!";
    document.getElementById('newDiscountTagColor').value = p.discountTagColor || "#ff0000";
  }
  toggleDiscountFields();
  
  document.getElementById('addOrUpdateBtn').innerHTML = '<i class="fas fa-save"></i> Aggiorna Prodotto';
  document.getElementById('addOrUpdateBtn').className = 'admin-action-btn warning';
  
  document.getElementById('newProductBarcode').scrollIntoView({ behavior: 'smooth' });
}

function deleteProduct(barcode) {
  if (!window.firebaseAvailable || !window.firebaseDatabase) {
    alert("Firebase‰∏çÂèØÁî®ÔºåÊó†Ê≥ïÂà†Èô§ÂÆûÊó∂‰∫ßÂìÅ");
    return;
  }
  
  const productName = window.currentRealtimeProducts[barcode]?.name || barcode;
  if(confirm(`Sei sicuro di voler eliminare il prodotto "${productName}" dal database real-time?`)) {
    const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + barcode);
    window.firebaseRemove(productRef)
      .then(() => {
        showSyncStatus('Prodotto eliminato con successo', 'success');
      })
      .catch(err => {
        console.error(err);
        showSyncStatus('Errore nell\'eliminazione del prodotto', 'error');
      });
  }
}

function toggleDiscountFields() {
  const discountFields = document.getElementById('discountFields');
  const discountCheckbox = document.getElementById('newProductDiscount');
  if (discountFields) {
    discountFields.style.display = discountCheckbox.checked ? 'block' : 'none';
  }
}

function addOrUpdateProduct() {
  if (!window.firebaseAvailable || !window.firebaseDatabase) {
    alert("Firebase‰∏çÂèØÁî®ÔºåÊó†Ê≥ï gestire prodotti real-time");
    return;
  }
  
  const barcode = document.getElementById('newProductBarcode').value.trim();
  const name = document.getElementById('newProductName').value.trim();
  const category = document.getElementById('newProductCategory').value;
  const price = parseFloat(document.getElementById('newProductPrice').value);
  const image = document.getElementById('newProductImage').value.trim();
  const description = document.getElementById('newProductDescription').value.trim();
  const isDiscount = document.getElementById('newProductDiscount').checked;
  const discountPrice = isDiscount ? parseFloat(document.getElementById('newDiscountPrice').value) : null;
  const discountTagText = isDiscount ? document.getElementById('newDiscountTagText').value.trim() : "";
  const discountTagColor = isDiscount ? document.getElementById('newDiscountTagColor').value : "#ff0000";

  if(!barcode || barcode.length < 8) {
    alert("Inserisci un codice a barre valido (almeno 8 caratteri)");
    return;
  }
  
  if(!name) {
    alert("Il nome del prodotto √® obbligatorio");
    return;
  }
  
  if(isNaN(price) || price <= 0) {
    alert("Inserisci un prezzo valido maggiore di 0");
    return;
  }
  
  if(isDiscount && (isNaN(discountPrice) || discountPrice <= 0)) {
    alert("Inserisci un prezzo scontato valido");
    return;
  }

  const productData = {
    name,
    category,
    price,
    image: image || DEFAULT_IMAGE,
    description: description || name,
    isDiscount,
    discountPrice: isDiscount ? discountPrice : null,
    discountTagText: isDiscount ? discountTagText : "",
    discountTagColor: isDiscount ? discountTagColor : "#ff0000",
    discountPercentage: isDiscount && discountPrice ? 
      parseFloat(((price - discountPrice) / price * 100).toFixed(2)) : 0,
    lastUpdated: new Date().toISOString(),
    createdAt: window.currentRealtimeProducts[barcode]?.createdAt || new Date().toISOString()
  };

  const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + barcode);
  window.firebaseSet(productRef, productData)
  .then(() => {
    const isUpdate = window.currentRealtimeProducts[barcode];
    const message = isUpdate ? "Prodotto aggiornato con successo!" : "Prodotto aggiunto con successo!";
    showSyncStatus(message, 'success');
    resetRealtimeForm();
  })
  .catch(err => {
    console.error(err);
    showSyncStatus('Errore nel salvataggio del prodotto', 'error');
  });
}

function resetRealtimeForm() {
  document.getElementById('newProductBarcode').value = "";
  document.getElementById('newProductName').value = "";
  document.getElementById('newProductCategory').value = "regalo";
  document.getElementById('newProductPrice').value = "";
  document.getElementById('newProductImage').value = "";
  document.getElementById('newProductDescription').value = "";
  document.getElementById('newProductDiscount').checked = false;
  document.getElementById('newDiscountPrice').value = "";
  document.getElementById('newDiscountTagText').value = "Offerta!";
  document.getElementById('newDiscountTagColor').value = "#ff0000";
  document.getElementById('addOrUpdateBtn').innerHTML = '<i class="fas fa-plus"></i> Aggiungi Prodotto';
  document.getElementById('addOrUpdateBtn').className = 'admin-action-btn success';
  toggleDiscountFields();
}

// Ëá™Âä®Ê£ÄÊµãÊù°ÂΩ¢Á†Å
document.addEventListener('DOMContentLoaded', function() {
  const barcodeInput = document.getElementById('newProductBarcode');
  if (barcodeInput) {
    barcodeInput.addEventListener('input', function() {
      if (!window.firebaseAvailable) return;
      
      const code = this.value.trim();
      if(code && window.currentRealtimeProducts[code]){
        document.getElementById('addOrUpdateBtn').innerHTML = '<i class="fas fa-save"></i> Aggiorna Prodotto';
        document.getElementById('addOrUpdateBtn').className = 'admin-action-btn warning';
        const p = window.currentRealtimeProducts[code];
        document.getElementById('newProductName').value = p.name || "";
        document.getElementById('newProductCategory').value = p.category || "regalo";
        document.getElementById('newProductPrice').value = p.price || "";
        document.getElementById('newProductImage').value = p.image || "";
        document.getElementById('newProductDescription').value = p.description || "";
        document.getElementById('newProductDiscount').checked = p.isDiscount || false;
        document.getElementById('newDiscountPrice').value = p.discountPrice != null ? p.discountPrice : "";
        document.getElementById('newDiscountTagText').value = p.discountTagText || "Offerta!";
        document.getElementById('newDiscountTagColor').value = p.discountTagColor || "#ff0000";
        toggleDiscountFields();
      } else {
        document.getElementById('addOrUpdateBtn').innerHTML = '<i class="fas fa-plus"></i> Aggiungi Prodotto';
        document.getElementById('addOrUpdateBtn').className = 'admin-action-btn success';
      }
    });
  }
});

// ‰ºòÊÉ†ÂÜÖÂÆπÁÆ°ÁêÜÂäüËÉΩ
function enableOfferAdmin() {
  const pwd = prompt("Inserisci password amministratore per la gestione contenuti:");
  if(pwd === null) return;
  
  if(validateAdminPassword(pwd)){
    document.getElementById('offerAdminSection').style.display = "block";
    document.getElementById('offerAdminLoginBtn').style.display = "none";
    loadOfferContent();
    
    if (window.firebaseAvailable) {
      showSyncStatus('Gestione contenuti attivata - Sincronizzazione Firebase attiva', 'success');
    } else {
      showSyncStatus('Firebase‰∏çÂèØÁî®Ôºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè', 'warning');
    }
  } else {
    alert("Password errata!");
  }
}

function loadOfferContent() {
  console.log("üì• Caricamento contenuti offerta...");
  
  if (window.firebaseAvailable && window.firebaseDatabase && window.firebaseRef && window.firebaseOnValue) {
    console.log("üî• Tentativo caricamento da Firebase");
    
    const offerRef = window.firebaseRef(window.firebaseDatabase, 'website_content/offer');
    window.firebaseOnValue(offerRef, (snapshot) => {
      const offerData = snapshot.val();
      if (offerData) {
        console.log("‚úÖ Dati caricati da Firebase:", offerData);
        fillOfferForm(offerData);
        updateOfferDisplay(offerData);
        
        const lastUpdateElement = document.getElementById('offerLastUpdate');
        if (lastUpdateElement && offerData.lastUpdated) {
          const date = new Date(offerData.lastUpdated).toLocaleString('it-IT');
          lastUpdateElement.innerHTML = `<i class="fas fa-sync"></i> Ultimo aggiornamento: ${date}`;
        }
      } else {
        console.log("‚ÑπÔ∏è Nessun dato in Firebase, uso default");
        setDefaultOfferContent();
      }
    }, (error) => {
      console.error("‚ùå Errore caricamento Firebase:", error);
      loadLocalOfferContentForAdmin();
    });
  } else {
    console.log("üì± Firebase non disponibile, uso localStorage");
    loadLocalOfferContentForAdmin();
  }
}

function loadLocalOfferContentForAdmin() {
  const savedOffer = loadStorage('supershop_offer_content');
  if (savedOffer) {
    console.log("üìÅ Caricamento contenuti admin da localStorage");
    fillOfferForm(savedOffer);
    updateOfferDisplay(savedOffer);
  } else {
    console.log("üìù Nessun contenuto salvato, uso default per admin");
    setDefaultOfferContent();
  }
}

function saveOfferContent() {
  const offerData = {
    title: document.getElementById('offerTitle').value,
    highlight: document.getElementById('offerHighlight').value,
    details: document.getElementById('offerDetails').value,
    motivation: document.getElementById('offerMotivation').value,
    expiry: document.getElementById('offerExpiry').value,
    status: document.getElementById('offerStatus').value,
    lastUpdated: new Date().toISOString()
  };
  
  if (!offerData.title || !offerData.highlight || !offerData.expiry) {
    alert("Per favore compila tutti i campi obbligatori (*)");
    return;
  }
  
  if (window.firebaseAvailable && window.firebaseDatabase) {
    const offerRef = window.firebaseRef(window.firebaseDatabase, 'website_content/offer');
    window.firebaseSet(offerRef, offerData)
      .then(() => {
        showSyncStatus('Contenuti promozionali salvati e sincronizzati!', 'success');
        
        const lastUpdateElement = document.getElementById('offerLastUpdate');
        if (lastUpdateElement) {
          const date = new Date().toLocaleString('it-IT');
          lastUpdateElement.innerHTML = `<i class="fas fa-sync"></i> Ultimo aggiornamento: ${date} (Live)`;
        }
      })
      .catch(err => {
        console.error("Errore salvataggio Firebase:", err);
        showSyncStatus('Errore nel salvataggio Firebase', 'error');
        saveStorage('supershop_offer_content', offerData);
      });
  } else {
    saveStorage('supershop_offer_content', offerData);
    showSyncStatus('Contenuti salvati localmente (Firebase‰∏çÂèØÁî®)', 'warning');
  }
  
  updateOfferDisplay(offerData);
}

function resetOfferContent() {
  if (confirm("Sei sicuro di voler ripristinare i contenuti predefiniti? I dati attuali verranno sovrascritti.")) {
    setDefaultOfferContent();
    showSyncStatus('Contenuti ripristinati alle impostazioni predefinite', 'success');
  }
}

function previewOffer() {
  const offerData = {
    title: document.getElementById('offerTitle').value,
    highlight: document.getElementById('offerHighlight').value,
    details: document.getElementById('offerDetails').value,
    motivation: document.getElementById('offerMotivation').value,
    expiry: document.getElementById('offerExpiry').value,
    status: document.getElementById('offerStatus').value
  };
  
  let previewModal = document.getElementById('offerPreviewModal');
  if (!previewModal) {
    previewModal = document.createElement('div');
    previewModal.id = 'offerPreviewModal';
    previewModal.className = 'offer-preview-modal';
    previewModal.innerHTML = `
      <div class="offer-preview-content">
        <div style="padding: 1.5rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: var(--primary-color);">
            <i class="fas fa-eye"></i> Anteprima Offerta
          </h3>
          <button onclick="closeOfferPreview()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">‚úñ</button>
        </div>
        <div id="offerPreviewContent" style="padding: 2rem;"></div>
      </div>
    `;
    document.body.appendChild(previewModal);
  }
  
  const previewContent = document.getElementById('offerPreviewContent');
  previewContent.innerHTML = createOfferHTML(offerData);
  
  previewModal.style.display = 'flex';
}

function closeOfferPreview() {
  const previewModal = document.getElementById('offerPreviewModal');
  if (previewModal) {
    previewModal.style.display = 'none';
  }
}

// ÊµãËØïÂáΩÊï∞
window.testOfferContent = function() {
  console.log("üß™ Test contenuti offerta:");
  console.log("- Sezione trovata:", !!document.querySelector('#monthly-offer'));
  console.log("- Contenuto attuale:", document.querySelector('#monthly-offer')?.innerHTML);
  
  const testOffer = {
    title: "üß™ Test Offerta",
    highlight: "QUESTA √à UNA OFFERTA DI TEST!",
    details: "<p>Se vedi questo messaggio, il sistema offerte funziona correttamente.</p>",
    motivation: "<p>Test completato con successo!</p>",
    expiry: "31 Dicembre 2025",
    status: "active"
  };
  
  updateOfferDisplay(testOffer);
  alert("Test offerta completato! Controlla la sezione offerte.");
};

window.forceShowOffers = function() {
  console.log("üîÑ Forzatura visualizzazione offerte...");
  
  if (window.firebaseAvailable) {
    console.log("‚úÖ Firebase disponibile");
  } else {
    console.log("‚ö†Ô∏è Firebase non disponibile, uso contenuti locali");
  }
  
  const savedOffer = loadStorage('supershop_offer_content');
  if (savedOffer) {
    console.log("üìÅ Contenuti trovati in localStorage:", savedOffer);
    updateOfferDisplay(savedOffer);
  } else {
    console.log("üìù Nessun contenuto salvato, uso default");
    setDefaultOfferContent();
  }
};

window.resetToDefaultOffers = function() {
  if (confirm("Sei sicuro di voler ripristinare le offerte ai valori predefiniti?")) {
    setDefaultOfferContent();
    alert("Offer ripristinate ai valori predefiniti!");
  }
};

console.log("‚úÖ Sistema Supershop Bisagno completamente caricato!");
</script>
</body>
</html>
