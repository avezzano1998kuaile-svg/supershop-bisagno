<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Supershop Bisagno S.R.L. - Articoli Regalo, Giocattoli, Casalinghi Genova</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõçÔ∏è</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root{--primary-color:#004080;--secondary-color:#ff6b00;--light-color:#f9f9f9;--dark-color:#333;--shadow:0 4px 6px rgba(0,0,0,.1);--transition:all .3s ease}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.6;background:var(--light-color);color:var(--dark-color);scroll-behavior:smooth}
header{background:linear-gradient(135deg,var(--primary-color),#00264d);color:#fff;padding:1rem 0;box-shadow:var(--shadow);position:sticky;top:0;z-index:100}
.header-container{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:0 1rem}
.logo{display:flex;align-items:center;gap:.5rem}
.logo-img{height:60px;width:auto}
.logo h1{font-size:1.8rem}
nav ul{display:flex;list-style:none;gap:1.5rem}
nav a{color:#fff;text-decoration:none;font-weight:500;position:relative}
nav a::after{content:'';position:absolute;bottom:0;left:0;width:0;height:2px;background:var(--secondary-color);transition:var(--transition)}
nav a:hover::after{width:100%}
.mobile-menu-btn{display:none;background:none;border:none;color:#fff;font-size:1.5rem;cursor:pointer}
#adminBtn{display:none;background:var(--secondary-color);border:none;color:#fff;padding:.5rem .8rem;border-radius:4px;cursor:pointer;opacity:.7;transition:var(--transition)}#adminBtn:hover{opacity:1}
.hero{background:linear-gradient(rgba(0,64,128,.8),rgba(0,38,77,.9));background-size:cover;background-position:center;color:#fff;text-align:center;padding:5rem 1rem}
.hero-content{max-width:800px;margin:0 auto}
.hero h2{font-size:2.5rem;margin-bottom:1rem}
.hero p{font-size:1.2rem;margin-bottom:2rem}
.btn{display:inline-block;background:var(--secondary-color);color:#fff;padding:.8rem 1.5rem;border-radius:4px;text-decoration:none;font-weight:bold;transition:var(--transition)}
.btn:hover{background:#e55a00;transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.15)}
main{max-width:1200px;margin:2rem auto;padding:0 1rem}
section{background:#fff;border-radius:8px;padding:2rem;margin-bottom:2rem;box-shadow:var(--shadow)}
h2{color:var(--primary-color);margin-bottom:1.5rem;padding-bottom:.5rem;border-bottom:2px solid var(--secondary-color)}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;margin-top:2rem}
.info-card{background:#f0f7ff;padding:1.5rem;border-left:4px solid var(--primary-color);border-radius:8px;transition:var(--transition)}
.categories-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-top:1.5rem}
.category-card{background:#f8f9fa;border:1px solid #e9ecef;border-radius:8px;padding:1.5rem;text-align:center;transition:var(--transition)}
.hours-list{list-style:none}.hours-list li{display:flex;justify-content:space-between;padding:.5rem 0;border-bottom:1px dashed #ddd}
.contact-info{display:flex;flex-wrap:wrap;gap:2rem;margin-top:1.5rem}
.contact-details{flex:1;min-width:300px}.contact-details p{margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
.contact-details a{color:var(--primary-color)}.contact-details a:hover{color:var(--secondary-color)}
.map-container{flex:1;min-width:300px;height:300px;border-radius:8px;overflow:hidden;box-shadow:var(--shadow)}
footer{background:linear-gradient(135deg,var(--primary-color),#00264d);color:#fff;text-align:center;padding:2rem 0;margin-top:3rem}
.back-to-top{position:fixed;bottom:20px;right:20px;background:var(--secondary-color);color:#fff;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;text-decoration:none;box-shadow:var(--shadow);opacity:0;visibility:hidden;z-index:99;transition:var(--transition)}.back-to-top.visible{opacity:1;visibility:visible}
.monthly-offer{background:#f0f7ff;border-left:4px solid var(--primary-color);padding:1.5rem;margin:2rem 0;border-radius:8px}
.monthly-offer.hidden{display:none}
.offer-highlight{background:linear-gradient(135deg,var(--secondary-color),#ff8c00);color:#fff;padding:1rem;border-radius:8px;text-align:center;font-size:1.3rem;font-weight:bold;margin:1.5rem 0;box-shadow:0 4px 8px rgba(0,0,0,.1)}
.offer-details{background:#fff;padding:1.5rem;border:1px solid #e0e0e0;border-radius:8px;margin:1.5rem 0}
.offer-validity{background:#fff8e1;padding:1rem;border:1px dashed var(--secondary-color);border-radius:8px;text-align:center;margin-top:1.5rem}
.products-section{margin-top:2rem}
.search-filter-container{display:flex;flex-wrap:wrap;gap:1rem;margin-bottom:2rem;align-items:center}
.search-box{flex:1;min-width:300px;position:relative}.search-box input{width:100%;padding:.8rem 1rem .8rem 2.5rem;border:1px solid #ddd;border-radius:4px}
.search-box i{position:absolute;left:.8rem;top:50%;transform:translateY(-50%);color:#777}
.filter-select{padding:.8rem 1rem;border:1px solid #ddd;border-radius:4px;background:#fff;cursor:pointer}
.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1.5rem;margin-bottom:2rem}
.product-card{background:#fff;border-radius:8px;overflow:hidden;box-shadow:var(--shadow);cursor:pointer;position:relative;transition:var(--transition)}
.product-card:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(0,0,0,.15)}
.product-image{width:100%;height:200px;object-fit:cover;background:#f5f5f5}
/* Ê∑ªÂä†Âà∞‰Ω†ÁöÑ CSS ‰∏≠ */
#productModal > div {max-height: 90vh;overflow-y: auto;position: relative}
.product-info{padding:1rem}.product-name{font-weight:600;margin-bottom:.5rem}
.product-price-container{margin-bottom:.5rem}.original-price{color:#999;text-decoration:line-through;font-size:.9rem;margin-right:.5rem}.discount-price{color:var(--secondary-color);font-weight:bold;font-size:1.1rem}
.discount-badge{position:absolute;top:10px;right:10px;background:#e74c3c;color:#fff;padding:.3rem .6rem;border-radius:4px;font-size:.8rem;font-weight:bold;z-index:2}
.product-category{display:inline-block;background:#f0f7ff;color:var(--primary-color);padding:.2rem .5rem;border-radius:4px;font-size:.8rem;margin-top:.5rem}
.product-barcode-small{font-size:.7rem;color:#888;font-family:monospace;margin-top:.3rem}
.load-more-container{text-align:center;margin-top:2rem}.load-more-btn{background:var(--primary-color);color:#fff;border:none;padding:.8rem 1.5rem;border-radius:4px;cursor:pointer;transition:var(--transition)}.load-more-btn:hover{background:#003366}
.sync-status{position:fixed;top:10px;right:10px;background:#28a745;color:#fff;padding:.5rem 1rem;border-radius:20px;font-size:.8rem;z-index:1000;display:flex;align-items:center;gap:.5rem;box-shadow:var(--shadow)}.sync-status.syncing{background:#ffc107;color:#000}.sync-status.error{background:#dc3545}
#privacy-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:10000;justify-content:center;align-items:center}
#privacy-modal>div{background:#fff;padding:2rem;border-radius:10px;max-width:600px;max-height:80vh;overflow-y:auto;margin:2rem;position:relative}
.admin-btn{display:flex;align-items:center;justify-content:center;gap:.5rem;padding:.8rem 1rem;border:none;border-radius:6px;color:#fff;font-weight:600;cursor:pointer;transition:all .3s ease}.admin-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
.admin-panel{display:none;position:fixed;top:0;right:-400px;width:400px;height:100vh;background:#fff;box-shadow:-5px 0 15px rgba(0,0,0,.1);z-index:1000;transition:right .3s ease;overflow-y:auto}.admin-panel.active{display:block;right:0}
.admin-header{background:var(--primary-color);color:#fff;padding:1.5rem;display:flex;justify-content:space-between;align-items:center}
.admin-content{padding:1.5rem}.admin-section{margin-bottom:2rem;padding-bottom:1.5rem;border-bottom:1px solid #eee}
.admin-section h3{color:var(--primary-color);margin-bottom:1rem;display:flex;align-items:center;gap:.5rem}
.admin-stats{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-bottom:1.5rem}
.stat-card{background:#f8f9fa;padding:1rem;border-radius:8px;text-align:center;border-left:4px solid var(--primary-color)}
.stat-number{font-size:1.5rem;font-weight:bold;color:var(--primary-color);display:block}.stat-label{font-size:.8rem;color:#666}
.admin-form-group{margin-bottom:1rem}.admin-form-group label{display:block;margin-bottom:.5rem;font-weight:500}
.admin-form-control{width:100%;padding:.8rem;border:1px solid #ddd;border-radius:4px;font-size:1rem;font-family:inherit}
.admin-form-control:focus{border-color:var(--primary-color);outline:none;box-shadow:0 0 0 2px rgba(0,64,128,.1)}
.admin-form-group textarea{height:100px;resize:vertical}
.admin-actions{display:flex;gap:.5rem;flex-wrap:wrap}
.admin-action-btn{flex:1;min-width:120px;padding:.8rem;border:none;border-radius:4px;cursor:pointer;font-weight:500;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:.5rem}
.admin-action-btn.primary{background:var(--primary-color);color:#fff}.admin-action-btn.secondary{background:#6c757d;color:#fff}.admin-action-btn.success{background:#28a745;color:#fff}.admin-action-btn.warning{background:#ffc107;color:#000}.admin-action-btn.danger{background:#dc3545;color:#fff}
.admin-action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}
.password-hint{background:#fff3cd;border:1px solid #ffeaa7;border-radius:4px;padding:1rem;margin:1rem 0;font-size:.9rem}
.admin-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:999}.admin-overlay.active{display:block}
.hidden-admin-btn{position:fixed;top:10px;right:60px;width:30px;height:30px;background:transparent;border:none;cursor:pointer;z-index:101;opacity:.3;transition:opacity .3s ease}.hidden-admin-btn:hover{opacity:.7}
@keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.8}100%{transform:scale(1);opacity:1}}
.discount-tag{color:#fff;padding:2px 5px;border-radius:3px;font-size:.8rem;margin-left:5px;display:inline-block;animation:pulse 1.5s infinite}
.realtime-admin-section{margin-top:1rem;padding:1rem;border:1px solid #e0e0e0;border-radius:8px;background:#f8f9fa}
.realtime-form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1rem}
.realtime-form-group{display:flex;flex-direction:column}
.realtime-form-group label{font-weight:500;margin-bottom:.3rem;font-size:.9rem}
.realtime-form-group input,.realtime-form-group select{padding:.7rem;border:1px solid #ddd;border-radius:4px;font-size:.9rem;width:100%}
.realtime-product{display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-bottom:.8rem;padding:.8rem;border:1px solid #e9ecef;border-radius:6px;background:#fff}
.realtime-product-info{flex:1}.realtime-product-info strong{color:var(--primary-color);display:block;margin-bottom:.2rem}
.realtime-product-info small{color:#666;font-size:.8rem}.realtime-product-price{font-weight:bold;color:var(--secondary-color)}
.realtime-product-actions{display:flex;gap:.5rem}.sync-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:.5rem}
.sync-indicator.online{background:#28a745;animation:pulse 2s infinite}.sync-indicator.offline{background:#dc3545}
.offer-preview-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:10000;display:none;justify-content:center;align-items:center;padding:2rem}
.offer-preview-content{background:#fff;border-radius:10px;max-width:800px;width:100%;max-height:90vh;overflow:auto;position:relative}
.qr-code-section{transition:transform .3s ease;text-align:center;margin:2rem 0;padding:1.5rem;background:linear-gradient(135deg,#f0f7ff,#e6f3ff);border-radius:10px;border-left:4px solid var(--primary-color)}
.qr-code-section:hover{transform:translateY(-5px)}.contact-highlight a:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(255,107,0,.3)}
.store-guide{background:#e8f5e8;padding:1rem;border-radius:8px;margin:1rem 0;text-align:center}
.cookie-banner{display:none;position:fixed;bottom:0;left:0;right:0;background:linear-gradient(135deg,#004080,#00264d);color:#fff;padding:20px;z-index:10000;box-shadow:0 -4px 12px rgba(0,0,0,.3);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
.cookie-settings-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:10001;justify-content:center;align-items:center;padding:20px}
.cookie-settings-content{background:#fff;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto}
.privacy-policy-section{background:#f8f9fa;padding:2rem;margin-top:2rem;border-radius:8px;border-left:4px solid #004080}
.privacy-section-block{background:#fff;padding:1.5rem;border-radius:8px;margin-bottom:1.5rem}
.local-product-list{border:1px solid #ddd;border-radius:6px;padding:.5rem;max-height:200px;overflow-y:auto;margin-top:.5rem;background:#fafafa;font-size:.8rem}
.local-product-item{display:flex;justify-content:space-between;align-items:center;padding:.4rem .6rem;border-bottom:1px dashed #ccc}
.local-product-item:last-child{border-bottom:none}
</style>
</head>
<body>

<!-- ÂêåÊ≠•Áä∂ÊÄÅ -->
<div id="sync-status" class="sync-status" style="display:none">
  <i class="fas fa-cloud"></i> 
  <span id="sync-text">Sincronizzato</span>
</div>

<!-- Âè≥‰∏äËßíÊåâÈíÆÁªÑ -->
<div class="top-right-buttons">
  <button onclick="openEmailLoginModal()" class="admin-btn primary" id="emailLoginBtn" title="Accedi">
    <i class="fas fa-sign-in-alt"></i> <span>Login</span>
  </button>
  <button class="hidden-admin-btn" id="hiddenAdminBtn" title="Pannello Admin">
    <i class="fas fa-user-shield"></i>
  </button>
</div>
<style>
.top-right-buttons{position:fixed;top:10px;right:10px;z-index:102;display:flex;flex-direction:column;gap:6px;align-items:flex-end}
.top-right-buttons .admin-btn,.top-right-buttons .hidden-admin-btn{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;border:none;box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .2s}
.top-right-buttons .admin-btn{background:var(--secondary-color);color:#fff}
.top-right-buttons .admin-btn:hover,.top-right-buttons .hidden-admin-btn:hover{transform:translateY(-2px)}
@media(min-width:769px){.top-right-buttons .admin-btn{width:auto;padding:0 14px;border-radius:18px}.top-right-buttons .admin-btn i{margin-right:6px}}
@media(max-width:768px){.top-right-buttons{bottom:20px;right:20px;top:auto}.top-right-buttons .admin-btn{width:40px;height:40px;border-radius:50%;padding:0}.top-right-buttons .admin-btn span{display:none}}
</style>

<!-- Cookie -->
<div id="cookie-banner" class="cookie-banner">
  <div style="max-width:1200px;margin:0 auto;display:flex;flex-wrap:wrap;gap:15px;align-items:center;justify-content:space-between">
    <div style="flex:1;min-width:300px">
      <h4 style="margin:0 0 8px 0;color:white;display:flex;align-items:center;gap:8px"><i class="fas fa-cookie-bite"></i> Cookie e Privacy</h4>
      <p style="margin:0;font-size:.9rem;opacity:.9;line-height:1.4">Utilizziamo cookie tecnici e di terze parti per migliorare la tua esperienza. <a href="#privacy-policy" onclick="scrollToPrivacyPolicy()" style="color:#ff6b00;text-decoration:underline">Leggi la Privacy Policy</a></p>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button onclick="acceptAllCookies()" style="background:#ff6b00;color:white;border:none;padding:12px 20px;border-radius:6px;cursor:pointer;font-weight:bold"><i class="fas fa-check"></i> Accetta Tutto</button>
      <button onclick="acceptNecessaryCookies()" style="background:transparent;color:white;border:2px solid white;padding:12px 20px;border-radius:6px;cursor:pointer;font-weight:bold">Solo Necessari</button>
      <button onclick="openCookieSettings()" style="background:transparent;color:white;border:2px solid white;padding:12px 20px;border-radius:6px;cursor:pointer;font-weight:bold"><i class="fas fa-cog"></i> Personalizza</button>
    </div>
  </div>
</div>
<div id="cookie-settings" class="cookie-settings-modal">
  <div class="cookie-settings-content">
    <div style="padding:25px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0;color:#004080"><i class="fas fa-sliders-h"></i> Gestione Cookie</h3>
      <button onclick="closeCookieSettings()" style="background:none;border:none;font-size:1.5rem;cursor:pointer">‚úñ</button>
    </div>
    <div style="padding:25px">
      <div style="margin-bottom:25px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <label style="font-weight:bold;color:#004080;cursor:pointer"><i class="fas fa-lock"></i> Cookie Necessari</label>
          <input type="checkbox" id="necessary-cookies" checked disabled style="width:20px;height:20px">
        </div>
        <p style="margin:0;color:#666;font-size:.9rem">Cookie essenziali per il funzionamento del sito. Non possono essere disattivati.</p>
      </div>
      <div style="margin-bottom:25px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <label style="font-weight:bold;color:#004080;cursor:pointer"><i class="fas fa-map-marked-alt"></i> Google Maps</label>
          <input type="checkbox" id="maps-cookies" style="width:20px;height:20px">
        </div>
        <p style="margin:0;color:#666;font-size:.9rem">Cookie per la visualizzazione della mappa e localizzazione del negozio.</p>
      </div>
      <div style="margin-bottom:25px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <label style="font-weight:bold;color:#004080;cursor:pointer"><i class="fas fa-database"></i> Firebase (Prodotti)</label>
          <input type="checkbox" id="firebase-cookies" style="width:20px;height:20px">
        </div>
        <p style="margin:0;color:#666;font-size:.9rem">Cookie per la sincronizzazione in tempo reale dei prodotti e prezzi.</p>
      </div>
      <div style="margin-bottom:25px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <label style="font-weight:bold;color:#004080;cursor:pointer"><i class="fas fa-chart-bar"></i> Cookie Analitici</label>
          <input type="checkbox" id="analytics-cookies" style="width:20px;height:20px">
        </div>
        <p style="margin:0;color:#666;font-size:.9rem">Cookie per analisi del traffico e miglioramento del sito.</p>
      </div>
    </div>
    <div style="padding:20px 25px;background:#f8f9fa;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end">
      <button onclick="closeCookieSettings()" style="background:#666;color:white;border:none;padding:12px 20px;border-radius:6px;cursor:pointer;font-weight:bold">Annulla</button>
      <button onclick="saveCookiePreferences()" style="background:#004080;color:white;border:none;padding:12px 25px;border-radius:6px;cursor:pointer;font-weight:bold">Salva Preferenze</button>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div class="admin-overlay" id="adminOverlay"></div>
<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <h3><i class="fas fa-cogs"></i> Pannello di Amministrazione</h3>
    <button onclick="closeAdminPanel()" style="background:none;border:none;color:white;font-size:1.2rem;cursor:pointer"><i class="fas fa-times"></i></button>
  </div>
  <div class="admin-content">
    <div class="admin-section">
      <h3><i class="fas fa-chart-bar"></i> Statistiche</h3>
      <div class="admin-stats">
        <div class="stat-card"><span class="stat-number" id="totalProducts">0</span><span class="stat-label">Prodotti Totali</span></div>
        <div class="stat-card"><span class="stat-number" id="totalCategories">0</span><span class="stat-label">Categorie</span></div>
        <div class="stat-card"><span class="stat-number" id="realtimeProducts">0</span><span class="stat-label">Prodotti Real-time</span></div>
        <div class="stat-card">
          <span class="stat-number">
            <span class="sync-indicator offline" id="firebaseIndicator"></span>
            <span id="firebaseStatusText">Offline</span>
          </span>
          <span class="stat-label">Stato Firebase</span>
        </div>
      </div>
    </div>

    <!-- ÂÆûÊó∂‰∫ßÂìÅÁÆ°ÁêÜÔºàFirebaseÔºâ -->
    <div class="admin-section">
      <h3><i class="fas fa-sync-alt"></i> Gestione Prodotti in Tempo Reale</h3>
      <div class="password-hint"><strong>Gestione prodotti Firebase</strong><br><small>I prodotti real-time hanno priorit√† e si sincronizzano automaticamente</small></div>
      <button id="realtimeAdminLoginBtn" class="admin-action-btn primary" onclick="enableRealtimeAdmin()"><i class="fas fa-database"></i> Gestione Prodotti Real-time</button>
      <div id="realtimeAdminSection" class="realtime-admin-section" style="display:none;">
        <h4>Gestione Prodotto Real-time</h4>
        <div class="realtime-form-grid">
          <div class="realtime-form-group"><label>Codice a barre *</label><input type="text" id="newProductBarcode" placeholder="8021785862708" maxlength="13"></div>
          <div class="realtime-form-group"><label>Nome prodotto *</label><input type="text" id="newProductName" placeholder="Nome del prodotto"></div>
          <div class="realtime-form-group"><label>Categoria</label><select id="newProductCategory">
            <option value="regalo">Articoli Regalo</option><option value="giocattoli">Giocattoli</option><option value="cartoleria">Cartoleria</option><option value="casalinghi">Casalinghi</option><option value="ferramenta">Ferramenta</option><option value="animali">Articoli per animali</option><option value="illuminazione">Illuminazione</option><option value="mobili">Mobili</option><option value="natale">Articoli Natalizi</option>
          </select></div>
          <div class="realtime-form-group"><label>Prezzo (‚Ç¨) *</label><input type="number" id="newProductPrice" placeholder="10.00" step="0.01" min="0"></div>
        </div>
        <div class="realtime-form-grid">
          <div class="realtime-form-group"><label>URL Immagine</label><input type="text" id="newProductImage" placeholder="https://..."></div>
          <div class="realtime-form-group"><label>Descrizione</label><input type="text" id="newProductDescription" placeholder="Descrizione prodotto"></div>
        </div>
        <div style="background:#fff3cd;padding:1rem;border-radius:4px;margin:1rem 0">
          <label style="display:flex;align-items:center;gap:.5rem;cursor:pointer"><input type="checkbox" id="newProductDiscount" onchange="toggleDiscountFields()"><strong>Attiva sconto per questo prodotto</strong></label>
        </div>
        <div id="discountFields" style="display:none">
          <div class="realtime-form-grid">
            <div class="realtime-form-group"><label>Prezzo scontato (‚Ç¨) *</label><input type="number" id="newDiscountPrice" placeholder="7.50" step="0.01" min="0"></div>
            <div class="realtime-form-group"><label>Testo etichetta sconto</label><input type="text" id="newDiscountTagText" placeholder="Offerta!" value="Offerta!"></div>
            <div class="realtime-form-group"><label>Colore etichetta</label><input type="color" id="newDiscountTagColor" value="#ff0000"></div>
          </div>
        </div>
        <div class="admin-actions" style="margin-top:1.5rem">
          <button id="addOrUpdateBtn" class="admin-action-btn success" onclick="addOrUpdateProduct()"><i class="fas fa-plus"></i> Aggiungi Prodotto</button>
          <button class="admin-action-btn secondary" onclick="resetRealtimeForm()"><i class="fas fa-redo"></i> Reset</button>
        </div>
        <div style="margin-top:2rem"><h4>Prodotti Real-time Attivi</h4><div id="realtimeProductsContainer"></div></div>
        <div id="lastUpdate" style="margin-top:1rem;font-size:.9rem;color:#555;text-align:center"></div>
      </div>
    </div>

    <!-- Êú¨Âú∞‰∫ßÂìÅÁÆ°ÁêÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-plus-circle"></i> Gestione Prodotti Locali</h3>
      <div class="password-hint"><strong>Aggiungi / modifica prodotti salvati localmente</strong><br><small>I prodotti locali vengono salvati nel browser e possono essere sincronizzati con Firebase</small></div>
      <div class="admin-form-group">
        <label>Nome Prodotto *</label>
        <input type="text" id="localProductName" placeholder="Inserisci nome prodotto" class="admin-form-control">
      </div>
      <div class="admin-form-group">
        <label>Codice a Barre *</label>
        <input type="text" id="localProductBarcode" placeholder="Inserisci codice a barre 13 cifre" class="admin-form-control">
      </div>
      <div class="admin-form-group">
        <label>Categoria</label>
        <select id="localProductCategory" class="admin-form-control">
          <option value="regalo">Articoli Regalo</option><option value="giocattoli">Giocattoli</option><option value="cartoleria">Cartoleria</option><option value="casalinghi">Casalinghi</option><option value="ferramenta">Ferramenta</option><option value="animali">Articoli per animali</option><option value="illuminazione">Illuminazione</option><option value="mobili">Mobili</option><option value="natale">Articoli Natalizi</option>
        </select>
      </div>
      <div class="admin-form-group">
        <label>Prezzo Originale (‚Ç¨)</label>
        <input type="number" id="localOriginalPrice" placeholder="es: 10.00" step="0.01" class="admin-form-control">
      </div>
      <div class="admin-form-group">
        <label>Prezzo Scontato (‚Ç¨)</label>
        <input type="number" id="localDiscountPrice" placeholder="es: 7.50" step="0.01" class="admin-form-control">
      </div>
      <div class="admin-form-group">
        <label>URL Immagine</label>
        <input type="text" id="localProductImage" placeholder="Inserisci link immagine" class="admin-form-control">
      </div>
      <div class="admin-form-group">
        <label>Descrizione</label>
        <textarea id="localProductDescription" placeholder="Inserisci descrizione prodotto" class="admin-form-control" rows="3"></textarea>
      </div>
      <div class="admin-actions">
        <button class="admin-action-btn success" onclick="addLocalProduct()"><i class="fas fa-plus"></i> Aggiungi / Aggiorna</button>
        <button class="admin-action-btn secondary" onclick="resetLocalForm()"><i class="fas fa-redo"></i> Reset</button>
      </div>
      <div style="margin-top:1rem">
        <h4>Prodotti Locali</h4>
        <div id="localProductsList" class="local-product-list"></div>
      </div>
    </div>

    <!-- CSV ÂØºÂÖ• / ÂØºÂá∫ -->
    <div class="admin-section">
      <h3><i class="fas fa-file-export"></i> Gestione Dati (CSV)</h3>
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="exportProductsCSV()"><i class="fas fa-download"></i> Esporta CSV</button>
        <label class="admin-action-btn secondary" style="cursor:pointer">
          <i class="fas fa-upload"></i> Importa CSV <input type="file" id="csvFile" accept=".csv" onchange="importProductsCSV()" style="display:none">
        </label>
      </div>
      <div class="admin-actions" style="margin-top:0.5rem">
        <button class="admin-action-btn warning" onclick="backupData()"><i class="fas fa-save"></i> Backup Dati</button>
        <button class="admin-action-btn danger" onclick="clearAllData()"><i class="fas fa-trash"></i> Cancella Tutto</button>
      </div>
    </div>

    <!-- ÂêåÊ≠•Âà∞ Firebase -->
    <div class="admin-section">
      <h3><i class="fas fa-sync"></i> Sincronizzazione</h3>
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="syncAllProducts()"><i class="fas fa-sync-alt"></i> Sincronizza con Firebase</button>
      </div>
    </div>

    <!-- ‰ºòÊÉ†ÂÜÖÂÆπÁÆ°ÁêÜ -->
    <div class="admin-section">
      <h3><i class="fas fa-fire"></i> Gestione Contenuti Promozionali (Firebase)</h3>
      <div class="password-hint">
        <strong>Modifica i contenuti delle offerte - Sincronizzazione in tempo reale</strong><br>
        <small>Le modifiche si sincronizzano immediatamente su tutti i dispositivi</small>
      </div>
      <button id="offerAdminLoginBtn" class="admin-action-btn primary" onclick="enableOfferAdmin()">
        <i class="fas fa-edit"></i> Gestione Contenuti Promozionali
      </button>
      <div id="offerAdminSection" class="realtime-admin-section" style="display:none;">
        <h4>Modifica Contenuti Promozionali</h4>
        <div class="admin-form-group">
          <label>Titolo Offerta *</label>
          <input type="text" id="offerTitle" placeholder="es: üéÑ Speciale Natale" class="admin-form-control">
        </div>
        <div class="admin-form-group">
          <label>Testo Evidenziato *</label>
          <textarea id="offerHighlight" placeholder="Testo in evidenza..." rows="3" class="admin-form-control">SCONTI INCREDIBILI FINO AL 70% SU ALCUNI ARTICOLI NATALIZI!</textarea>
        </div>
        <div class="admin-form-group">
          <label>Dettagli Offerta (HTML)</label>
          <textarea id="offerDetails" placeholder="Dettagli dell'offerta in HTML..." rows="5" class="admin-form-control"></textarea>
          <small style="color:#666;">Puoi usare HTML per formattazione avanzata</small>
        </div>
        <div class="admin-form-group">
          <label>Testo Motivazionale (HTML)</label>
          <textarea id="offerMotivation" placeholder="Testo motivazionale in HTML..." rows="3" class="admin-form-control"></textarea>
        </div>
        <div class="admin-form-group">
          <label>Data di Scadenza *</label>
          <input type="text" id="offerExpiry" placeholder="es: 31 Dicembre 2025" class="admin-form-control" value="31 Dicembre 2025">
        </div>
        <div class="admin-form-group">
          <label>Stato Offerta</label>
          <select id="offerStatus" class="admin-form-control">
            <option value="active">Attiva</option>
            <option value="hidden">Nascosta</option>
          </select>
        </div>
        <div class="admin-actions">
          <button class="admin-action-btn success" onclick="saveOfferContent()">
            <i class="fas fa-save"></i> Salva e Sincronizza
          </button>
          <button class="admin-action-btn secondary" onclick="resetOfferContent()">
            <i class="fas fa-redo"></i> Ripristina Default
          </button>
          <button class="admin-action-btn primary" onclick="previewOffer()">
            <i class="fas fa-eye"></i> Anteprima Live
          </button>
        </div>
        <div id="offerLastUpdate" style="margin-top: 1rem; font-size: 0.9rem; color: #555; text-align: center;"></div>
      </div>
    </div>

    <!-- Êµ∑Êä•ÁîüÊàêÂô® -->
    <div class="admin-section">
      <h3><i class="fas fa-print"></i> Generatore Poster Promozionale</h3>
      <button class="admin-action-btn" style="background:#333;color:white" onclick="openPosterGenerator()"><i class="fas fa-palette"></i> Crea Poster Promozionale</button>
    </div>
  </div>
</div>

<!-- ÈÇÆÁÆ±ÁôªÂΩïÊ®°ÊÄÅÊ°Ü -->
<div id="email-login-modal" class="cookie-settings-modal">
  <div class="cookie-settings-content">
    <div style="padding:25px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0;color:#004080"><i class="fas fa-sign-in-alt"></i> Accesso Amministratore</h3>
      <button onclick="closeEmailLoginModal()" style="background:none;border:none;font-size:1.5rem;cursor:pointer">‚úñ</button>
    </div>
    <div style="padding:25px">
      <div class="admin-form-group"><label>Email</label><input type="email" id="loginEmail" class="admin-form-control" placeholder="admin@esempio.com"></div>
      <div class="admin-form-group"><label>Password</label><input type="password" id="loginPass" class="admin-form-control" placeholder="Inserisci password"></div>
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="firebaseEmailLogin()"><i class="fas fa-sign-in-alt"></i> Accedi</button>
        <button class="admin-action-btn secondary" onclick="enableOldAdmin()"><i class="fas fa-key"></i> Password del giorno</button>
      </div>
    </div>
  </div>
</div>

<!-- ‰∏ª‰Ωì -->
<header>
  <div class="header-container">
    <div class="logo">
      <img src="1000011845.png" alt="SuperShop Logo" class="logo-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzAwNDA4MCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UzwvdGV4dD48L3N2Zz4='">
      <h1>Supershop</h1>
    </div>
    <div style="display:flex;align-items:center;gap:1rem">
      <nav>
        <ul id="navMenu">
          <li><a href="#home">Home</a></li>
          <li><a href="#about">Chi Siamo</a></li>
          <li><a href="#products">Prodotti</a></li>
          <li><a href="#monthly-offer">Offerte</a></li>
          <li><a href="#hours">Orari</a></li>
          <li><a href="#products-showcase">Catalogo</a></li>
          <li><a href="#contact">Contatti</a></li>
        </ul>
      </nav>
      <button id="adminBtn" title="Pannello Admin"><i class="fas fa-user-shield"></i></button>
      <button class="mobile-menu-btn" aria-label="Menu"><i class="fas fa-bars"></i></button>
    </div>
  </div>
</header>

<section class="hero" id="home">
  <div class="hero-content">
    <h2>Supershop Bisagno S.R.L.</h2>
    <p>ARTICOLI REGALO - GIOCATOLI - CARTOLERIA - CASALINGHI - FERRAMENTA</p>
    <a href="#products-showcase" class="btn">Scopri i nostri prodotti</a>
  </div>
</section>

<main>
  <section id="about">
    <h2>Benvenuti</h2>
    <p>Benvenuti nel sito ufficiale di Supershop Bisagno S.R.L., il vostro punto di riferimento a Genova dal 2019. Offriamo un'ampia selezione di articoli per la casa, articoli per l'igiene personale, prodotti per la pulizia della casa, giocattoli per bambini e articoli per animali domestici.</p>
    <div class="info-grid">
      <div class="info-card">
        <h3><i class="fas fa-store"></i> Il nostro negozio</h3>
        <p>Un ambiente moderno e accogliente dove trovare tutto ci√≤ che ti serve per la casa e la famiglia con la massima convenienza e qualit√†.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-users"></i> La nostra filosofia</h3>
        <p>Crediamo nel servizio al cliente eccellente e nella qualit√† dei prodotti. La soddisfazione dei nostri clienti √® la nostra priorit√†.</p>
      </div>
    </div>
  </section>

  <section id="products">
    <h2>I nostri prodotti</h2>
    <p>Scopri la nostra vasta gamma di prodotti per tutte le esigenze domestiche:</p>
    <div class="categories-grid">
      <div class="category-card"><div class="category-icon"><i class="fas fa-gift"></i></div><h3>Articoli Regalo</h3><p>Idee regalo per ogni occasione e per tutte le et√†</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-gamepad"></i></div><h3>Giocattoli</h3><p>Giocattoli educativi e di intrattenimento per bambini</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-pencil-alt"></i></div><h3>Cartoleria</h3><p>Materiale scolastico e per ufficio di alta qualit√†</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-home"></i></div><h3>Casalinghi</h3><p>Accessori e complementi d'arredo per la casa</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-tools"></i></div><h3>Ferramenta</h3><p>Utensili e materiali per piccoli lavori domestici</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-paw"></i></div><h3>Articoli per animali</h3><p>Prodotti per la cura e il benessere dei tuoi amici a quattro zampe</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-lightbulb"></i></div><h3>Illuminazione</h3><p>Lampadari, lampade da terra, lampade da tavolo e illuminazione per interni</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-couch"></i></div><h3>Mobili</h3><p>Mobili per la casa, sedie, tavoli e complementi d'arredo</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-tree"></i></div><h3>Articoli Natalizi</h3><p>Decorazioni, addobbi e regali per il periodo natalizio</p></div>
    </div>
  </section>

  <!-- Âä®ÊÄÅ‰ºòÊÉ†ÂÜÖÂÆπÈÉ®ÂàÜ -->
  <section id="monthly-offer" class="monthly-offer"></section>

  <section id="hours">
    <h2>Orari di apertura</h2>
    <ul class="hours-list">
      <li><span>Luned√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Marted√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Mercoled√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Gioved√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Venerd√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Sabato</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Domenica</span><span>08:45 ‚Äî 19:45</span></li>
    </ul>
    <p style="margin-top:1rem;font-style:italic">Siamo aperti anche nei giorni festivi, salvo comunicazioni diverse.</p>
  </section>

  <section id="products-showcase" class="products-section">
    <h2>Catalogo Prodotti</h2>
    <p>Scopri tutti i nostri prodotti con prezzi e dettagli:</p>
    <div class="search-filter-container">
      <div class="search-box"><i class="fas fa-search"></i><input type="text" id="product-search" placeholder="Cerca per nome prodotto o codice a barre..."><div class="search-hint">Cerca per nome prodotto o codice a barre (es: 8005123456789)</div></div>
      <select class="filter-select" id="category-filter"><option value="all">Tutte le categorie</option><option value="regalo">Articoli Regalo</option><option value="giocattoli">Giocattoli</option><option value="cartoleria">Cartoleria</option><option value="casalinghi">Casalinghi</option><option value="ferramenta">Ferramenta</option><option value="animali">Articoli per animali</option><option value="illuminazione">Illuminazione</option><option value="mobili">Mobili</option><option value="natale">üéÑ Articoli Natalizi</option></select>
    </div>
    <div class="products-grid" id="products-container"></div>
    <div class="load-more-container"><button class="load-more-btn" id="load-more">Carica pi√π prodotti</button></div>
  </section>

  <section id="contact">
    <h2>Contatti</h2>
    <div class="contact-info">
      <div class="contact-details">
        <p><i class="fas fa-map-marker-alt"></i> <strong>Indirizzo:</strong> Lungobisagno Istria, 29F, 16139 Genova GE</p>
        <p><i class="fas fa-envelope"></i> <strong>Email:</strong> <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a></p>
        <div class="qr-code-section">
          <h4 style="color:var(--primary-color);margin-bottom:1rem"><i class="fas fa-mobile-alt"></i> Salva il nostro sito sul tuo telefono</h4>
          <img src="1000011850.png" alt="QR Code Supershop Bisagno" style="width:160px;height:160px;border:3px solid var(--primary-color);padding:12px;background:white;border-radius:8px">
          <div style="margin-top:1rem"><p style="font-weight:600;margin-bottom:.5rem">Scansiona con la fotocamera</p><p style="font-size:.8rem;color:#666;margin:0">Per prodotti, prezzi e offerte sempre aggiornati</p></div>
        </div>
      </div>
      <div class="map-container">
        <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2817.256958424239!2d8.946223315544193!3d44.40722497909945!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12d3433c3b06d6a5%3A0x5b0e46e9e5a5a5a5!2sLungobisagno%20Istria%2C%2029F%2C%2016139%20Genova%20GE!5e0!3m2!1sit!2sit!4v1620000000000!5m2!1sit!2sit" allowfullscreen="" loading="lazy"></iframe>
      </div>
    </div>
  </section>

  <section id="compliance" style="background:#f8f9fa;border-left:4px solid #004080;padding:1.5rem;margin-top:2rem;border-radius:8px">
    <h2>Informazioni Legali e Conformit√†</h2>
    <p>Supershop Bisagno S.R.L. dichiara che tutte le informazioni sui prodotti, immagini e prezzi presenti sul sito sono fornite a scopo informativo. I prezzi validi sono esclusivamente quelli esposti in negozio al momento dell'acquisto.</p>
    <p>Questo sito rispetta il <strong>Regolamento (UE) 2016/679 (GDPR)</strong> e la normativa italiana sulla privacy. Per informazioni dettagliate sul trattamento dei dati personali, consulta la nostra <a href="#privacy-policy" onclick="scrollToPrivacyPolicy()" style="color:#004080;font-weight:bold">Privacy Policy completa</a>.</p>
    <p>Utilizziamo cookie tecnici e di terze parti per migliorare la tua esperienza. <a href="javascript:void(0)" onclick="openCookieSettings()" style="color:#004080;font-weight:bold">Gestisci le tue preferenze cookie</a>.</p>
  </section>

<section id="privacy-policy" class="privacy-policy-section">
  <h2 style="color:#004080;margin-bottom:1.5rem">Informativa Privacy ‚Äì GDPR (UE) 2016/679</h2>

  <div class="privacy-section-block">
    <h3 style="color:#004080">1. Titolare del trattamento</h3>
    <p>
      Supershop Bisagno S.R.L.<br>
      Lungobisagno Istria, 29F ‚Äì 16139 Genova (GE) ‚Äì Italia<br>
      P.IVA 02596100996 | REA GE-497926<br>
      Email (unico contatto): <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a>
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">2. Tipologie di dati trattati</h3>
    <ul style="margin-left:1.2rem; line-height:1.6">
      <li>Dati di navigazione (indirizzo IP, browser, pagine visitate, orario di accesso).</li>
      <li>Dati forniti volontariamente dall‚Äôutente tramite moduli di contatto o email (nome, indirizzo email, testo del messaggio).</li>
      <li>Cookie tecnici strettamente necessari al funzionamento del sito.</li>
      <li>Cookie di terze parti <strong>solo se espressamente autorizzati</strong> (Google Maps, Firebase, analitici).</li>
    </ul>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">3. Base giuridica e finalit√†</h3>
    <ul style="margin-left:1.2rem; line-height:1.6">
      <li>Interesse legittimo: garantire la sicurezza tecnica del sito.</li>
      <li>Adempimento di servizi richiesti dall‚Äôutente (risposta a messaggi, invio di newsletter se richiesta).</li>
      <li>Consenso: installazione di cookie non tecnici e trattamenti aggiuntivi facoltativi.</li>
    </ul>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">4. Modalit√† di trattamento e tempi di conservazione</h3>
    <p>
      I dati sono trattati con strumenti informatici e/o telematici per il tempo strettamente necessario a conseguire le finalit√† per cui sono stati raccolti.<br>
      Log di navigazione: 30 giorni.<br>
      Messaggi email: fino a 24 mesi dal ricevimento, salvo richiesta di cancellazione anticipata.
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">5. Ambito di comunicazione</h3>
    <p>
      I dati non sono oggetto di diffusione pubblica.<br>
      Possono essere comunicati esclusivamente a:
    </p>
    <ul style="margin-left:1.2rem">
      <li>Responsabili esterni che forniscono servizi essenziali (hosting, gestione email), debitamente nominati ai sensi dell‚Äôart. 28 GDPR.</li>
      <li>Autorit√† competenti quando espressamente previsto dalla legge.</li>
    </ul>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">6. Trasferimenti extra-UE</h3>
    <p>
      Non effettuiamo trasferimenti di dati verso Paesi terzi. Qualora servizi di terze parti (es. Google) comportino trasferimenti, tali trasferimenti avvengono solo in presenza di adeguate garanzie (clausole contrattuali tipo, decisioni di adeguatezza, ecc.).
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">7. Diritti dell‚Äôinteressato (artt. 15-22 GDPR)</h3>
    <p>
      Puoi esercitare i seguenti diritti in qualsiasi momento:
    </p>
    <ul style="margin-left:1.2rem; line-height:1.6">
      <li>accesso, rettifica, cancellazione (‚Äúdiritto all‚Äôoblio‚Äù);</li>
      <li>limitazione del trattamento;</li>
      <li>opposizione al trattamento basato su interesse legittimo o consenso;</li>
      <li>portabilit√† dei dati forniti contrattualmente o con consenso;</li>
      <li>revoca del consenso in qualsiasi momento (senza pregiudicare la liceit√† del trattamento pregressa).</li>
    </ul>
    <p>
      Per esercitare i tuoi diritti scrivi a: <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a>.<br>
      Risponderemo entro 30 giorni senza alcun costo.
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">8. Profilazione e processi decisionali automatizzati</h3>
    <p>
      Non effettuiamo profilazione n√© processi decisionali interamente automatizzati che producano effetti giuridici o analoghi significativi sull‚Äôinteressato.
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">9. Cookie e strumenti di tracciamento</h3>
    <p>
      L‚Äôutilizzo di cookie (o tecnologie equivalenti) √® regolato dalla nostra Cookie Policy, disponibile nella medesima pagina. Il banner di consenso ti permette di selezionare in modo granulare quali categorie di cookie autorizzare.
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">10. Sicurezza</h3>
    <p>
      Adottiamo misure tecniche ed organizzative adeguate per prevenire accessi non autorizzati, perdite, alterazioni o distruzioni dei dati (crittografia TLS, autenticazione a due fattori per gli accessi amministrativi, backup regolari).
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">11. Modifiche all‚Äôinformativa</h3>
    <p>
      La presente informativa pu√≤ essere aggiornata in caso di modifiche normative o di servizi. Ogni variazione sar√≤ pubblicata su questa pagina con indicazione della ‚ÄúData ultimo aggiornamento‚Äù.
    </p>
  </div>

  <div class="privacy-section-block">
    <h3 style="color:#004080">12. Diritto di reclamo</h3>
    <p>
      Se ritieni che il trattamento dei tuoi dati violi il Regolamento UE 2016/679, hai il diritto di proporre reclamo all‚ÄôAutorit√† di controllo competente (per l‚ÄôItalia: Garante per la Protezione dei Dati Personali ‚Äì <a href="https://www.garanteprivacy.it" target="_blank" rel="noopener noreferrer">www.garanteprivacy.it</a>).
    </p>
  </div>

  <div style="background:#e8f4ff;padding:1.5rem;border-radius:8px;text-align:center;margin-top:1rem">
    <p style="margin:0"><strong>Data ultimo aggiornamento:</strong> 20 novembre 2025</p>
    <p style="margin:.5rem 0 0 0; font-size:.9rem">
      Per qualsiasi richiesta relativa alla privacy scrivere esclusivamente a:<br>
      <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a>
    </p>
  </div>
</section>
</main>

<footer>
  <div class="footer-content">
    <p>¬© <span id="year"></span> Supershop Bisagno S.R.L. ‚Äî Tutti i diritti riservati</p>
    <p>P.IVA: 02596100996 | REA: GE - 497926</p>
    <div style="margin-top:1rem;padding:1rem;background:rgba(255,255,255,.1);border-radius:6px">
      <p style="margin:0;font-size:.9rem"><i class="fas fa-qrcode"></i> <strong>Scansiona il QR code in negozio</strong> per scoprire tutti i prodotti e le offerte</p>
    </div>
  </div>
</footer>

<a href="#" class="back-to-top" id="backToTop"><i class="fas fa-arrow-up"></i></a>

<!-- ‰∫ßÂìÅËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
<div id="productModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);z-index:10000;justify-content:center;align-items:center;padding:1rem">
  <div style="background:white;border-radius:10px;max-width:600px;width:100%;padding:1.5rem;position:relative">
    <!-- Ê∑ªÂä†ÂÖ≥Èó≠ÊåâÈíÆ -->
    <span id="closeModal" style="position:absolute;top:10px;right:10px;font-size:28px;cursor:pointer;z-index:10001;color:#333;width:30px;height:30px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.8);border-radius:50%;">&times;</span>
    <img id="modalImage" src="" alt="" style="width:100%;border-radius:8px;margin-bottom:1rem;object-fit:cover">
    <h2 id="modalName" style="margin-bottom:.5rem"></h2>
    <p id="modalPrice"></p>
    <p id="modalCategory"></p>
    <p id="modalBarcode" style="font-family:monospace;color:#666"></p>
    <p id="modalDescription" style="margin-top:1rem"></p>
  </div>
</div>

<!-- Êµ∑Êä•ÁîüÊàêÂô® -->
<div id="poster-generator" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:10000;justify-content:center;align-items:center;padding:20px;overflow:auto">
  <div style="background:white;border-radius:12px;width:95%;max-width:1200px;max-height:95vh;padding:25px;position:relative;box-shadow:0 10px 30px rgba(0,0,0,.3);overflow-y:auto">
    <button onclick="closePosterGenerator()" style="position:absolute;top:15px;right:15px;border:none;background:#ff4444;color:white;width:40px;height:40px;border-radius:50%;font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10001;box-shadow:0 2px 8px rgba(0,0,0,.3)">‚úñ</button>
    <h2 style="color:#000;margin-bottom:20px;text-align:center;padding-right:40px"><i class="fas fa-print"></i> Generatore Poster Promozionale</h2>
    <div style="display:grid;grid-template-columns:350px 1fr;gap:30px;margin-bottom:25px">
      <div style="border-right:2px solid #eee;padding-right:25px">
        <h3 style="color:#000;margin-bottom:20px;font-size:1.3rem;border-bottom:2px solid #000;padding-bottom:10px">Configurazione</h3>
        <div style="margin-bottom:20px"><label style="display:block;margin-bottom:8px;font-weight:bold;color:#333">Titolo Principale:</label><input type="text" id="posterTitle" value="üéâ SUPER PROMOZIONI" style="width:100%;padding:12px;border:2px solid #ddd;border-radius:6px;font-size:1rem;background:#f9f9f9"></div>
        <div style="margin-bottom:20px"><label style="display:block;margin-bottom:8px;font-weight:bold;color:#333">Sottotitolo:</label><input type="text" id="posterSubtitle" value="SCONTI FINO AL 70% SU ARTICOLI SELEZIONATI" style="width:100%;padding:12px;border:2px solid #ddd;border-radius:6px;font-size:1rem;background:#f9f9f9"></div>
        <div style="margin-bottom:20px"><label style="display:block;margin-bottom:8px;font-weight:bold;color:#333">Prodotti in Promozione:</label><textarea id="featuredProducts" style="width:100%;padding:12px;border:2px solid #ddd;border-radius:6px;font-size:.9rem;height:120px;resize:vertical;background:#f9f9f9">‚Ä¢ Articoli per la casa
‚Ä¢ Decorazioni e accessori
‚Ä¢ Idee regalo
‚Ä¢ Prodotti stagionali
‚Ä¢ Piccoli elettrodomestici
‚Ä¢ Prodotti per animali</textarea><small style="color:#666;font-size:.8rem">Separare ogni prodotto con una nuova riga</small></div>
        <div style="margin-bottom:20px"><label style="display:block;margin-bottom:8px;font-weight:bold;color:#333">Data di Scadenza:</label><input type="text" id="expiryDate" value="31 DICEMBRE 2025" style="width:100%;padding:12px;border:2px solid #ddd;border-radius:6px;font-size:1rem;background:#f9f9f9" placeholder="es: 15 GENNAIO 2026"></div>
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:25px;padding:15px;background:#f0f0f0;border-radius:6px"><input type="checkbox" id="includeQR" checked style="width:20px;height:20px"><label for="includeQR" style="font-weight:bold;margin:0;color:#333">Includi QR Code</label></div>
        <div style="display:flex;gap:10px;margin-top:30px">
          <button onclick="saveOfferToFirebase(); updatePosterPreview();" style="flex:1;padding:15px;background:#28a745;color:white;border:none;border-radius:8px;font-size:1rem;font-weight:bold;cursor:pointer"><i class="fas fa-save"></i> Salva</button>
          <button onclick="printPoster();" style="flex:1;padding:15px;background:#000;color:white;border:none;border-radius:8px;font-size:1rem;font-weight:bold;cursor:pointer"><i class="fas fa-print"></i> Stampa</button>
        </div>
        <div style="margin-top:20px;padding:15px;background:#e8f4ff;border-radius:6px;border-left:4px solid #0066cc"><h4 style="margin:0 0 8px 0;color:#0066cc;font-size:.9rem">üí° Suggerimenti:</h4><ul style="margin:0;padding-left:15px;font-size:.8rem;color:#333"><li>Usa testo breve e impatto</li><li>Massimo 6-7 prodotti</li><li>Controlla l'anteprima prima di stampare</li></ul></div>
      </div>
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px"><h3 style="color:#000;margin:0;font-size:1.3rem">Anteprima Poster A4</h3><div style="font-size:.9rem;color:#666;background:#f0f0f0;padding:5px 10px;border-radius:4px"><i class="fas fa-info-circle"></i> Dimensioni: 210mm √ó 297mm</div></div>
        <div id="posterPreview" style="border:3px solid #666;background:#fff;min-height:500px;border-radius:8px;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.1)"><!-- preview injected --></div>
      </div>
    </div>
  </div>
</div>

<div id="printable-poster" style="display:none"></div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA-cT0zR08IFwYqoTk3dUo2uXHRw-c0rPU",
    authDomain: "supershop-bisagno.firebaseapp.com",
    databaseURL: "https://supershop-bisagno-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "supershop-bisagno",
    storageBucket: "supershop-bisagno.firebasestorage.app",
    messagingSenderId: "381483524192",
    appId: "1:381483524192:web:ac6570bbd5725719e2e305"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const auth = getAuth();

  window.firebaseDatabase = database;
  window.firebaseRef = ref;
  window.firebaseSet = set;
  window.firebaseOnValue = onValue;
  window.firebaseRemove = remove;
  window.firebaseAvailable = true;

  /* ÁÆ°ÁêÜÂëòÈÇÆÁÆ±ÁôªÂΩï */
  onAuthStateChanged(auth, user => {
    if (user) {
      localStorage.setItem('firebaseUser', JSON.stringify(user));
      localStorage.setItem('loginType', 'email');
    } else {
      localStorage.removeItem('firebaseUser');
      localStorage.removeItem('loginType');
    }
  });

  window.firebaseEmailLogin = function () {
    const email = document.getElementById('loginEmail').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    if (!email || !pass) { alert('Compila tutti i campi'); return; }
    signInWithEmailAndPassword(auth, email, pass)
      .then(() => { closeEmailLoginModal(); openAdminPanel(); })
      .catch(err => alert('Login fallito: ' + err.message));
  };

  /* ËøûÊé•ÊµãËØï & ÂÆûÊó∂ÁõëÂê¨ */
  const connectedRef = ref(database, '.info/connected');
  onValue(connectedRef, snap => {
    window.firebaseAvailable = snap.val() === true;
    updateFirebaseStatus(window.firebaseAvailable);
  });

  const productsRef = ref(database, 'products');
  onValue(productsRef, snap => {
    window.currentRealtimeProducts = snap.val() || {};
    renderRealtimeProducts(window.currentRealtimeProducts);
    updateAdminStats();
    renderProducts();
    const ts = new Date().toLocaleTimeString('it-IT');
    const el = document.getElementById('lastUpdate');
    if (el) el.innerHTML = `<i class="fas fa-sync"></i> Ultimo aggiornamento: ${ts}`;
  });
</script>

<!-- Áªü‰∏Ä JS ÈÄªËæë -->
<script>
/* ---------- ÈÇÆÁÆ±ÁôªÂΩïÊ®°ÊÄÅÊ°ÜÂáΩÊï∞ ---------- */
function openEmailLoginModal() {
  const modal = document.getElementById('email-login-modal');
  if (modal) {
    modal.style.display = 'flex';
    // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPass').value = '';
  }
}

function closeEmailLoginModal() {
  const modal = document.getElementById('email-login-modal');
  if (modal) {
    modal.style.display = 'none';
  }
}

function enableOldAdmin() {
  closeEmailLoginModal();
  enableAdminPanel();
}

// ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
document.addEventListener('click', function(e) {
  const modal = document.getElementById('email-login-modal');
  if (e.target === modal) {
    closeEmailLoginModal();
  }
});

// ESCÈîÆÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') {
    closeEmailLoginModal();
  }
});
const ADMIN_CONFIG = {
  BASE_PASSWORD: 'supershop',
  STATIC_PASSWORDS: ['Supershop@2019!', 'bisagno2025chen']
};
const DEFAULT_IMAGE = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SW1tYWdpbmUgbm9uIGNhcmljYXRhPC90ZXh0Pjwvc3ZnPg==';

let products = [
  {id:"8021785862708",name:"ANGELO CERAMICA A2MOD NAT CM7X5XH12",originalPrice:"‚Ç¨3,50",discountPrice:"‚Ç¨1,90",discountPercentage:45.71,category:"natale",image:"https://img.heliar.top/file/1762764412602_IMG_20251110_094009.jpg",description:"ANGELO CERAMICA A2MOD NAT CM7X5XH12"},
  {id:"8021785780187",name:"BABBO NAT TERRACOT A2M CM6,5X6X11,5",originalPrice:"‚Ç¨3,90",discountPrice:"‚Ç¨1,50",discountPercentage:61.54,category:"natale",image:"https://img.heliar.top/file/1762764414728_IMG_20251110_094052.jpg",description:"BABBO NAT TERRACOT A2M CM6,5X6X11,5"},
  {id:"8058641713447",name:"71344 SCHIACCIANOCICON MUSICA E LUCE LED TIMER 6/1",price:"‚Ç¨49,90",category:"natale",image:"https://img.heliar.top/file/1762764417669_IMG_20251110_094300.jpg",description:"71344 SCHIACCIANOCICON MUSICA E LUCE LED TIMER 6/1"},
  {id:"8057586069817",name:"S/3 PIGNE SEGNAPOSTO CER NAT D6XH16",originalPrice:"‚Ç¨12,90",discountPrice:"‚Ç¨6,90",discountPercentage:46.51,category:"natale",image:"https://img.heliar.top/file/1762764419280_IMG_20251110_093022.jpg",description:"S/3 PIGNE SEGNAPOSTO CER NAT D6XH16"},
  {id:"8033113579493",name:"TAPPETO PER ALBERO DI NATALE 60CM 2ASS ROSSO HY190",originalPrice:"‚Ç¨1,90",discountPrice:"‚Ç¨1,00",discountPercentage:47.37,category:"natale",image:"https://img.heliar.top/file/1762764427010_IMG_20251110_092743.jpg",description:"TAPPETO PER ALBERO DI NATALE 60CM 2ASS ROSSO HY190"},
  {id:"8057586066489",name:"FARO PLASTICA 30LED NAT CM40X40XH177",originalPrice:"‚Ç¨109,90",discountPrice:"‚Ç¨69,90",discountPercentage:36.4,category:"natale",image:"https://img.heliar.top/file/1762764430670_IMG_20251110_092627.jpg",description:"FARO PLASTICA 30LED NAT CM40X40XH177"},
  {id:"8021785780385",name:"BIMBO MAGNESIA A2M NAT 24X15,5X39,5",originalPrice:"‚Ç¨44,90",discountPrice:"‚Ç¨19,90",discountPercentage:55.68,category:"natale",image:"https://img.heliar.top/file/1762764425299_IMG_20251110_092849.jpg",description:"BIMBO MAGNESIA A2M NAT 24X15,5X39,5"},
  {id:"8021785780446",name:"BIMBO MAGNESIA A2M NAT 39,5X24,5X42",originalPrice:"‚Ç¨69,90",discountPrice:"‚Ç¨29,90",discountPercentage:57.22,category:"natale",image:"https://img.heliar.top/file/1762764423686_IMG_20251110_092904.jpg",description:"BIMBO MAGNESIA A2M NAT 39,5X24,5X42"}
];

window.currentRealtimeProducts = window.currentRealtimeProducts || {};
let adminAuthenticated = false;
let currentPage = 1;
const productsPerPage = 8;
let filteredProducts = [];

/* ---------- Cookie & GDPR ---------- */
let cookiesAccepted = false;
let cookiePreferences = { necessary: true, maps: false, firebase: false, analytics: false };

function initCookieBanner() {
  const saved = getCookie('cookiePreferences');
  if (saved) {
    cookiePreferences = JSON.parse(saved);
    cookiesAccepted = true;
    applyCookiePreferences();
  } else setTimeout(() => document.getElementById('cookie-banner').style.display = 'block', 1000);
}
function acceptAllCookies() {
  cookiePreferences = { necessary: true, maps: true, firebase: true, analytics: true };
  saveCookiePreferences();
  hideCookieBanner();
}
function acceptNecessaryCookies() {
  cookiePreferences = { necessary: true, maps: false, firebase: false, analytics: false };
  saveCookiePreferences();
  hideCookieBanner();
}
function openCookieSettings() {
  document.getElementById('cookie-settings').style.display = 'flex';
  document.getElementById('maps-cookies').checked = cookiePreferences.maps;
  document.getElementById('firebase-cookies').checked = cookiePreferences.firebase;
  document.getElementById('analytics-cookies').checked = cookiePreferences.analytics;
}
function closeCookieSettings() {
  document.getElementById('cookie-settings').style.display = 'none';
}
function saveCookiePreferences() {
  cookiePreferences.maps = document.getElementById('maps-cookies').checked;
  cookiePreferences.firebase = document.getElementById('firebase-cookies').checked;
  cookiePreferences.analytics = document.getElementById('analytics-cookies').checked;
  setCookie('cookiePreferences', JSON.stringify(cookiePreferences), 365);
  cookiesAccepted = true;
  applyCookiePreferences();
  closeCookieSettings();
  hideCookieBanner();
}
function hideCookieBanner() {
  document.getElementById('cookie-banner').style.display = 'none';
}
function scrollToPrivacyPolicy() {
  document.getElementById('privacy-policy').scrollIntoView({ behavior: 'smooth' });
  hideCookieBanner();
}
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
  document.cookie = `${name}=${value};expires=${d.toUTCString()};path=/;SameSite=Lax`;
}
function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(';');
  for(let i=0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}
function applyCookiePreferences() {
  if (!cookiePreferences.maps) {
    const mapContainer = document.querySelector('.map-container');
    if (mapContainer) mapContainer.innerHTML = `
      <div style="width:100%;height:100%;background:#f5f5f5;display:flex;align-items:center;justify-content:center;border-radius:8px;color:#666;font-size:.9rem">
        <div class="text-center">
          <i class="fas fa-map-marked-alt" style="font-size:2rem;margin-bottom:.5rem;opacity:.5"></i>
          <p>Mappa disabilitata per rispetto della tua privacy</p>
          <button onclick="enableMapsFromPlaceholder()" style="background:#004080;color:#fff;border:none;padding:6px 12px;border-radius:4px;font-size:.8rem;margin-top:8px;cursor:pointer">Attiva Mappa</button>
          </div>
      </div>`;
  }
  if (!cookiePreferences.firebase) {
    window.firebaseAvailable = false;
    updateFirebaseStatus(false);
    showSyncStatus('Prodotti real-time disattivati per tua scelta','warning');
  }
}
function enableMapsFromPlaceholder() {
  cookiePreferences.maps = true;
  setCookie('cookiePreferences', JSON.stringify(cookiePreferences), 365);
  location.reload();
}

/* ---------- Â∑•ÂÖ∑ÂáΩÊï∞ ---------- */
const saveStorage = (key, val) => { 
  try { localStorage.setItem(key, JSON.stringify(val)); } catch(e) { console.error('Errore nel salvataggio:', e); } 
};
const loadStorage = key => { 
  try { return JSON.parse(localStorage.getItem(key)); } catch(e) { return null; } 
};
const showSyncStatus = (msg, type = 'success') => {
  const s = document.getElementById('sync-status'); 
  const t = document.getElementById('sync-text');
  if (s && t) {
    t.textContent = msg; 
    s.className = 'sync-status ' + type; 
    s.style.display = 'flex';
    setTimeout(() => s.style.display = 'none', 3000);
  }
};
function updateFirebaseStatus(connected) {
  const indicator = document.getElementById('firebaseIndicator');
  const statusText = document.getElementById('firebaseStatusText');
  if (indicator && statusText) {
    indicator.className = connected ? 'sync-indicator online' : 'sync-indicator offline';
    statusText.textContent = connected ? 'Online' : 'Offline';
  }
}

/* ---------- ÂØÜÁ†ÅÁ≥ªÁªü ---------- */
function generateDynamicPassword() {
  const today = new Date();
  return ADMIN_CONFIG.BASE_PASSWORD + 
         today.getDate().toString().padStart(2, '0') + 
         (today.getMonth() + 1).toString().padStart(2, '0');
}

/* ---------- ‰ºòÊÉ†ÂÜÖÂÆπÁÆ°ÁêÜ ---------- */
function enableOfferAdmin() {
  const pwd = prompt("Inserisci password amministratore per la gestione contenuti:");
  if(pwd === null) return;
  if(pwd === generateDynamicPassword() || ADMIN_CONFIG.STATIC_PASSWORDS.includes(pwd)){
    document.getElementById('offerAdminSection').style.display = "block";
    document.getElementById('offerAdminLoginBtn').style.display = "none";
    loadOfferContent();
    if (window.firebaseAvailable) showSyncStatus('Gestione contenuti attivata - Sincronizzazione Firebase attiva', 'success');
    else showSyncStatus('Firebase‰∏çÂèØÁî®Ôºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè', 'warning');
  } else {
    alert("Password errata!");
  }
}

function loadOfferContent(){
  if(window.firebaseAvailable && window.firebaseDatabase){
    const offerRef = window.firebaseRef(window.firebaseDatabase, 'website_content/offer');
    window.firebaseOnValue(offerRef, (snapshot)=>{
      const offerData = snapshot.val();
      if(offerData){
        fillOfferForm(offerData);
        updateOfferDisplay(offerData);
        const lastUpdateElement = document.getElementById('offerLastUpdate');
        if(lastUpdateElement && offerData.lastUpdated){
          lastUpdateElement.innerHTML = `<i class="fas fa-sync"></i> Ultimo aggiornamento: ${new Date(offerData.lastUpdated).toLocaleString('it-IT')}`;
        }
      } else {
        setDefaultOfferContent();
      }
    });
  } else {
    const savedOffer = loadStorage('supershop_offer_content');
    if(savedOffer){
      fillOfferForm(savedOffer);
      updateOfferDisplay(savedOffer);
    } else {
      setDefaultOfferContent();
    }
  }
}

function fillOfferForm(offerData){
  document.getElementById('offerTitle').value = offerData.title || '';
  document.getElementById('offerHighlight').value = offerData.highlight || '';
  document.getElementById('offerDetails').value = offerData.details || '';
  document.getElementById('offerMotivation').value = offerData.motivation || '';
  document.getElementById('offerExpiry').value = offerData.expiry || '';
  document.getElementById('offerStatus').value = offerData.status || 'active';
}

function setDefaultOfferContent(){
  const defaultOffer = {
    title: "üéÑ Speciale Natale",
    highlight: "SCONTI INCREDIBILI FINO AL 70% SU ALCUNI ARTICOLI NATALIZI!",
    details: `<h3><i class="fas fa-gift"></i> Cosa troverai in negozio:</h3>
<ul style="margin-left:1.5rem;margin-top:1rem">
  <li>Addobbi natalizi di precedenti stagioni a prezzi stracciati</li>
  <li>Decorazioni per l'albero di Natale con sconti fino al 70%</li>
  <li>Luci e illuminazione natalizia a prezzi imbattibili</li>
  <li>Idee regalo natalizie con incredibili occasioni</li>
  <li>E tanto altro... vieni a scoprirlo di persona!</li>
</ul>`,
    motivation: `<p><strong>Perch√© non elenchiamo tutti i prodotti?</strong> Perch√© le scorte sono limitate e variano ogni giorno! I migliori affari li trovi venendo direttamente in negozio.</p>
<p style="text-align:center;font-size:1.2rem;margin:1.5rem 0">üìç <strong>Vieni a caccia di occasioni!</strong><br><em>I prezzi pi√π bassi li vedi solo qui da noi</em></p>`,
    expiry: "31 Dicembre 2025",
    status: "active",
    lastUpdated: new Date().toISOString()
  };
  fillOfferForm(defaultOffer);
  updateOfferDisplay(defaultOffer);
}

function saveOfferContent(){
  const offerData = {
    title: document.getElementById('offerTitle').value,
    highlight: document.getElementById('offerHighlight').value,
    details: document.getElementById('offerDetails').value,
    motivation: document.getElementById('offerMotivation').value,
    expiry: document.getElementById('offerExpiry').value,
    status: document.getElementById('offerStatus').value,
    lastUpdated: new Date().toISOString()
  };
  if(!offerData.title||!offerData.highlight||!offerData.expiry){
    alert("Compila tutti i campi obbligatori (*)");
    return;
  }
  if(window.firebaseAvailable && window.firebaseDatabase){
    const offerRef = window.firebaseRef(window.firebaseDatabase, 'website_content/offer');
    window.firebaseSet(offerRef, offerData)
      .then(()=>{showSyncStatus('Contenuti salvati e sincronizzati!', 'success');})
      .catch(err=>{console.error(err);showSyncStatus('Errore salvataggio Firebase', 'error');});
  } else {
    saveStorage('supershop_offer_content', offerData);
    showSyncStatus('Contenuti salvati localmente (Firebase‰∏çÂèØÁî®)', 'warning');
  }
  updateOfferDisplay(offerData);
}

function resetOfferContent(){
  if(confirm("Ripristinare i contenuti predefiniti?")){
    setDefaultOfferContent();
    showSyncStatus('Contenuti ripristinati', 'success');
  }
}

function previewOffer(){
  const offerData = {
    title: document.getElementById('offerTitle').value,
    highlight: document.getElementById('offerHighlight').value,
    details: document.getElementById('offerDetails').value,
    motivation: document.getElementById('offerMotivation').value,
    expiry: document.getElementById('offerExpiry').value,
    status: document.getElementById('offerStatus').value
  };
  let modal = document.getElementById('offerPreviewModal');
  if(!modal){
    modal = document.createElement('div');
    modal.id = 'offerPreviewModal';
    modal.className = 'offer-preview-modal';
    modal.innerHTML = `
      <div class="offer-preview-content">
        <div style="padding: 1.5rem; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; color: var(--primary-color);"><i class="fas fa-eye"></i> Anteprima Offerta</h3>
          <button onclick="closeOfferPreview()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #666;">‚úñ</button>
        </div>
        <div id="offerPreviewContent" style="padding: 2rem;"></div>
      </div>`;
    document.body.appendChild(modal);
  }
  document.getElementById('offerPreviewContent').innerHTML = createOfferHTML(offerData);
  modal.style.display = 'flex';
}

function closeOfferPreview(){
  const modal = document.getElementById('offerPreviewModal');
  if(modal) modal.style.display = 'none';
}

function createOfferHTML(offerData){
  return `
    <section class="monthly-offer" style="margin: 0; transform: none;">
      <h2>${offerData.title}</h2>
      <div class="offer-highlight">${offerData.highlight}</div>
      <div class="offer-details">${offerData.details}</div>
      ${offerData.motivation}
      <div class="offer-validity">
        <strong>Affrettati! Offerte valide fino al: <span style="color:var(--secondary-color)">${offerData.expiry}</span></strong><br>
        <small>o fino ad esaurimento scorte</small>
      </div>
    </section>`;
}

function updateOfferDisplay(offerData){
  const offerSection = document.querySelector('.monthly-offer');
  if(!offerSection) return;
  offerSection.innerHTML = createOfferHTML(offerData);
  if(offerData.status === 'hidden'){
    offerSection.classList.add('hidden');
  } else {
    offerSection.classList.remove('hidden');
  }
}

/* ---------- ÁÆ°ÁêÜÂëòÂÖ•Âè£ ---------- */
function enableAdminPanel() {
  const user = localStorage.getItem('firebaseUser');
  if (user) { openAdminPanel(); return; }
  const pwd = prompt('üîê Password del giorno\n\nInserisci la password:');
  if (pwd === generateDynamicPassword() || ADMIN_CONFIG.STATIC_PASSWORDS.includes(pwd)) {
    openAdminPanel();
  } else if (pwd !== null) {
    alert('‚ùå Password non valida');
  }
}
function openAdminPanel() {
  document.getElementById('adminPanel').classList.add('active');
  document.getElementById('adminOverlay').classList.add('active');
  updateAdminStats();
}
function closeAdminPanel() {
  document.getElementById('adminPanel').classList.remove('active');
  document.getElementById('adminOverlay').classList.remove('active');
}

/* ---------- ÁÆ°ÁêÜÂëòÁªüËÆ° ---------- */
function updateAdminStats() {
  const localProducts = loadStorage('supershop_local_products')||[];
  const allProducts = [...products, ...localProducts, ...Object.entries(window.currentRealtimeProducts).map(([id, data]) => ({ id, ...data }))];
  const totalProductsElement = document.getElementById('totalProducts');
  const totalCategoriesElement = document.getElementById('totalCategories');
  const realtimeProductsElement = document.getElementById('realtimeProducts');
  if (totalProductsElement) totalProductsElement.textContent = allProducts.length;
  if (totalCategoriesElement) {
    const categories = new Set(allProducts.map(p => p.category));
    totalCategoriesElement.textContent = categories.size;
  }
  if (realtimeProductsElement) {
    realtimeProductsElement.textContent = Object.keys(window.currentRealtimeProducts).length;
  }
}

/* ---------- ÂÆûÊó∂‰∫ßÂìÅÁÆ°ÁêÜ ---------- */
function enableRealtimeAdmin() {
  const pwd = prompt("Inserisci password amministratore per la gestione real-time:");
  if(pwd === null) return;
  if(pwd === generateDynamicPassword() || ADMIN_CONFIG.STATIC_PASSWORDS.includes(pwd)) {
    document.getElementById('realtimeAdminSection').style.display = "block";
    document.getElementById('realtimeAdminLoginBtn').style.display = "none";
    showSyncStatus('Accesso real-time attivato','success');
  } else {
    alert("Password errata!");
  }
}
function toggleDiscountFields() {
  const df = document.getElementById('discountFields');
  df.style.display = document.getElementById('newProductDiscount').checked ? 'block' : 'none';
}
function resetRealtimeForm() {
  document.getElementById('newProductBarcode').value = "";
  document.getElementById('newProductName').value = "";
  document.getElementById('newProductCategory').value = "regalo";
  document.getElementById('newProductPrice').value = "";
  document.getElementById('newProductImage').value = "";
  document.getElementById('newProductDescription').value = "";
  document.getElementById('newProductDiscount').checked = false;
  document.getElementById('newDiscountPrice').value = "";
  document.getElementById('newDiscountTagText').value = "Offerta!";
  document.getElementById('newDiscountTagColor').value = "#ff0000";
  document.getElementById('addOrUpdateBtn').innerHTML = '<i class="fas fa-plus"></i> Aggiungi Prodotto';
  document.getElementById('addOrUpdateBtn').className = 'admin-action-btn success';
  toggleDiscountFields();
}
function addOrUpdateProduct() {
  if (!window.firebaseAvailable || !window.firebaseDatabase) { alert("Firebase non disponibile"); return; }
  const barcode = document.getElementById('newProductBarcode').value.trim();
  const name = document.getElementById('newProductName').value.trim();
  const category = document.getElementById('newProductCategory').value;
  const price = parseFloat(document.getElementById('newProductPrice').value);
  const image = document.getElementById('newProductImage').value.trim() || DEFAULT_IMAGE;
  const description = document.getElementById('newProductDescription').value.trim() || name;
  const isDiscount = document.getElementById('newProductDiscount').checked;
  const discountPrice = isDiscount ? parseFloat(document.getElementById('newDiscountPrice').value) : null;
  if(!barcode||barcode.length<8){alert("Inserisci un codice a barre valido (almeno 8 caratteri)");return;}
  if(!name){alert("Il nome del prodotto √® obbligatorio");return;}
  if(isNaN(price)||price<=0){alert("Inserisci un prezzo valido maggiore di 0");return;}
  if(isDiscount&&(isNaN(discountPrice)||discountPrice<=0)){alert("Inserisci un prezzo scontato valido");return;}
  const productData = {
    name, category, price, image, description,
    isDiscount, discountPrice,
    discountTagText: isDiscount ? (document.getElementById('newDiscountTagText').value||"Offerta!") : "",
    discountTagColor: isDiscount ? document.getElementById('newDiscountTagColor').value : "#ff0000",
    discountPercentage: isDiscount&&discountPrice?parseFloat(((price-discountPrice)/price*100).toFixed(2)):0,
    lastUpdated: new Date().toISOString(),
    createdAt: window.currentRealtimeProducts[barcode]?.createdAt || new Date().toISOString()
  };
  const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + barcode);
  window.firebaseSet(productRef, productData)
    .then(() => { showSyncStatus('Prodotto salvato con successo','success'); resetRealtimeForm(); })
    .catch(err => { console.error(err); showSyncStatus('Errore nel salvataggio','error'); });
}

function renderRealtimeProducts(products) {
  const container = document.getElementById('realtimeProductsContainer');
  if (!container) return;
  container.innerHTML = '';
  if (Object.keys(products).length === 0) {
    container.innerHTML = `<div style="text-align:center;padding:2rem;color:#666"><i class="fas fa-inbox fa-2x mb-2 opacity-50"></i><p>Nessun prodotto real-time presente</p></div>`;
    return;
  }
  Object.entries(products).forEach(([barcode, p]) => {
    const div = document.createElement('div');
    div.className = 'realtime-product';
    const priceHtml = p.isDiscount ?
      `<span class="realtime-product-price">‚Ç¨${p.discountPrice}</span><s style="color:#999;margin-left:.5rem;">‚Ç¨${p.price}</s><span class="discount-tag" style="background:${p.discountTagColor};margin-left:.5rem">${p.discountTagText}</span>` :
      `<span class="realtime-product-price">‚Ç¨${p.price}</span>`;
    div.innerHTML = `
      <div class="realtime-product-info">
        <strong>${p.name}</strong>
        <small>Codice: ${barcode} | Categoria: ${p.category}</small>
        <div style="margin-top:.3rem">${priceHtml}</div>
      </div>
      <div class="realtime-product-actions">
        <button class="admin-action-btn warning" onclick="editRealtimeProduct('${barcode}')" title="Modifica"><i class="fas fa-edit"></i></button>
        <button class="admin-action-btn danger" onclick="deleteRealtimeProduct('${barcode}')" title="Elimina"><i class="fas fa-trash"></i></button>
      </div>`;
    container.appendChild(div);
  });
}

function editRealtimeProduct(barcode) {
  if (!window.firebaseAvailable) return;
  const p = window.currentRealtimeProducts[barcode];
  if (!p) return;
  document.getElementById('newProductBarcode').value = barcode;
  document.getElementById('newProductName').value = p.name || "";
  document.getElementById('newProductCategory').value = p.category || "regalo";
  document.getElementById('newProductPrice').value = p.price || "";
  document.getElementById('newProductImage').value = p.image || "";
  document.getElementById('newProductDescription').value = p.description || "";
  document.getElementById('newProductDiscount').checked = p.isDiscount || false;
  if(p.isDiscount){
    document.getElementById('newDiscountPrice').value = p.discountPrice;
    document.getElementById('newDiscountTagText').value = p.discountTagText || "Offerta!";
    document.getElementById('newDiscountTagColor').value = p.discountTagColor || "#ff0000";
  }
  toggleDiscountFields();
  document.getElementById('addOrUpdateBtn').innerHTML = '<i class="fas fa-save"></i> Aggiorna Prodotto';
  document.getElementById('addOrUpdateBtn').className = 'admin-action-btn warning';
  document.getElementById('newProductBarcode').scrollIntoView({ behavior: 'smooth' });
}
function deleteRealtimeProduct(barcode) {
  if (!window.firebaseAvailable) return;
  const p = window.currentRealtimeProducts[barcode];
  if(!p) return;
  if(confirm(`Sei sicuro di voler eliminare il prodotto "${p.name}"?`)){
    const productRef = window.firebaseRef(window.firebaseDatabase, 'products/' + barcode);
    window.firebaseRemove(productRef)
      .then(() => showSyncStatus('Prodotto eliminato','success'))
      .catch(err => { console.error(err); showSyncStatus('Errore eliminazione','error'); });
  }
}

/* ---------- Êú¨Âú∞‰∫ßÂìÅÁÆ°ÁêÜ ---------- */
function addLocalProduct() {
  const name = document.getElementById('localProductName').value.trim();
  const barcode = document.getElementById('localProductBarcode').value.trim();
  const category = document.getElementById('localProductCategory').value;
  const originalPrice = parseFloat(document.getElementById('localOriginalPrice').value)||0;
  const discountPrice = parseFloat(document.getElementById('localDiscountPrice').value)||0;
  const image = document.getElementById('localProductImage').value.trim() || DEFAULT_IMAGE;
  const description = document.getElementById('localProductDescription').value.trim() || name;
  if(!name||!barcode){alert("Nome e codice a barre sono obbligatori");return;}
  const localProducts = loadStorage('supershop_local_products')||[];
  const idx = localProducts.findIndex(p=>p.id===barcode);
  const product = {
    id: barcode, name, category, image, description,
    originalPrice: originalPrice>0?`‚Ç¨${originalPrice.toFixed(2).replace('.',',')}`:undefined,
    discountPrice: discountPrice>0?`‚Ç¨${discountPrice.toFixed(2).replace('.',',')}`:undefined,
    price: originalPrice>0&&!discountPrice?`‚Ç¨${originalPrice.toFixed(2).replace('.',',')}`:undefined,
    discountPercentage: originalPrice>0&&discountPrice>0&&discountPrice<originalPrice?parseFloat(((originalPrice-discountPrice)/originalPrice*100).toFixed(2)):0
  };
  if(idx>=0){localProducts[idx]=product;}else{localProducts.push(product);}
  saveStorage('supershop_local_products',localProducts);
  renderLocalProductsList();
  resetLocalForm();
  renderProducts();
  showSyncStatus('Prodotto locale salvato','success');
}
function resetLocalForm() {
  document.getElementById('localProductName').value="";
  document.getElementById('localProductBarcode').value="";
  document.getElementById('localProductCategory').value="regalo";
  document.getElementById('localOriginalPrice').value="";
  document.getElementById('localDiscountPrice').value="";
  document.getElementById('localProductImage').value="";
  document.getElementById('localProductDescription').value="";
}
function renderLocalProductsList() {
  const list = document.getElementById('localProductsList');
  const localProducts = loadStorage('supershop_local_products')||[];
  if(list){
    if(localProducts.length===0){
      list.innerHTML='<div style="text-align:center;color:#666;padding:1rem">Nessun prodotto locale</div>';
      return;
    }
    list.innerHTML=localProducts.map((p,idx)=>`
      <div class="local-product-item">
        <div>
          <strong>${p.name}</strong> <small>(${p.id})</small><br>
          <small>${p.discountPrice||p.price||'Prezzo su richiesta'} - ${p.category}</small>
        </div>
        <div>
          <button class="admin-action-btn warning" style="padding:.3rem .5rem;font-size:.7rem" onclick="editLocalProduct(${idx})"><i class="fas fa-edit"></i></button>
          <button class="admin-action-btn danger" style="padding:.3rem .5rem;font-size:.7rem" onclick="deleteLocalProduct(${idx})"><i class="fas fa-trash"></i></button>
        </div>
      </div>
    `).join('');
  }
}
function editLocalProduct(idx){
  const localProducts = loadStorage('supershop_local_products')||[];
  const p=localProducts[idx];
  if(!p)return;
  document.getElementById('localProductName').value=p.name;
  document.getElementById('localProductBarcode').value=p.id;
  document.getElementById('localProductCategory').value=p.category;
  const op = p.originalPrice?parseFloat(p.originalPrice.replace('‚Ç¨','').replace(',','.')):'';
  const dp = p.discountPrice?parseFloat(p.discountPrice.replace('‚Ç¨','').replace(',','.')):'';
  document.getElementById('localOriginalPrice').value=op||'';
  document.getElementById('localDiscountPrice').value=dp||'';
  document.getElementById('localProductImage').value=p.image===DEFAULT_IMAGE?'':p.image;
  document.getElementById('localProductDescription').value=p.description||'';
}
function deleteLocalProduct(idx){
  const localProducts = loadStorage('supershop_local_products')||[];
  if(confirm('Eliminare questo prodotto locale?')){
    localProducts.splice(idx,1);
    saveStorage('supershop_local_products',localProducts);
    renderLocalProductsList();
    renderProducts();
    showSyncStatus('Prodotto locale eliminato','success');
  }
}

/* ---------- CSV ÂØºÂá∫ / ÂØºÂÖ• ---------- */
function exportProductsCSV() {
  const localProducts = loadStorage('supershop_local_products')||[];
  if(localProducts.length===0){alert("Nessun prodotto locale da esportare");return;}
  const csv=['id,name,category,originalPrice,discountPrice,image,description'];
  localProducts.forEach(p=>{
    csv.push(`"${p.id}","${p.name}","${p.category}","${p.originalPrice||''}","${p.discountPrice||''}","${p.image}","${p.description}"`);
  });
  const blob=new Blob([csv.join('\n')],{type:'text/csv;charset=utf-8;'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='prodotti_supershop.csv';
  link.click();
  showSyncStatus('CSV esportato','success');
}
function importProductsCSV() {
  const file=document.getElementById('csvFile').files[0];
  if(!file){alert("Seleziona un file CSV");return;}
  const reader=new FileReader();
  reader.onload=function(e){
    const text=e.target.result;
    const lines=text.split('\n').filter(l=>l.trim());
    lines.shift(); // header
    const imported=[];
    lines.forEach(l=>{
      const [id,name,category,originalPrice,discountPrice,image,description]=l.split('","').map(s=>s.replace(/^"|"$/g,''));
      if(id&&name){
        imported.push({
          id,name,category,image: image||DEFAULT_IMAGE,description:description||name,
          originalPrice: originalPrice||undefined,
          discountPrice: discountPrice||undefined,
          price: !originalPrice&&!discountPrice?'Prezzo su richiesta':undefined,
          discountPercentage: originalPrice&&discountPrice&&parseFloat(discountPrice.replace('‚Ç¨','').replace(',','.'))<parseFloat(originalPrice.replace('‚Ç¨','').replace(',','.'))?parseFloat(((parseFloat(originalPrice.replace('‚Ç¨','').replace(',','.'))-parseFloat(discountPrice.replace('‚Ç¨','').replace(',','.')))/parseFloat(originalPrice.replace('‚Ç¨','').replace(',','.'))*100).toFixed(2)):0
        });
      }
    });
    if(confirm(`Importare ${imported.length} prodotti? Sovrascriveranno quelli locali con stesso barcode.`)){
      const existing=loadStorage('supershop_local_products')||[];
      imported.forEach(imp=>{
        const idx=existing.findIndex(e=>e.id===imp.id);
        if(idx>=0)existing[idx]=imp;else existing.push(imp);
      });
      saveStorage('supershop_local_products',existing);
      renderLocalProductsList();
      renderProducts();
      showSyncStatus('CSV importato','success');
    }
  };
  reader.readAsText(file);
}

/* ---------- Â§á‰ªΩ / Ê∏ÖÁ©∫ ---------- */
function backupData() {
  const data={
    localProducts: loadStorage('supershop_local_products')||[],
    offerContent: loadStorage('supershop_offer_content'),
    cookiePreferences: cookiePreferences
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const link=document.createElement('a');
  link.href=URL.createObjectURL(blob);
  link.download='backup_supershop_'+new Date().toISOString().slice(0,10)+'.json';
  link.click();
  showSyncStatus('Backup completato','success');
}
function clearAllData() {
  if(confirm('Sei sicuro di voler cancellare TUTTI i dati locali?')){
    localStorage.removeItem('supershop_local_products');
    localStorage.removeItem('supershop_offer_content');
    renderLocalProductsList();
    renderProducts();
    showSyncStatus('Dati locali cancellati','success');
  }
}

/* ---------- ÂêåÊ≠•Êú¨Âú∞ ‚Üí Firebase ---------- */
function syncAllProducts() {
  if (!window.firebaseAvailable || !window.firebaseDatabase) { alert("Firebase non disponibile"); return; }
  const localProducts = loadStorage('supershop_local_products')||[];
  if(localProducts.length===0){alert("Nessun prodotto locale da sincronizzare");return;}
  let synced=0;
  localProducts.forEach(p=>{
    const realtimeData={
      name:p.name,category:p.category,image:p.image,description:p.description,
      price: p.originalPrice?parseFloat(p.originalPrice.replace('‚Ç¨','').replace(',','.')):0,
      isDiscount: !!(p.discountPrice&&p.originalPrice&&parseFloat(p.discountPrice.replace('‚Ç¨','').replace(',','.'))<parseFloat(p.originalPrice.replace('‚Ç¨','').replace(',','.'))),
      discountPrice: p.discountPrice?parseFloat(p.discountPrice.replace('‚Ç¨','').replace(',','.')):null,
      discountTagText: 'Offerta!', discountTagColor: '#ff0000',
      lastUpdated: new Date().toISOString(),
      createdAt: new Date().toISOString()
    };
    const ref=window.firebaseRef(window.firebaseDatabase,'products/'+p.id);
    window.firebaseSet(ref,realtimeData).then(()=>synced++).catch(err=>console.error(err));
  });
  showSyncStatus(`Sincronizzati ${synced} prodotti con Firebase`,'success');
}

/* ---------- ‰∫ßÂìÅÂ±ïÁ§∫ ---------- */
function renderProducts() {
  const container = document.getElementById('products-container');
  if (!container) return;
  const search = document.getElementById('product-search').value.toLowerCase();
  const category = document.getElementById('category-filter').value;
  const localProducts = loadStorage('supershop_local_products')||[];
  const allProducts = [...products, ...localProducts];
  Object.entries(window.currentRealtimeProducts).forEach(([barcode, p]) => {
    const existing = allProducts.findIndex(x => x.id === barcode);
    if (existing >= 0) allProducts[existing] = { ...allProducts[existing], ...p, source: 'firebase' };
    else allProducts.push({ id: barcode, ...p, source: 'firebase' });
  });
  filteredProducts = allProducts.filter(p => {
    const matchesSearch = p.name.toLowerCase().includes(search) || p.id.includes(search);
    const matchesCategory = category === 'all' || p.category === category;
    return matchesSearch && matchesCategory;
  });
  const end = currentPage * productsPerPage;
  const productsToShow = filteredProducts.slice(0, end);
  container.innerHTML = productsToShow.map(p => `
    <div class="product-card" onclick="openProductModal('${p.id}')">
      <img src="${p.image}" alt="${p.name}" class="product-image" onerror="this.src='${DEFAULT_IMAGE}'">
      ${(p.discountPrice && p.discountPrice < p.price) ? `<div class="discount-badge">-${p.discountPercentage}%</div>` : ''}
      ${p.source === 'firebase' ? `<div class="discount-badge" style="background:#004080;top:40px;"><i class="fas fa-bolt"></i> Live</div>` : ''}
      <div class="product-info">
        <div class="product-name">${p.name}</div>
        <div class="product-price-container">
          ${(p.isDiscount && p.discountPrice) ? 
            `<span class="original-price">‚Ç¨${p.price}</span><span class="discount-price">‚Ç¨${p.discountPrice}</span>` : 
            (p.discountPrice && p.originalPrice) ?
            `<span class="original-price">${p.originalPrice}</span><span class="discount-price">${p.discountPrice}</span>` :
            `<span class="discount-price">${p.price ? '‚Ç¨' + p.price : (p.originalPrice || 'Prezzo su richiesta')}</span>`}
        </div>
        <span class="product-category">${p.category}</span>
        <div class="product-barcode-small">Codice: ${p.id}</div>
        ${p.source === 'firebase' ? `<div class="product-barcode-small" style="color:#004080;"><i class="fas fa-sync"></i> Aggiornato in tempo reale</div>` : ''}
      </div>
    </div>
  `).join('');
  const loadMoreBtn = document.getElementById('load-more');
  if (loadMoreBtn) loadMoreBtn.style.display = end < filteredProducts.length ? 'block' : 'none';
}
function openProductModal(productId) {
  const p = [...products, ...(loadStorage('supershop_local_products')||[]), ...Object.entries(window.currentRealtimeProducts).map(([id, data]) => ({ id, ...data }))].find(x => x.id === productId);
  if(!p) return;
  
  document.getElementById('modalImage').src = p.image;
  document.getElementById('modalName').textContent = p.name || '';
  
  // ‰øÆÂ§ç‰ª∑Ê†ºÊòæÁ§∫ÈÄªËæë
  let priceText = '';
  if (p.discountPrice && p.originalPrice) {
    // Êú¨Âú∞‰∫ßÂìÅÊ†ºÂºèÔºöÂ≠óÁ¨¶‰∏≤ "‚Ç¨3,50"
    priceText = `Prezzo: ${p.discountPrice} (Originale: ${p.originalPrice})`;
  } else if (p.isDiscount && p.discountPrice) {
    // ÂÆûÊó∂‰∫ßÂìÅÊ†ºÂºèÔºöÊï∞Â≠ó 3.5
    priceText = `Prezzo: ‚Ç¨${p.discountPrice} (Originale: ‚Ç¨${p.price})`;
  } else if (p.price) {
    // Âè™ÊúâÂéü‰ª∑ÁöÑÊÉÖÂÜµ
    priceText = `Prezzo: ${typeof p.price === 'number' ? '‚Ç¨' + p.price : p.price}`;
  } else if (p.originalPrice) {
    // Âè™ÊúâÂéü‰ª∑ÁöÑÊú¨Âú∞‰∫ßÂìÅ
    priceText = `Prezzo: ${p.originalPrice}`;
  } else {
    priceText = 'Prezzo: N/D';
  }
  
  document.getElementById('modalPrice').textContent = priceText;
  document.getElementById('modalCategory').textContent = 'Categoria: ' + (p.category || '');
  document.getElementById('modalBarcode').textContent = 'Codice: ' + p.id;
  document.getElementById('modalDescription').textContent = p.description || '';
  document.getElementById('productModal').style.display = 'flex';
}
function closeProductModal(){
  document.getElementById('productModal').style.display = 'none';
}

/* ---------- Êµ∑Êä•ÁîüÊàêÂô® ---------- */
function openPosterGenerator() {
  document.getElementById('poster-generator').style.display = 'flex';
  document.body.style.overflow = 'hidden';
  updatePosterPreview();
}
function closePosterGenerator() {
  document.getElementById('poster-generator').style.display = 'none';
  document.body.style.overflow = 'auto';
}
function updatePosterPreview() {
  const title = document.getElementById('posterTitle').value;
  const subtitle = document.getElementById('posterSubtitle').value;
  const featuredProducts = document.getElementById('featuredProducts').value;
  const expiryDate = document.getElementById('expiryDate').value;
  const includeQR = document.getElementById('includeQR').checked;
  const preview = document.getElementById('posterPreview');
  preview.innerHTML = `
    <div style="width:595px;height:842px;padding:40px;background:white;font-family:Arial,sans-serif;box-sizing:border-box;margin:0 auto;color:#000;display:flex;flex-direction:column;justify-content:space-between;border:1px solid #ccc;">
      <div style="text-align:center;margin-bottom:30px;">
        <h1 style="font-weight:900;font-size:42px;margin:0 0 15px 0;background:#000;color:#fff;padding:25px 20px;border-radius:8px;letter-spacing:1px;line-height:1.2;">${title}</h1>
        <h2 style="font-weight:bold;font-size:20px;margin:0;border-bottom:3px solid #000;padding-bottom:12px;line-height:1.3;">${subtitle}</h2>
      </div>
      <div style="flex:1;display:flex;flex-direction:column;justify-content:space-between;gap:25px;">
        <div style="background:#f8f8f8;padding:25px;border-radius:8px;border-left:6px solid #000;">
          <h3 style="font-weight:bold;margin:0 0 20px 0;font-size:22px;text-align:center;color:#000;">üõçÔ∏è IN PROMOZIONE</h3>
          <div style="font-size:16px;line-height:1.6;text-align:center;">
            ${featuredProducts.split('\n').map(line => `<div style="margin-bottom:12px;padding:8px 0;border-bottom:1px dashed #999;">${line}</div>`).join('')}
          </div>
        </div>
        <div style="background:#e8e8e8;padding:20px;border-radius:8px;border:3px dashed #666;text-align:center;">
          <p style="margin:0 0 10px 0;font-size:18px;font-weight:bold;">üèÉ‚Äç‚ôÇÔ∏è APPROFITTA SUBITO!</p>
          <p style="margin:0;font-size:14px;">Le migliori occasioni ti aspettano in negozio</p>
        </div>
        ${includeQR ? `
        <div style="text-align:center;">
          <div style="display:inline-block;padding:15px;border:3px solid #000;background:#fff;border-radius:8px;">
            <p style="margin:0 0 12px 0;font-size:16px;font-weight:bold;">üì± SCANSIONA PER TUTTI I PRODOTTI</p>
            <img src="1000011850.png" alt="QR Code Supershop Bisagno" style="width:120px;height:120px;border:2px solid #ccc;padding:5px;background:white;border-radius:5px;">
          </div>
        </div>` : ''}
      </div>
      <div style="margin-top:30px;">
        <div style="background:#000;color:#fff;padding:15px;border-radius:6px;text-align:center;margin-bottom:15px;">
          <p style="margin:0;font-size:16px;font-weight:bold;">üìÜ OFFERTE VALIDE FINO AL: ${expiryDate}</p>
        </div>
        <div style="background:#f0f0f0;padding:15px;border-radius:6px;text-align:center;margin-bottom:15px;border:2px solid #333;">
          <p style="margin:0 0 5px 0;font-size:14px;font-weight:bold;">üè™ SUPERSHOP BISAGNO S.R.L.</p>
          <p style="margin:0;font-size:11px;">Lungobisagno Istria, 29F - 16139 Genova GE | 8:45-19:45 | supershopbisagnosrl@gmail.com</p>
        </div>
        <div style="background:#e8e8e8;padding:10px;border-radius:4px;border:1px solid #999;">
          <p style="margin:0;font-size:9px;color:#666;line-height:1.3;text-align:center;">‚öñÔ∏è Le promozioni si applicano esclusivamente a una selezione di articoli. Le percentuali di sconto possono variare in base al prodotto. Disponibilit√† limitata fino ad esaurimento scorte.</p>
        </div>
      </div>
    </div>
  `;
}
function saveOfferToFirebase() {
  const offerData = {
    title: document.getElementById('posterTitle').value,
    subtitle: document.getElementById('posterSubtitle').value,
    products: document.getElementById('featuredProducts').value,
    expiryDate: document.getElementById('expiryDate').value
  };
  if (window.firebaseAvailable) {
    const offerRef = window.firebaseRef(window.firebaseDatabase, 'offer');
    window.firebaseSet(offerRef, offerData);
  }
  saveStorage('supershop_offer_content', offerData);
}
function renderMonthlyOffer(o) {
  const box = document.getElementById('monthly-offer');
  if (!box) return;
  box.classList.remove('hidden');
  box.innerHTML = `
    <div class="offer-highlight">${o.title}</div>
    <div class="offer-details">
      <p><strong>${o.subtitle}</strong></p>
      <pre style="white-space:pre-wrap;margin:1rem 0">${o.products}</pre>
    </div>
    <div class="offer-validity">üóìÔ∏è Valido fino alÔºö${o.expiryDate}</div>
  `;
}
function printPoster() {
  const title = document.getElementById('posterTitle').value;
  const subtitle = document.getElementById('posterSubtitle').value;
  const featuredProducts = document.getElementById('featuredProducts').value;
  const expiryDate = document.getElementById('expiryDate').value;
  const includeQR = document.getElementById('includeQR').checked;
  const printablePoster = document.getElementById('printable-poster');
  printablePoster.innerHTML = `
    <div style="width:210mm;height:297mm;padding:15mm;background:white;font-family:Arial,sans-serif;box-sizing:border-box;margin:0 auto;color:#000;display:flex;flex-direction:column;justify-content:space-between;page-break-inside:avoid;">
      <div style="text-align:center;margin-bottom:10mm;">
        <h1 style="font-weight:900;font-size:36pt;margin:0 0 4mm 0;background:#000;color:#fff;padding:8mm 4mm;border-radius:3mm;letter-spacing:1pt;line-height:1.2;">${title}</h1>
        <h2 style="font-weight:bold;font-size:18pt;margin:0;border-bottom:1.5pt solid #000;padding-bottom:2mm;line-height:1.3;">${subtitle}</h2>
      </div>
      <div style="flex:1;display:flex;flex-direction:column;justify-content:space-around;gap:6mm;">
        <div style="background:#f8f8f8;padding:6mm;border-radius:3mm;border-left:4pt solid #000;">
          <h3 style="font-weight:bold;margin:0 0 4mm 0;font-size:16pt;text-align:center;color:#000;">üõçÔ∏è IN PROMOZIONE</h3>
          <div style="font-size:12pt;line-height:1.5;text-align:center;">
            ${featuredProducts.split('\n').map(line => `<div style="margin-bottom:2mm;padding:1mm 0;border-bottom:0.5pt dashed #999;">${line}</div>`).join('')}
          </div>
        </div>
        <div style="background:#e8e8e8;padding:5mm;border-radius:3mm;border:1.5pt dashed #666;text-align:center;">
          <p style="margin:0 0 2mm 0;font-size:14pt;font-weight:bold;">üèÉ‚Äç‚ôÇÔ∏è APPROFITTA SUBITO!</p>
          <p style="margin:0;font-size:11pt;">Le migliori occasioni ti aspettano in negozio</p>
        </div>
        ${includeQR ? `
        <div style="text-align:center;">
          <div style="display:inline-block;padding:4mm;border:1.5pt solid #000;background:#fff;border-radius:3mm;">
            <p style="margin:0 0 3mm 0;font-size:12pt;font-weight:bold;">üì± SCANSIONA PER TUTTI I PRODOTTI</p>
            <img src="1000011850.png" alt="QR Code Supershop Bisagno" style="width:60mm;height:60mm;border:1pt solid #ccc;padding:2mm;background:white;border-radius:2mm;">
          </div>
        </div>` : ''}
      </div>
      <div style="margin-top:8mm;">
        <div style="background:#000;color:#fff;padding:4mm;border-radius:2mm;text-align:center;margin-bottom:3mm;">
          <p style="margin:0;font-size:12pt;font-weight:bold;">üìÜ OFFERTE VALIDE FINO AL: ${expiryDate}</p>
        </div>
        <div style="background:#f0f0f0;padding:4mm;border-radius:2mm;text-align:center;margin-bottom:3mm;border:0.5pt solid #333;">
          <p style="margin:0 0 1mm 0;font-size:10pt;font-weight:bold;">üè™ SUPERSHOP BISAGNO S.R.L.</p>
          <p style="margin:0;font-size:8pt;">Lungobisagno Istria, 29F - 16139 Genova GE | 8:45-19:45 | supershopbisagnosrl@gmail.com</p>
        </div>
        <div style="background:#e8e8e8;padding:2mm;border-radius:1mm;border:0.5pt solid #999;">
          <p style="margin:0;font-size:6pt;color:#666;line-height:1.2;text-align:center;">‚öñÔ∏è Le promozioni si applicano esclusivamente a una selezione di articoli. Le percentuali di sconto possono variare in base al prodotto. Disponibilit√† limitata fino ad esaurimento scorte.</p>
        </div>
      </div>
    </div>
  `;

  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>Poster Promozionale - Supershop Bisagno</title>
      <style>
        @media print {
          @page { margin: 0; size: A4; }
          body { margin: 0; padding: 0; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
          * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; box-sizing: border-box; }
        }
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: white; }
      </style>
    </head>
    <body>
      ${printablePoster.innerHTML}
      <script>
        window.onload = function() {
          window.print();
          setTimeout(function() { window.close(); }, 500);
        }
      <\/script>
    </body>
    </html>
  `);
  printWindow.document.close();
}

/* ---------- ÂÆûÊó∂ÁõëÂê¨ Firebase ‰ºòÊÉ†ÂÜÖÂÆπ ---------- */
function listenRealtimeOffer() {
  if (!window.firebaseAvailable) return;
  const offerRef = window.firebaseRef(window.firebaseDatabase, 'offer');
  window.firebaseOnValue(offerRef, snap => {
    const data = snap.val();
    if (data) {
      renderMonthlyOffer(data);           // ÂÆûÊó∂Ê∏≤Êüì
      saveStorage('supershop_offer_content', data); // ÂêåÊó∂ÁºìÂ≠ò
    } else {
      // Firebase Ê≤°Êï∞ÊçÆÂ∞±ÂõûÈÄÄËØªÊú¨Âú∞
      const local = loadStorage('supershop_offer_content');
      if (local) renderMonthlyOffer(local);
      else setDefaultOfferContent(); // ÂÜçÂÖúÂ∫ïÈªòËÆ§
    }
  });
}

/* ---------- ÂàùÂßãÂåñ ---------- */
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('hiddenAdminBtn').style.display = 'block';
  initCookieBanner();
  setTimeout(() => {
    renderProducts();
    updateAdminStats();
    renderLocalProductsList();
    listenRealtimeOffer();
// Ê∑ªÂä†ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÁöÑÂäüËÉΩ
document.addEventListener('click', function(e) {
  if (e.target.id === 'closeModal') {
    closeProductModal();
  }
});

// ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®‰πüÂÖ≥Èó≠
document.getElementById('productModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeProductModal();
  }
});
  }, 1000);

  /* ÁªëÂÆö‰∫ã‰ª∂ */
  document.getElementById('hiddenAdminBtn').addEventListener('click', enableAdminPanel);
  document.getElementById('adminBtn').addEventListener('click', enableAdminPanel);
  document.getElementById('adminOverlay').addEventListener('click', closeAdminPanel);
  document.getElementById('product-search').addEventListener('input', () => { currentPage = 1; renderProducts(); });
  document.getElementById('category-filter').addEventListener('change', () => { currentPage = 1; renderProducts(); });
  document.getElementById('load-more').addEventListener('click', () => { currentPage++; renderProducts(); });
  document.querySelector('.mobile-menu-btn').addEventListener('click', () => {
    const nav = document.getElementById('navMenu');
    nav.style.display = nav.style.display === 'flex' ? 'none' : 'flex';
  });
  const backToTop = document.getElementById('backToTop');
  window.addEventListener('scroll', () => backToTop.classList.toggle('visible', window.pageYOffset > 300));
  backToTop.addEventListener('click', (e) => { e.preventDefault(); window.scrollTo({top: 0, behavior: 'smooth'}); });
});
</script>
</body>
</html>
