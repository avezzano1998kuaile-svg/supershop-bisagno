<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Supershop Bisagno S.R.L. - Articoli Regalo, Giocattoli, Casalinghi Genova</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Supershop Bisagno S.R.L. - Articoli regalo, giocattoli, cartoleria, casalinghi, ferramenta a Genova. Dal 2019 il vostro punto di riferimento.">
<meta name="keywords" content="supershop bisagno, genova, articoli regalo, giocattoli, casalinghi, ferramenta, natale">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõçÔ∏è</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ‰øùÊåÅ‰Ω†ÊâÄÊúâÁöÑÁé∞ÊúâÊ†∑Âºè‰∏çÂèò */
:root{
    --primary-color:#004080;
    --secondary-color:#ff6b00;
    --light-color:#f9f9f9;
    --dark-color:#333;
    --shadow:0 4px 6px rgba(0,0,0,0.1);
    --transition:all 0.3s ease
}
*{
    margin:0;
    padding:0;
    box-sizing:border-box
}
/* ... ‰Ω†ÊâÄÊúâÁöÑÁé∞ÊúâCSSÊ†∑ÂºèÔºàÂÆåÂÖ®‰øùÊåÅ‰∏çÂèòÔºâ ... */
</style>

<!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, doc, updateDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ‰Ω†ÁöÑ Firebase ÈÖçÁΩÆ
    const firebaseConfig = {
        apiKey: "AIzaSyA-cfBzR8BIFwYqoTk3dUo2uXHkw-c8rPU",
        authDomain: "supershop-bisagno.firebaseapp.com",
        projectId: "supershop-bisagno",
        storageBucket: "supershop-bisagno.firebasestorage.app",
        messagingSenderId: "381483524192",
        appId: "1:381483524192:web:ac657@bbd5725719e2e385"
    };

    // ÂàùÂßãÂåñ Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ÂÖ®Â±Ä Firebase ÂØπË±°
    window.firebaseApp = app;
    window.firestore = db;
    window.firebaseModules = { 
        collection, getDocs, addDoc, doc, updateDoc, deleteDoc, query, orderBy 
    };
    
    console.log("Firebase inizializzato con successo!");
</script>
</head>
<body>

<!-- ‰øùÊåÅ‰Ω†ÊâÄÊúâÁöÑÁé∞ÊúâHTMLÁªìÊûÑ‰∏çÂèò -->
<!-- sync status -->
<div id="sync-status" class="sync-status" style="display:none"><i class="fas fa-cloud"></i> <span id="sync-text">Sincronizzato</span></div>

<!-- ÈöêËóèÁöÑÁÆ°ÁêÜÂëòÊåâÈíÆ -->
<button class="hidden-admin-btn" id="hiddenAdminBtn" title="Pannello Admin" style="display:none">
    <i class="fas fa-user-shield" style="color:white;font-size:1.2rem"></i>
</button>

<!-- ADMIN PANEL -->
<div class="admin-overlay" id="adminOverlay"></div>
<div class="admin-panel" id="adminPanel">
  <div class="admin-header">
    <h3><i class="fas fa-cogs"></i> Pannello di Amministrazione</h3>
    <button onclick="closeAdminPanel()" style="background:none;border:none;color:white;font-size:1.2rem;cursor:pointer"><i class="fas fa-times"></i></button>
  </div>
  <div class="admin-content">
    <div class="admin-section">
      <h3><i class="fas fa-chart-bar"></i> Statistiche</h3>
      <div class="admin-stats">
        <div class="stat-card"><span class="stat-number" id="totalProducts">0</span><span class="stat-label">Prodotti Totali</span></div>
        <div class="stat-card"><span class="stat-number" id="totalCategories">0</span><span class="stat-label">Categorie</span></div>
        <div class="stat-card"><span class="stat-number"><i class="fas fa-cloud"></i></span><span class="stat-label">Cloud Firebase</span></div>
      </div>
    </div>
    
    <div class="admin-section">
      <h3><i class="fas fa-key"></i> Gestione Password</h3>
      <div class="password-hint"><strong>Accesso riservato al personale autorizzato</strong><br><small>Contatta l'amministratore per le credenziali</small></div>
    </div>
    
    <div class="admin-section">
      <h3><i class="fas fa-plus-circle"></i> Aggiungi Prodotto</h3>
      <div class="admin-form-group"><label>Nome Prodotto</label><input type="text" id="adminProductName" placeholder="Inserisci nome prodotto"></div>
      <div class="admin-form-group"><label>Codice a Barre</label><input type="text" id="adminProductBarcode" placeholder="Inserisci codice a barre 13 cifre"></div>
      <div class="admin-form-group"><label>Categoria</label><select id="adminProductCategory"><option value="regalo">Articoli Regalo</option><option value="giocattoli">Giocattoli</option><option value="cartoleria">Cartoleria</option><option value="casalinghi">Casalinghi</option><option value="ferramenta">Ferramenta</option><option value="animali">Articoli per animali</option><option value="illuminazione">Illuminazione</option><option value="mobili">Mobili</option><option value="natale">Articoli Natalizi</option></select></div>
      <div class="admin-form-group"><label>Prezzo Originale (‚Ç¨)</label><input type="text" id="adminOriginalPrice" placeholder="es: 10,00"></div>
      <div class="admin-form-group"><label>Prezzo Scontato (‚Ç¨)</label><input type="text" id="adminDiscountPrice" placeholder="es: 7,50"></div>
      <div class="admin-form-group"><label>URL Immagine</label><input type="text" id="adminProductImage" placeholder="Inserisci link immagine"></div>
      <div class="admin-form-group"><label>Descrizione</label><textarea id="adminProductDescription" placeholder="Inserisci descrizione prodotto"></textarea></div>
      <div class="admin-actions"><button class="admin-action-btn success" onclick="addProduct()"><i class="fas fa-plus"></i> Aggiungi Prodotto</button></div>
    </div>
    
    <div class="admin-section">
      <h3><i class="fas fa-database"></i> Gestione Dati Cloud</h3>
      <div class="password-hint" style="background:#e3f2fd;border-color:#2196f3">
        <strong><i class="fas fa-cloud"></i> Sistema Cloud Attivo</strong><br>
        <small>I prodotti vengono salvati automaticamente nel database cloud Firebase</small>
      </div>
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="exportProducts()"><i class="fas fa-download"></i> Esporta CSV</button>
        <button class="admin-action-btn secondary" onclick="importProducts()"><i class="fas fa-upload"></i> Importa CSV</button>
        <button class="admin-action-btn success" onclick="importAllToFirebase()"><i class="fas fa-cloud-upload-alt"></i> Importa nel Cloud</button>
      </div>
      <div class="admin-actions" style="margin-top:0.5rem">
        <button class="admin-action-btn warning" onclick="backupData()"><i class="fas fa-save"></i> Backup Dati</button>
        <button class="admin-action-btn danger" onclick="clearAllData()"><i class="fas fa-trash"></i> Cancella Tutto</button>
      </div>
    </div>
    
    <div class="admin-section">
      <h3><i class="fas fa-search"></i> Ricerca Rapida</h3>
      <div class="admin-form-group"><input type="text" id="adminQuickSearch" placeholder="Cerca prodotto..." onkeyup="adminQuickSearch()"></div>
      <div id="adminSearchResults" style="max-height:200px;overflow-y:auto"></div>
    </div>
    
    <div class="admin-section">
      <h3><i class="fas fa-qrcode"></i> QR Code Fisso</h3>
      <div class="password-hint">
        <strong>‚úÖ QR Code Permanente</strong><br>
        <small>I clienti scannerizzano sempre lo stesso QR code e vedono i prodotti aggiornati in tempo reale</small>
      </div>
      <div class="admin-actions">
        <button class="admin-action-btn primary" onclick="updateQRCode()">
          <i class="fas fa-qrcode"></i> Genera QR Code Fisso
        </button>
        <button class="admin-action-btn secondary" onclick="showQRCodeInfo()">
          <i class="fas fa-info-circle"></i> Istruzioni
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ‰øùÊåÅ‰Ω†ÊâÄÊúâÁöÑÁé∞ÊúâÈ°µÈù¢ÁªìÊûÑ -->
<header>
  <div class="header-container">
    <div class="logo"><img src="1000011845.png" alt="SuperShop Logo" class="logo-img" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iIzAwNDA4MCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjI0IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UzwvdGV4dD48L3N2Zz4='"><h1>Supershop Bisagno</h1></div>
    <div style="display:flex;align-items:center;gap:1rem">
      <nav><ul id="navMenu"><li><a href="#home">Home</a></li><li><a href="#about">Chi Siamo</a></li><li><a href="#products">Prodotti</a></li><li><a href="#monthly-offer">Offerte</a></li><li><a href="#hours">Orari</a></li><li><a href="#products-showcase">Catalogo</a></li><li><a href="#contact">Contatti</a></li></ul></nav>
      <button id="adminBtn" title="Pannello Admin"><i class="fas fa-user-shield"></i></button>
      <button class="mobile-menu-btn" aria-label="Menu"><i class="fas fa-bars"></i></button>
    </div>
  </div>
</header>

<section class="hero" id="home">
  <div class="hero-content">
    <h2>Supershop Bisagno S.R.L.</h2>
    <p>ARTICOLI REGALO - GIOCATOLI - CARTOLERIA - CASALINGHI - FERRAMENTA</p>
    <a href="#products-showcase" class="btn">Scopri i nostri prodotti</a>
  </div>
</section>

<main>
  <section id="about">
    <h2>Benvenuti</h2>
    <p>Benvenuti nel sito ufficiale di Supershop Bisagno S.R.L., il vostro punto di riferimento a Genova dal 2019. Offriamo un'ampia selezione di articoli per la casa, articoli per l'igiene personale, prodotti per la pulizia della casa, giocattoli per bambini e articoli per animali domestici.</p>
    <div class="info-grid">
      <div class="info-card">
        <h3><i class="fas fa-store"></i> Il nostro negozio</h3>
        <p>Un ambiente moderno e accogliente dove trovare tutto ci√≤ che ti serve per la casa e la famiglia con la massima convenienza e qualit√†.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-users"></i> La nostra filosofia</h3>
        <p>Crediamo nel servicio al cliente eccellente e nella qualit√† dei prodotti. La soddisfazione dei nostri clienti √® la nostra priorit√†.</p>
      </div>
      <div class="info-card">
        <h3><i class="fas fa-cloud"></i> Catalogo Digitale</h3>
        <p>Scansiona il QR code per vedere tutti i nostri prodotti aggiornati in tempo reale direttamente sul tuo smartphone!</p>
      </div>
    </div>
  </section>

  <!-- ‰øùÊåÅÊâÄÊúâÂÖ∂‰ªñÈÉ®ÂàÜ‰∏çÂèò -->
  <section id="products">
    <h2>I nostri prodotti</h2>
    <p>Scopri la nostra vasta gamma di prodotti per tutte le esigenze domestiche:</p>
    <div class="categories-grid">
      <div class="category-card"><div class="category-icon"><i class="fas fa-gift"></i></div><h3>Articoli Regalo</h3><p>Idee regalo per ogni occasione e per tutte le et√†</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-gamepad"></i></div><h3>Giocattoli</h3><p>Giocattoli educativi e di intrattenimento per bambini</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-pencil-alt"></i></div><h3>Cartoleria</h3><p>Materiale scolastico e per ufficio di alta qualit√†</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-home"></i></div><h3>Casalinghi</h3><p>Accessori e complementi d'arredo per la casa</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-tools"></i></div><h3>Ferramenta</h3><p>Utensili e materiali per piccoli lavori domestici</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-paw"></i></div><h3>Articoli per animali</h3><p>Prodotti per la cura e il benessere dei tuoi amici a quattro zampe</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-lightbulb"></i></div><h3>Illuminazione</h3><p>Lampadari, lampade da terra, lampade da tavolo e illuminazione per internos</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-couch"></i></div><h3>Mobili</h3><p>Mobili per la casa, sedie, tavoli e complementi d'arredo</p></div>
      <div class="category-card"><div class="category-icon"><i class="fas fa-tree"></i></div><h3>Articoli Natalizi</h3><p>Decorazioni, addobbi e regali per il periodo natalizio</p></div>
    </div>
  </section>

  <section id="monthly-offer" class="monthly-offer">
    <h2>üéÑ Speciale Natale</h2>
    <div class="offer-highlight">SCONTI INCREDIBILI FINO AL 70% SU ALCUNI ARTICOLI NATALIZI!</div>
    <div class="offer-details">
      <h3><i class="fas fa-gift"></i> Cosa troverai in negozio:</h3>
      <ul style="margin-left:1.5rem;margin-top:1rem">
        <li>Addobbi natalizi di precedenti stagioni a prezzi stracciati</li>
        <li>Decorazioni per l'albero di Natale con sconti fino al 70%</li>
        <li>Luci e illuminazione natalizia a prezzi imbattibili</li>
        <li>Idee regalo natalizie con incredibili occasioni</li>
        <li>E tanto altro... vieni a scoprirlo di persona!</li>
      </ul>
    </div>
    <p><strong>Perch√© non elenchiamo tutti i prodotti?</strong> Perch√© le scorte sono limitate e variano ogni giorno! I migliori affari li trovi venendo direttamente in negozio.</p>
    <p style="text-align:center;font-size:1.2rem;margin:1.5rem 0">üìç <strong>Vieni a caccia di occasioni!</strong><br><em>I prezzi pi√π bassi li vedi solo qui da noi</em></p>
    <div class="offer-validity"><strong>Affrettati! Offerte valide fino al: <span style="color:var(--secondary-color)">31 Dicembre 2025</span></strong><br><small>o fino ad esaurimento scorte</small></div>
  </section>

  <section id="hours">
    <h2>Orari di apertura</h2>
    <ul class="hours-list">
      <li><span>Luned√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Marted√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Mercoled√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Gioved√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Venerd√¨</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Sabato</span><span>08:45 ‚Äî 19:45</span></li>
      <li><span>Domenica</span><span>08:45 ‚Äî 19:45</span></li>
    </ul>
    <p style="margin-top:1rem;font-style:italic">Siamo aperti anche nei giorni festivi, salvo comunicazioni diverse.</p>
  </section>

  <section id="products-showcase" class="products-section">
    <h2>Catalogo Prodotti <small style="font-size:0.8em;color:#666">(Aggiornato in tempo reale)</small></h2>
    <p>Scopri tutti i nostri prodotti con prezzi e dettagli:</p>
    <div class="search-filter-container">
      <div class="search-box"><i class="fas fa-search"></i><input type="text" id="product-search" placeholder="Cerca per nome prodotto o codice a barre..."><div class="search-hint">Cerca per nome prodotto o codice a barre (es: 8005123456789)</div></div>
      <select class="filter-select" id="category-filter"><option value="all">Tutte le categorie</option><option value="regalo">Articoli Regalo</option><option value="giocattoli">Giocattoli</option><option value="cartoleria">Cartoleria</option><option value="casalinghi">Casalinghi</option><option value="ferramenta">Ferramenta</option><option value="animali">Articoli per animali</option><option value="illuminazione">Illuminazione</option><option value="mobili">Mobili</option><option value="natale">üéÑ Articoli Natalizi</option></select>
    </div>
    <div class="products-grid" id="products-container"></div>
    <div class="load-more-container"><button class="load-more-btn" id="load-more">Carica pi√π prodotti</button></div>
  </section>

  <section id="contact">
    <h2>Contatti</h2>
    <div class="contact-info">
      <div class="contact-details">
        <p><i class="fas fa-map-marker-alt"></i> <strong>Indirizzo:</strong> Lungobisagno Istria, 29F, 16139 Genova GE</p>
        <p><i class="fas fa-envelope"></i> <strong>Email:</strong> <a href="mailto:supershopbisagnosrl@gmail.com">supershopbisagnosrl@gmail.com</a></p>
        <p><i class="fas fa-info-circle"></i> Per informazioni commerciali o partnership, contattaci via email.</p>
        <p><i class="fas fa-qrcode"></i> Scansiona il QR code per visitare il catalogo prodotti:</p>
        <img src="1000011850.png" alt="QR Code Supershop Bisagno" style="width:150px;height:150px">
        <p style="font-size:0.9em;color:#666;margin-top:0.5em"><i class="fas fa-cloud"></i> Catalogo sempre aggiornato in tempo reale</p>
      </div>
      <div class="map-container"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2817.256958424239!2d8.946223315544193!3d44.40722497909945!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x12d3433c3b06d6a5%3A0x5b0e46e9e5a5a5a5!2sLungobisagno%20Istria%2C%2029F%2C%2016139%20Genova%20GE!5e0!3m2!1sit!2sit!4v1620000000000!5m2!1sit!2sit" allowfullscreen="" loading="lazy"></iframe></div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-content">
    <p>¬© <span id="year"></span> Supershop Bisagno S.R.L. ‚Äî Tutti i diritti riservati</p>
    <p>P.IVA: 02596100996 | REA: GE - 497926</p>
    <div style="margin-top:1rem;padding-top:1rem;border-top:1px solid rgba(255,255,255,0.2)"><a href="#privacy-policy" style="color:white;margin:0 1rem;text-decoration:none" onclick="showPrivacyPolicy()">Privacy Policy</a><a href="#cookie-policy" style="color:white;margin:0 1rem;text-decoration:none" onclick="showCookiePolicy()">Cookie Policy</a></div>
  </div>
</footer>

<a href="#" class="back-to-top" id="backToTop"><i class="fas fa-arrow-up"></i></a>

<div id="privacy-modal">
  <div>
    <button onclick="closeModal()" style="position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer">&times;</button>
    <div id="modal-content"></div>
  </div>
</div>

<script>
// ==================== Âä®ÊÄÅÂØÜÁ†ÅÁ≥ªÁªü ====================
const DYNAMIC_PASSWORD_CONFIG = {
  ENABLED: true,
  BASE_PASSWORD: 'supershop',
  STATIC_PASSWORDS: ['admin123', 'bisagno2024'],
  PASSWORD_VALIDITY_HOURS: 24
};

function generateDynamicPassword() {
  const today = new Date();
  return DYNAMIC_PASSWORD_CONFIG.BASE_PASSWORD + today.getDate().toString().padStart(2, '0') + (today.getMonth() + 1).toString().padStart(2, '0');
}

function validateAdminPassword(inputPassword) {
  const dynamicPassword = generateDynamicPassword();
  return inputPassword === dynamicPassword || DYNAMIC_PASSWORD_CONFIG.STATIC_PASSWORDS.includes(inputPassword);
}

// ==================== ‰∫ßÂìÅÊï∞ÊçÆ - Áé∞Âú®‰ªé Firebase Âä†ËΩΩ ====================
let products = [];

// ==================== Firebase ÂäüËÉΩ ====================
async function loadProductsFromFirebase() {
    try {
        showSyncStatus('Caricamento prodotti dal cloud...', 'syncing');
        
        const { collection, getDocs, query, orderBy } = window.firebaseModules;
        const q = query(collection(window.firestore, "products"), orderBy("createdAt", "desc"));
        const querySnapshot = await getDocs(q);
        
        products = [];
        querySnapshot.forEach((doc) => {
            products.push({ firebaseId: doc.id, ...doc.data() });
        });
        
        renderProducts();
        updateAdminStats();
        
        showSyncStatus(`Caricati ${products.length} prodotti dal cloud`, 'success');
        return products;
    } catch (error) {
        console.error("Errore nel caricamento prodotti:", error);
        showSyncStatus('Errore nel caricamento dal cloud', 'error');
        // Â¶ÇÊûúFirebaseÂ§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞Â≠òÂÇ®‰Ωú‰∏∫Â§áÁî®
        loadFromLocalStorage();
        return [];
    }
}

async function addProductToFirebase(productData) {
    try {
        const { addDoc, collection } = window.firebaseModules;
        const productWithTimestamp = {
            ...productData,
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        const docRef = await addDoc(collection(window.firestore, "products"), productWithTimestamp);
        console.log("Prodotto aggiunto con ID: ", docRef.id);
        return docRef.id;
    } catch (error) {
        console.error("Errore nell'aggiunta prodotto: ", error);
        throw error;
    }
}

// Â§áÁî®ÊñπÊ°àÔºöÊú¨Âú∞Â≠òÂÇ®
function loadFromLocalStorage() {
    const saved = loadStorage('supershop_products');
    if (saved && saved.length > 0) {
        products = saved;
        renderProducts();
        updateAdminStats();
        showSyncStatus(`Caricati ${products.length} prodotti da backup locale`, 'warning');
    }
}

// ==================== Â∑•ÂÖ∑ÂáΩÊï∞ ====================
const saveStorage = (key,val) => { 
  try { 
    localStorage.setItem(key,JSON.stringify(val)); 
  } catch(e) {
    console.error('Errore nel salvataggio:', e);
  } 
};

const loadStorage = key => { 
  try { 
    return JSON.parse(localStorage.getItem(key)); 
  } catch(e) { 
    console.error('Errore nel caricamento:', e);
    return null; 
  } 
};

const showSyncStatus = (msg,type='success') => {
  const s = document.getElementById('sync-status'); 
  const t = document.getElementById('sync-text');
  t.textContent = msg; 
  s.className = 'sync-status ' + type; 
  s.style.display = 'flex';
  setTimeout(()=>s.style.display='none',3000);
};

// ==================== ‰∫åÁª¥Á†ÅÂêåÊ≠•ÂäüËÉΩ - Áé∞Âú®‰ΩøÁî®Âõ∫ÂÆöÈìæÊé• ====================
const updateQRCode = () => {
  const qrCodeUrl = window.location.href; // Âõ∫ÂÆöÈìæÊé•
  const qrCodeImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(qrCodeUrl)}`;
  
  const qrCodeImg = document.querySelector('img[alt="QR Code Supershop Bisagno"]');
  if (qrCodeImg) {
    qrCodeImg.src = qrCodeImageUrl;
  }
  
  alert(`‚úÖ QR Code Fisso Creato!\n\nLink: ${qrCodeUrl}\n\nI clienti vedranno sempre i prodotti pi√π recenti dal cloud.`);
};

const showQRCodeInfo = () => {
  alert(`üìã ISTRUZIONI QR CODE FISSO

‚úÖ VANTAGGI:
‚Ä¢ Un solo QR code per sempre
‚Ä¢ Prodotti sempre aggiornati
‚Ä¢ Supporta migliaia di prodotti
‚Ä¢ Nessun limite di dimensione

üì± PER I CLIENTI:
1. Scansiona il QR code
2. Vedi tutti i prodotti aggiornati
3. Nessuna azione aggiuntiva richiesta

üîÑ PER TE:
1. Aggiungi/modifica prodotti normalmente
2. I cambiamenti sono visibili immediatamente
3. Nessun bisogno di rigenerare QR code
`);
};

// ==================== ÊâπÈáèÂØºÂÖ•Âà∞ Firebase ====================
async function importAllToFirebase() {
    if (!confirm('Importare TUTTI i prodotti locali nel database cloud Firebase?\n\nQuesta operazione potrebbe richiedere alcuni minuti.')) return;
    
    try {
        showSyncStatus('Importazione nel cloud in corso...', 'syncing');
        
        // Âä†ËΩΩÊú¨Âú∞‰∫ßÂìÅ
        const localProducts = loadStorage('supershop_products') || [];
        let importedCount = 0;
        const batchSize = 25;
        
        for (let i = 0; i < localProducts.length; i += batchSize) {
            const batch = localProducts.slice(i, i + batchSize);
            
            for (const product of batch) {
                try {
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®
                    const existingProducts = products.filter(p => p.id === product.id);
                    if (existingProducts.length === 0) {
                        await addProductToFirebase(product);
                        importedCount++;
                    }
                } catch (error) {
                    console.error(`Errore nell'importazione prodotto ${product.id}:`, error);
                }
            }
            
            showSyncStatus(`Importati ${importedCount}/${localProducts.length} prodotti...`, 'syncing');
            await new Promise(resolve => setTimeout(resolve, 500)); // ÈÅøÂÖçÈÄüÁéáÈôêÂà∂
        }
        
        showSyncStatus(`Importazione completata: ${importedCount} prodotti`, 'success');
        await loadProductsFromFirebase(); // ÈáçÊñ∞‰ªéFirebaseÂä†ËΩΩ
        
    } catch (error) {
        console.error('Errore nell\'importazione:', error);
        showSyncStatus('Errore nell\'importazione', 'error');
    }
}

// ==================== ÁÆ°ÁêÜÂëòÈù¢Êùø ====================
let adminAuthenticated = false;

const enableAdminPanel = () => {
  if (adminAuthenticated) { 
    openAdminPanel(); 
    return; 
  }
  
  const pwd = prompt('üîê Accesso Amministratore\n\nInserisci la password:');
  if (validateAdminPassword(pwd)) { 
    adminAuthenticated = true; 
    openAdminPanel(); 
    showSyncStatus('Accesso amministratore autorizzato','success'); 
  } else if (pwd !== null) {
    alert('‚ùå Password non valida');
  }
};

const openAdminPanel = () => {
  document.getElementById('adminPanel').classList.add('active');
  document.getElementById('adminOverlay').classList.add('active');
  updateAdminStats();
};

const closeAdminPanel = () => {
  document.getElementById('adminPanel').classList.remove('active');
  document.getElementById('adminOverlay').classList.remove('active');
};

const updateAdminStats = () => {
  document.getElementById('totalProducts').textContent = products.length;
  const categories = new Set(products.map(p => p.category));
  document.getElementById('totalCategories').textContent = categories.size;
};

// ==================== ‰∫ßÂìÅÂ±ïÁ§∫ ====================
let currentPage = 1; 
const productsPerPage = 8; 
let filteredProducts = [...products];

const renderProducts = () => {
  const container = document.getElementById('products-container');
  const search = document.getElementById('product-search').value.toLowerCase();
  const category = document.getElementById('category-filter').value;
  
  filteredProducts = products.filter(p=>
    (p.name.toLowerCase().includes(search)||(p.id && p.id.includes(search))) &&
    (category==='all'||p.category===category)
  );
  
  const end = currentPage * productsPerPage;
  const html = filteredProducts.slice(0,end).map(p=>{
    const hasDiscount = p.discountPrice && p.originalPrice;
    return `
      <div class="product-card" onclick="openProductModal('${p.id}')">
        <img src="${p.image}" alt="${p.name}" class="product-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SW1tYWdpbmUgbm9uIGNhcmljYXRhPC90ZXh0Pjwvc3ZnPg=='">
        ${hasDiscount ? `<div class="discount-badge">-${p.discountPercentage}%</div>` : ''}
        <div class="product-info">
          <div class="product-name">${p.name}</div>
          <div class="product-price-container">
            ${hasDiscount ? 
              `<span class="original-price">${p.originalPrice}</span><span class="discount-price">${p.discountPrice}</span>` : 
              `<span class="discount-price">${p.price || 'Prezzo su richiesta'}</span>`
            }
          </div>
          <span class="product-category">${getCategoryName(p.category)}</span>
          <div class="product-barcode-small">Codice: ${p.id}</div>
        </div>
      </div>
    `;
  }).join('');
  
  container.innerHTML = html;
  document.getElementById('load-more').style.display = end < filteredProducts.length ? 'block' : 'none';
};

const getCategoryName = (category) => {
  const categories = {
    'regalo': 'Articoli Regalo',
    'giocattoli': 'Giocattoli',
    'cartoleria': 'Cartoleria',
    'casalinghi': 'Casalinghi',
    'ferramenta': 'Ferramenta',
    'animali': 'Articoli per animali',
    'illuminazione': 'Illuminazione',
    'mobili': 'Mobili',
    'natale': 'Articoli Natalizi'
  };
  return categories[category] || category;
};

// ==================== ‰∫ßÂìÅËØ¶ÊÉÖÂºπÁ™ó ====================
const openProductModal = (productId) => {
  const product = products.find(p => p.id === productId);
  if (!product) return;
  
  const modal = document.getElementById('privacy-modal');
  document.getElementById('modal-content').innerHTML = `
    <h2 style="color:var(--primary-color)">${product.name}</h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-top:1rem">
      <div><img src="${product.image}" alt="${product.name}" style="width:100%;border-radius:8px"></div>
      <div>
        ${product.discountPrice ? 
          `<div><span class="original-price">${product.originalPrice}</span><div class="discount-price">${product.discountPrice}</div></div>` : 
          `<div class="discount-price">${product.price || 'Prezzo su richiesta'}</div>`
        }
        <p><strong>Codice:</strong> ${product.id}</p>
        ${product.description && product.description !== product.name ? `<p>${product.description}</p>` : ''}
        <div style="margin-top:1rem">
          <button onclick="printProduct('${product.id}')" style="margin-right:0.5rem;background:var(--primary-color);color:white;border:none;padding:0.5rem 1rem;border-radius:4px;cursor:pointer">
            <i class="fas fa-print"></i> Stampa
          </button>
          <button onclick="shareProduct('${product.id}')" style="background:var(--secondary-color);color:white;border:none;padding:0.5rem 1rem;border-radius:4px;cursor:pointer">
            <i class="fas fa-share"></i> Condividi
          </button>
        </div>
      </div>
    </div>
  `;
  modal.style.display = 'flex';
};

const closeModal = () => {
  document.getElementById('privacy-modal').style.display = 'none';
};

const printProduct = (id) => {
  const p = products.find(x => x.id === id);
  const win = window.open('', '', 'width=600,height=400');
  win.document.write(`
    <html lang="it">
    <head><title>${p.name}</title></head>
    <body style="font-family:Arial,sans-serif;padding:2rem">
      <h2>${p.name}</h2>
      ${p.discountPrice ? 
        `<p><span style="text-decoration:line-through">${p.originalPrice}</span> <strong style="color:#ff6b00;font-size:1.2em">${p.discountPrice}</strong></p>` : 
        `<p><strong style="color:#ff6b00;font-size:1.2em">${p.price || 'Prezzo su richiesta'}</strong></p>`
      }
      <p>Categoria: ${getCategoryName(p.category)}</p>
      <div class="barcode" style="font-family:monospace;font-size:1.2em;margin:1rem 0">${p.id}</div>
      <p>Porta questo codice in negozio per trovare facilmente il prodotto.</p>
      <button onclick="window.print()" style="background:#004080;color:white;border:none;padding:0.5rem 1rem;border-radius:4px;cursor:pointer">Stampa</button>
    </body>
    </html>
  `);
  win.document.close();
};

const shareProduct = (id) => {
  const p = products.find(x => x.id === id);
  const text = `Scopri ${p.name} da Supershop Bisagno! ${p.discountPrice || p.price || 'Prezzo su richiesta'}. Visita il negozio!`;
  if (navigator.share) {
    navigator.share({title: p.name, text, url: location.href});
  } else {
    navigator.clipboard.writeText(`${text} ${location.href}`).then(() => alert('Informazioni copiate negli appunti!'));
  }
};

// ==================== ÁÆ°ÁêÜÂëòÂäüËÉΩ ====================
const addProduct = async () => {
  const name = document.getElementById('adminProductName').value.trim();
  const barcode = document.getElementById('adminProductBarcode').value.trim();
  const category = document.getElementById('adminProductCategory').value;
  const original = document.getElementById('adminOriginalPrice').value.trim();
  const discount = document.getElementById('adminDiscountPrice').value.trim();
  const image = document.getElementById('adminProductImage').value.trim();
  const desc = document.getElementById('adminProductDescription').value.trim() || name;
  
  if (!name || !barcode) {
    alert('Nome e barcode obbligatori!');
    return;
  }
  
  if (products.some(p => p.id === barcode)) {
    alert('Barcode gi√† esistente!');
    return;
  }
  
  const productData = {
    id: barcode,
    name,
    category,
    image: image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SW1tYWdpbmUgbm9uIGNhcmljYXRhPC90ZXh0Pjwvc3ZnPg==',
    description: desc
  };
  
  if (original && discount) {
    const orig = parseFloat(original.replace(',','.'));
    const disc = parseFloat(discount.replace(',','.'));
    productData.originalPrice = `‚Ç¨${original}`;
    productData.discountPrice = `‚Ç¨${discount}`;
    productData.discountPercentage = parseFloat(((orig-disc)/orig*100).toFixed(2));
  } else if (original) {
    productData.price = `‚Ç¨${original}`;
  } else if (discount) {
    productData.price = `‚Ç¨${discount}`;
  } else {
    productData.price = 'Prezzo su richiesta';
  }

  try {
    // Ê∑ªÂä†Âà∞ Firebase
    await addProductToFirebase(productData);
    
    // ÈáçÊñ∞Âä†ËΩΩ‰∫ßÂìÅÂàóË°®
    await loadProductsFromFirebase();
    
    // Ê∏ÖÁ©∫Ë°®Âçï
    document.getElementById('adminProductName').value = '';
    document.getElementById('adminProductBarcode').value = '';
    document.getElementById('adminOriginalPrice').value = '';
    document.getElementById('adminDiscountPrice').value = '';
    document.getElementById('adminProductImage').value = '';
    document.getElementById('adminProductDescription').value = '';
    
    alert('‚úÖ Prodotto aggiunto con successo al database cloud!');
  } catch (error) {
    alert('‚ùå Errore nell\'aggiunta del prodotto: ' + error.message);
  }
};

const exportProducts = () => {
  const csv = [
    "Codice,Nome Prodotto,Categoria,Prezzo Originale,Prezzo Scontato,Sconto %,Immagine,Descrizione",
    ...products.map(p => 
      `"${p.id}","${p.name}","${p.category}","${p.originalPrice||''}","${p.discountPrice||p.price||''}","${p.discountPercentage||''}","${p.image}","${p.description}"`
    )
  ].join('\n');
  
  const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'supershop_products.csv';
  a.click();
  showSyncStatus('CSV esportato con successo','success');
};

const importProducts = () => {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.csv';
  input.onchange = e => {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = ev => {
      const lines = ev.target.result.split('\n').slice(1);
      let added = 0;
      
      for (const line of lines) {
        if (!line.trim()) continue;
        
        const [id, name, category, orig, disc, perc, img, desc] = line.split(',').map(x => x.replace(/^"|"$/g, ''));
        
        if (!id || !name || products.some(p => p.id === id)) continue;
        
        const p = {
          id,
          name,
          category,
          image: img || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+SW1tYWdpbmUgbm9uIGNhcmljYXRhPC90ZXh0Pjwvc3ZnPg==',
          description: desc || name
        };
        
        if (orig && disc) {
          p.originalPrice = `‚Ç¨${orig}`;
          p.discountPrice = `‚Ç¨${disc}`;
          p.discountPercentage = parseFloat(perc) || 0;
        } else if (orig) {
          p.price = `‚Ç¨${orig}`;
        } else if (disc) {
          p.price = `‚Ç¨${disc}`;
        } else {
          p.price = 'Prezzo su richiesta';
        }
        
        products.push(p);
        added++;
      }
      
      saveStorage('supershop_products', products);
      renderProducts();
      updateAdminStats();
      alert(`Importati ${added} prodotti con successo!`);
    };
    reader.readAsText(file);
  };
  input.click();
};

const backupData = () => {
  const data = JSON.stringify({
    products,
    date: new Date().toISOString(),
    version: '1.0'
  }, null, 2);
  
  const blob = new Blob([data], {type: 'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `supershop_backup_${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  showSyncStatus('Backup dati effettuato','success');
};

const clearAllData = () => {
  if (!confirm('Sei sicuro di voler cancellare tutti i dati dei prodotti? Questa operazione non pu√≤ essere annullata!')) return;
  products.length = 0;
  saveStorage('supershop_products', products);
  renderProducts();
  updateAdminStats();
  showSyncStatus('Tutti i dati sono stati cancellati','success');
};

const adminQuickSearch = () => {
  const q = document.getElementById('adminQuickSearch').value.toLowerCase();
  const res = document.getElementById('adminSearchResults');
  
  if (!q) {
    res.innerHTML = '';
    return;
  }
  
  const found = products.filter(p => 
    p.name.toLowerCase().includes(q) || (p.id && p.id.includes(q))
  );
  
  res.innerHTML = found.map(p => `
    <div style="padding:0.5rem;border-bottom:1px solid #eee;cursor:pointer" onclick="openProductModal('${p.id}')">
      <strong>${p.name}</strong><br>
      <small>${p.id} - ${p.discountPrice || p.price || 'Prezzo su richiesta'}</small>
    </div>
  `).join('');
};

// ==================== ÂêàËßÑÂ£∞ÊòéÂÜÖÂÆπ ====================
const complianceContent = {
  privacy: `
    <h2 style="color:var(--primary-color)">Informativa Privacy</h2>
    <p><strong>Supershop Bisagno S.R.L.</strong> rispetta la tua privacy.</p>
    <h3>üìä Dati raccolti</h3>
    <p>Questo sito <strong>NON raccoglie dati personali</strong> degli utenti:</p>
    <ul><li>Nessuna registrazione obbligatoria</li><li>Nessun modulo di contatto</li><li>Nessuna newsletter</li><li>Nessun profilo utente</li></ul>
    <h3>üîç Funzionalit√† del sito</h3>
    <ul><li>La <strong>ricerca prodotti</strong> funziona solo sul tuo dispositivo</li><li>I <strong>preferiti o carrello</strong> sono temporanei (sessioni browser)</li><li>Nessun dato viene inviato ai nostri servers</li></ul>
    <h3>üìû Contatti</h3>
    <p>Per qualsiasi domanda sulla privacy:<br><strong>Email:</strong> supershopbisagnosrl@gmail.com<br><strong>Indirizzo:</strong> Lungobisagno Istria, 29F, 16139 Genova GE</p>
    <div style="background:#f0f7ff;padding:1rem;border-left:4px solid var(--primary-color);margin-top:1.5rem"><p style="margin:0"><strong>‚ÑπÔ∏è Trasparenza:</strong> Questo sito √® una vetrina digitale del nostro negozio fisico. Venite a trovarci in negozio per acquistare i nostri prodotti!</p></div>
  `,
  cookie: `
    <h2 style="color:var(--primary-color)">Informativa Cookie</h2>
    <h3>üç™ Cosa sono i Cookie?</h3><p>I cookie sono piccoli file di testo che i siti web salvano sul tuo dispositivo.</p>
    <h3>üîç Cookie utilizzati su questo sito</h3>
    <div style="background:#fff3cd;padding:1rem;border-left:4px solid #ffc107"><p style="margin:0"><strong>‚úÖ Questo sito NON utilizza cookie di tracciamento</strong></p></div>
    <ul><li><strong>Nessun cookie analytics</strong> (Google Analytics, Facebook Pixel, ecc.)</li><li><strong>Nessun cookie di profilazione</strong></li><li><strong>Nessun cookie di marketing</strong></li><li><strong>Nessun cookie di terze parti</strong></li></ul>
    <h3>‚öôÔ∏è Cookie tecnici (se presenti)</h3><p>Eventuali cookie tecnici sono utilizzati esclusivamente per:</p><ul><li>Memorizzare preferenze di visualizzazione temporanee</li><li>Funzionalit√† di ricerca interna al sito</li><li>Migliorare l'esperienza di navigazione</li></ul>
    <div style="background:#d4edda;padding:1rem;border-left:4px solid #28a745;margin-top:1.5rem"><p style="margin:0"><strong>üõ°Ô∏è Navigazione sicura:</strong> Puoi navigare questo sito tranquillamente senza preoccupazioni per la tua privacy. Non tracciamo le tue attivit√† online.</p></div>
  `
};

const showPrivacyPolicy = () => {
  document.getElementById('modal-content').innerHTML = complianceContent.privacy;
  document.getElementById('privacy-modal').style.display = 'flex';
};

const showCookiePolicy = () => {
  document.getElementById('modal-content').innerHTML = complianceContent.cookie;
  document.getElementById('privacy-modal').style.display = 'flex';
};

// ==================== È°µÈù¢ÂàùÂßãÂåñ ====================
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('year').textContent = new Date().getFullYear();
  
  // ÊòæÁ§∫ÈöêËóèÁöÑÁÆ°ÁêÜÂëòÊåâÈíÆ
  document.getElementById('hiddenAdminBtn').style.display = 'block';
  
  // Á≠âÂæÖ Firebase ÂàùÂßãÂåñÂÆåÊàêÂêéÂä†ËΩΩ‰∫ßÂìÅ
  setTimeout(async () => {
    await loadProductsFromFirebase();
  }, 1000);
  
  // ÂÖ∂‰ªñÁé∞ÊúâÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®...
  document.getElementById('product-search').addEventListener('input', () => {
    currentPage = 1;
    renderProducts();
  });
  
  document.getElementById('category-filter').addEventListener('change', () => {
    currentPage = 1;
    renderProducts();
  });
  
  document.getElementById('load-more').addEventListener('click', () => {
    currentPage++;
    renderProducts();
  });
  
  document.getElementById('hiddenAdminBtn').addEventListener('click', enableAdminPanel);
  document.getElementById('adminBtn').addEventListener('click', enableAdminPanel);
  
  document.querySelector('.mobile-menu-btn').addEventListener('click', () => {
    const nav = document.getElementById('navMenu');
    nav.style.display = nav.style.display === 'flex' ? 'none' : 'flex';
  });
  
  document.addEventListener('keydown', e => {
    if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'm') {
      e.preventDefault();
      enableAdminPanel();
    }
  });
  
  const backToTop = document.getElementById('backToTop');
  window.addEventListener('scroll', () => {
    backToTop.classList.toggle('visible', window.pageYOffset > 300);
  });
  
  backToTop.addEventListener('click', e => {
    e.preventDefault();
    window.scrollTo({top: 0, behavior: 'smooth'});
  });
});
</script>
</body>
</html>
